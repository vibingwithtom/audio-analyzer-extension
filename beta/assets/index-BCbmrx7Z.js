var ur=Object.defineProperty;var on=t=>{throw TypeError(t)};var cr=(t,e,n)=>e in t?ur(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var $e=(t,e,n)=>cr(t,typeof e!="symbol"?e+"":e,n),At=(t,e,n)=>e.has(t)||on("Cannot "+n);var c=(t,e,n)=>(At(t,e,"read from private field"),n?n.call(t):e.get(t)),b=(t,e,n)=>e.has(t)?on("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),v=(t,e,n,r)=>(At(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),k=(t,e,n)=>(At(t,e,"access private method"),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const Sn=!1;var In=Array.isArray,fr=Array.prototype.indexOf,hr=Array.from,gt=Object.defineProperty,We=Object.getOwnPropertyDescriptor,kn=Object.getOwnPropertyDescriptors,dr=Object.prototype,gr=Array.prototype,Vt=Object.getPrototypeOf,an=Object.isExtensible;const te=()=>{};function pr(t){return t()}function pt(t){for(var e=0;e<t.length;e++)t[e]()}function xn(){var t,e,n=new Promise((r,s)=>{t=r,e=s});return{promise:n,resolve:t,reject:e}}const F=2,An=4,yt=8,Te=16,re=32,Oe=64,Yt=128,U=256,vt=512,x=1024,P=2048,ge=4096,de=8192,Me=16384,Ht=32768,Et=65536,ln=1<<17,vr=1<<18,qe=1<<19,Tn=1<<20,Rt=1<<21,St=1<<22,ke=1<<23,Je=Symbol("$state"),Ke=new class extends Error{constructor(){super(...arguments);$e(this,"name","StaleReactionError");$e(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function _r(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function wr(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function br(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function mr(t){throw new Error("https://svelte.dev/e/effect_orphan")}function yr(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Er(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Sr(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ir(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function kr(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const xr=2,E=Symbol(),Ar="http://www.w3.org/1999/xhtml";function Tr(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function On(t){return t===this.v}function $n(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Dn(t){return!$n(t,this.v)}let It=!1,Or=!1;function $r(){It=!0}let y=null;function Ue(t){y=t}function Wt(t,e=!1,n){y={p:y,c:null,e:null,s:t,x:null,l:It&&!e?{s:null,u:null,$:[]}:null}}function Jt(t){var e=y,n=e.e;if(n!==null){e.e=null;for(var r of n)Vn(r)}return y=e.p,{}}function it(){return!It||y!==null&&y.l===null}let Re=[];function Dr(){var t=Re;Re=[],pt(t)}function Qe(t){if(Re.length===0){var e=Re;queueMicrotask(()=>{e===Re&&Dr()})}Re.push(t)}const Fr=new WeakMap;function Fn(t){var e=w;if(e===null)return _.f|=ke,t;if((e.f&Ht)===0){if((e.f&Yt)===0)throw!e.parent&&t instanceof Error&&Rn(t),t;e.b.error(t)}else ze(t,e)}function ze(t,e){for(;e!==null;){if((e.f&Yt)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t instanceof Error&&Rn(t),t}function Rn(t){const e=Fr.get(t);e&&(gt(t,"message",{value:e.message}),gt(t,"stack",{value:e.stack}))}const lt=new Set;let S=null,Ct=new Set,ae=[],Kt=null,Bt=!1;var Pe,Ne,me,nt,Le,je,ye,Ge,rt,st,z,Pt,ut,Nt;const Ce=class Ce{constructor(){b(this,z);$e(this,"current",new Map);b(this,Pe,new Map);b(this,Ne,new Set);b(this,me,0);b(this,nt,null);b(this,Le,[]);b(this,je,[]);b(this,ye,[]);b(this,Ge,[]);b(this,rt,[]);b(this,st,[]);$e(this,"skipped_effects",new Set)}process(e){ae=[];var n=Ce.apply(this);for(const i of e)k(this,z,Pt).call(this,i);if(c(this,me)===0){k(this,z,Nt).call(this);var r=c(this,je),s=c(this,ye);v(this,je,[]),v(this,ye,[]),v(this,Ge,[]),S=null,un(r),un(s),c(this,nt)?.resolve()}else k(this,z,ut).call(this,c(this,je)),k(this,z,ut).call(this,c(this,ye)),k(this,z,ut).call(this,c(this,Ge));n();for(const i of c(this,Le))tt(i);v(this,Le,[])}capture(e,n){c(this,Pe).has(e)||c(this,Pe).set(e,n),this.current.set(e,e.v)}activate(){S=this}deactivate(){S=null}flush(){if(ae.length>0){if(this.activate(),Rr(),S!==null&&S!==this)return}else c(this,me)===0&&k(this,z,Nt).call(this);this.deactivate();for(const e of Ct)if(Ct.delete(e),e(),S!==null)break}increment(){v(this,me,c(this,me)+1)}decrement(){v(this,me,c(this,me)-1);for(const e of c(this,rt))T(e,P),Ae(e);for(const e of c(this,st))T(e,ge),Ae(e);this.flush()}add_callback(e){c(this,Ne).add(e)}settled(){return(c(this,nt)??v(this,nt,xn())).promise}static ensure(){if(S===null){const e=S=new Ce;lt.add(S),Ce.enqueue(()=>{S===e&&e.flush()})}return S}static enqueue(e){Qe(e)}static apply(e){return te}};Pe=new WeakMap,Ne=new WeakMap,me=new WeakMap,nt=new WeakMap,Le=new WeakMap,je=new WeakMap,ye=new WeakMap,Ge=new WeakMap,rt=new WeakMap,st=new WeakMap,z=new WeakSet,Pt=function(e){e.f^=x;for(var n=e.first;n!==null;){var r=n.f,s=(r&(re|Oe))!==0,i=s&&(r&x)!==0,o=i||(r&de)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){s?n.f^=x:(r&An)!==0?c(this,ye).push(n):(r&x)===0&&((r&St)!==0&&n.b?.is_pending()?c(this,Le).push(n):kt(n)&&((n.f&Te)!==0&&c(this,Ge).push(n),tt(n)));var l=n.first;if(l!==null){n=l;continue}}var a=n.parent;for(n=n.next;n===null&&a!==null;)n=a.next,a=a.parent}},ut=function(e){for(const n of e)((n.f&P)!==0?c(this,rt):c(this,st)).push(n),T(n,x);e.length=0},Nt=function(){var e;for(const n of c(this,Ne))n();if(c(this,Ne).clear(),lt.size>1){c(this,Pe).clear();let n=!0;for(const r of lt){if(r===this){n=!1;continue}for(const[s,i]of this.current){if(r.current.has(s))if(n)r.current.set(s,i);else continue;Cn(s)}if(ae.length>0){S=r;const s=Ce.apply(r);for(const i of ae)k(e=r,z,Pt).call(e,i);ae=[],s()}}S=null}lt.delete(this)};let ee=Ce;function Rr(){var t=Be;Bt=!0;try{var e=0;for(hn(!0);ae.length>0;){var n=ee.ensure();if(e++>1e3){var r,s;Cr()}n.process(ae),he.clear()}}finally{Bt=!1,hn(t),Kt=null}}function Cr(){try{yr()}catch(t){ze(t,Kt)}}let ve=null;function un(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(Me|de))===0&&kt(r)&&(ve=[],tt(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?Jn(r):r.fn=null),ve?.length>0)){he.clear();for(const s of ve)tt(s);ve=[]}}ve=null}}function Cn(t){if(t.reactions!==null)for(const e of t.reactions){const n=e.f;(n&F)!==0?Cn(e):(n&(St|Te))!==0&&(T(e,P),Ae(e))}}function Ae(t){for(var e=Kt=t;e.parent!==null;){e=e.parent;var n=e.f;if(Bt&&e===w&&(n&Te)!==0)return;if((n&(Oe|re))!==0){if((n&x)===0)return;e.f^=x}}ae.push(e)}function Br(t){let e=0,n=ot(0),r;return()=>{Xr()&&(J(n),ts(()=>(e===0&&(r=nn(()=>t(()=>Xe(n)))),e+=1,()=>{Qe(()=>{e-=1,e===0&&(r?.(),r=void 0,Xe(n))})})))}}var Pr=Et|qe|Yt;function Nr(t,e,n){new Lr(t,e,n)}var q,j,qt,Y,Ee,H,G,$,W,le,Se,ue,Ie,ce,bt,mt,O,jr,Gr,ct,ft,Lt;class Lr{constructor(e,n,r){b(this,O);$e(this,"parent");b(this,q,!1);b(this,j);b(this,qt,null);b(this,Y);b(this,Ee);b(this,H);b(this,G,null);b(this,$,null);b(this,W,null);b(this,le,null);b(this,Se,0);b(this,ue,0);b(this,Ie,!1);b(this,ce,null);b(this,bt,()=>{c(this,ce)&&_t(c(this,ce),c(this,Se))});b(this,mt,Br(()=>(v(this,ce,ot(c(this,Se))),()=>{v(this,ce,null)})));v(this,j,e),v(this,Y,n),v(this,Ee,r),this.parent=w.b,v(this,q,!!c(this,Y).pending),v(this,H,Yn(()=>{w.b=this;{try{v(this,G,Q(()=>r(c(this,j))))}catch(s){this.error(s)}c(this,ue)>0?k(this,O,ft).call(this):v(this,q,!1)}},Pr))}is_pending(){return c(this,q)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!c(this,Y).pending}update_pending_count(e){k(this,O,Lt).call(this,e),v(this,Se,c(this,Se)+e),Ct.add(c(this,bt))}get_effect_pending(){return c(this,mt).call(this),J(c(this,ce))}error(e){var n=c(this,Y).onerror;let r=c(this,Y).failed;if(c(this,Ie)||!n&&!r)throw e;c(this,G)&&(K(c(this,G)),v(this,G,null)),c(this,$)&&(K(c(this,$)),v(this,$,null)),c(this,W)&&(K(c(this,W)),v(this,W,null));var s=!1,i=!1;const o=()=>{if(s){Tr();return}s=!0,i&&kr(),ee.ensure(),v(this,Se,0),c(this,W)!==null&&Ze(c(this,W),()=>{v(this,W,null)}),v(this,q,this.has_pending_snippet()),v(this,G,k(this,O,ct).call(this,()=>(v(this,Ie,!1),Q(()=>c(this,Ee).call(this,c(this,j)))))),c(this,ue)>0?k(this,O,ft).call(this):v(this,q,!1)};var l=_;try{D(null),i=!0,n?.(e,o),i=!1}catch(a){ze(a,c(this,H)&&c(this,H).parent)}finally{D(l)}r&&Qe(()=>{v(this,W,k(this,O,ct).call(this,()=>{v(this,Ie,!0);try{return Q(()=>{r(c(this,j),()=>e,()=>o)})}catch(a){return ze(a,c(this,H).parent),null}finally{v(this,Ie,!1)}}))})}}q=new WeakMap,j=new WeakMap,qt=new WeakMap,Y=new WeakMap,Ee=new WeakMap,H=new WeakMap,G=new WeakMap,$=new WeakMap,W=new WeakMap,le=new WeakMap,Se=new WeakMap,ue=new WeakMap,Ie=new WeakMap,ce=new WeakMap,bt=new WeakMap,mt=new WeakMap,O=new WeakSet,jr=function(){try{v(this,G,Q(()=>c(this,Ee).call(this,c(this,j))))}catch(e){this.error(e)}v(this,q,!1)},Gr=function(){const e=c(this,Y).pending;e&&(v(this,$,Q(()=>e(c(this,j)))),ee.enqueue(()=>{v(this,G,k(this,O,ct).call(this,()=>(ee.ensure(),Q(()=>c(this,Ee).call(this,c(this,j)))))),c(this,ue)>0?k(this,O,ft).call(this):(Ze(c(this,$),()=>{v(this,$,null)}),v(this,q,!1))}))},ct=function(e){var n=w,r=_,s=y;X(c(this,H)),D(c(this,H)),Ue(c(this,H).ctx);try{return e()}catch(i){return Fn(i),null}finally{X(n),D(r),Ue(s)}},ft=function(){const e=c(this,Y).pending;c(this,G)!==null&&(v(this,le,document.createDocumentFragment()),Ur(c(this,G),c(this,le))),c(this,$)===null&&v(this,$,Q(()=>e(c(this,j))))},Lt=function(e){var n;if(!this.has_pending_snippet()){this.parent&&k(n=this.parent,O,Lt).call(n,e);return}v(this,ue,c(this,ue)+e),c(this,ue)===0&&(v(this,q,!1),c(this,$)&&Ze(c(this,$),()=>{v(this,$,null)}),c(this,le)&&(c(this,j).before(c(this,le)),v(this,le,null)),Qe(()=>{ee.ensure().flush()}))};function Ur(t,e){for(var n=t.nodes_start,r=t.nodes_end;n!==null;){var s=n===r?null:Qt(n);e.append(n),n=s}}function zr(t,e,n){const r=it()?Xt:Vr;if(e.length===0){n(t.map(r));return}var s=S,i=w,o=Mr();Promise.all(e.map(l=>qr(l))).then(l=>{o();try{n([...t.map(r),...l])}catch(a){(i.f&Me)===0&&ze(a,i)}s?.deactivate(),Bn()}).catch(l=>{ze(l,i)})}function Mr(){var t=w,e=_,n=y,r=S;return function(){X(t),D(e),Ue(n),r?.activate()}}function Bn(){X(null),D(null),Ue(null)}function Xt(t){var e=F|P,n=_!==null&&(_.f&F)!==0?_:null;return w===null||n!==null&&(n.f&U)!==0?e|=U:w.f|=qe,{ctx:y,deps:null,effects:null,equals:On,f:e,fn:t,reactions:null,rv:0,v:E,wv:0,parent:n??w,ac:null}}function qr(t,e){let n=w;n===null&&_r();var r=n.b,s=void 0,i=ot(E),o=!_,l=new Map;return es(()=>{var a=xn();s=a.promise;try{Promise.resolve(t()).then(a.resolve,a.reject)}catch(d){a.reject(d)}var u=S,f=r.is_pending();o&&(r.update_pending_count(1),f||(u.increment(),l.get(u)?.reject(Ke),l.set(u,a)));const g=(d,h=void 0)=>{f||u.activate(),h?h!==Ke&&(i.f|=ke,_t(i,h)):((i.f&ke)!==0&&(i.f^=ke),_t(i,d)),o&&(r.update_pending_count(-1),f||u.decrement()),Bn()};a.promise.then(g,d=>g(null,d||"unknown"))}),tn(()=>{for(const a of l.values())a.reject(Ke)}),new Promise(a=>{function u(f){function g(){f===s?a(i):u(s)}f.then(g,g)}u(s)})}function Vr(t){const e=Xt(t);return e.equals=Dn,e}function Pn(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)K(e[n])}}function Yr(t){for(var e=t.parent;e!==null;){if((e.f&F)===0)return e;e=e.parent}return null}function Zt(t){var e,n=w;X(Yr(t));try{Pn(t),e=tr(t)}finally{X(n)}return e}function Nn(t){var e=Zt(t);if(t.equals(e)||(t.v=e,t.wv=Qn()),!Ve){var n=(fe||(t.f&U)!==0)&&t.deps!==null?ge:x;T(t,n)}}const he=new Map;function ot(t,e){var n={f:0,v:t,reactions:null,equals:On,rv:0,wv:0};return n}function ie(t,e){const n=ot(t);return os(n),n}function Hr(t,e=!1,n=!0){var s;const r=ot(t);return e||(r.equals=Dn),It&&n&&y!==null&&y.l!==null&&((s=y.l).s??(s.s=[])).push(r),r}function oe(t,e,n=!1){_!==null&&(!V||(_.f&ln)!==0)&&it()&&(_.f&(F|Te|St|ln))!==0&&!ne?.includes(t)&&Ir();let r=n?Ye(e):e;return _t(t,r)}function _t(t,e){if(!t.equals(e)){var n=t.v;Ve?he.set(t,e):he.set(t,n),t.v=e;var r=ee.ensure();r.capture(t,n),(t.f&F)!==0&&((t.f&P)!==0&&Zt(t),T(t,(t.f&U)===0?x:ge)),t.wv=Qn(),Ln(t,P),it()&&w!==null&&(w.f&x)!==0&&(w.f&(re|Oe))===0&&(L===null?as([t]):L.push(t))}return e}function Xe(t){oe(t,t.v+1)}function Ln(t,e){var n=t.reactions;if(n!==null)for(var r=it(),s=n.length,i=0;i<s;i++){var o=n[i],l=o.f;if(!(!r&&o===w)){var a=(l&P)===0;a&&T(o,e),(l&F)!==0?Ln(o,ge):a&&((l&Te)!==0&&ve!==null&&ve.push(o),Ae(o))}}}function Ye(t){if(typeof t!="object"||t===null||Je in t)return t;const e=Vt(t);if(e!==dr&&e!==gr)return t;var n=new Map,r=In(t),s=ie(0),i=xe,o=l=>{if(xe===i)return l();var a=_,u=xe;D(null),gn(i);var f=l();return D(a),gn(u),f};return r&&n.set("length",ie(t.length)),new Proxy(t,{defineProperty(l,a,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&Er();var f=n.get(a);return f===void 0?f=o(()=>{var g=ie(u.value);return n.set(a,g),g}):oe(f,u.value,!0),!0},deleteProperty(l,a){var u=n.get(a);if(u===void 0){if(a in l){const f=o(()=>ie(E));n.set(a,f),Xe(s)}}else oe(u,E),Xe(s);return!0},get(l,a,u){if(a===Je)return t;var f=n.get(a),g=a in l;if(f===void 0&&(!g||We(l,a)?.writable)&&(f=o(()=>{var h=Ye(g?l[a]:E),p=ie(h);return p}),n.set(a,f)),f!==void 0){var d=J(f);return d===E?void 0:d}return Reflect.get(l,a,u)},getOwnPropertyDescriptor(l,a){var u=Reflect.getOwnPropertyDescriptor(l,a);if(u&&"value"in u){var f=n.get(a);f&&(u.value=J(f))}else if(u===void 0){var g=n.get(a),d=g?.v;if(g!==void 0&&d!==E)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return u},has(l,a){if(a===Je)return!0;var u=n.get(a),f=u!==void 0&&u.v!==E||Reflect.has(l,a);if(u!==void 0||w!==null&&(!f||We(l,a)?.writable)){u===void 0&&(u=o(()=>{var d=f?Ye(l[a]):E,h=ie(d);return h}),n.set(a,u));var g=J(u);if(g===E)return!1}return f},set(l,a,u,f){var g=n.get(a),d=a in l;if(r&&a==="length")for(var h=u;h<g.v;h+=1){var p=n.get(h+"");p!==void 0?oe(p,E):h in l&&(p=o(()=>ie(E)),n.set(h+"",p))}if(g===void 0)(!d||We(l,a)?.writable)&&(g=o(()=>ie(void 0)),oe(g,Ye(u)),n.set(a,g));else{d=g.v!==E;var m=o(()=>Ye(u));oe(g,m)}var I=Reflect.getOwnPropertyDescriptor(l,a);if(I?.set&&I.set.call(f,u),!d){if(r&&typeof a=="string"){var M=n.get("length"),R=Number(a);Number.isInteger(R)&&R>=M.v&&oe(M,R+1)}Xe(s)}return!0},ownKeys(l){J(s);var a=Reflect.ownKeys(l).filter(g=>{var d=n.get(g);return d===void 0||d.v!==E});for(var[u,f]of n)f.v!==E&&!(u in l)&&a.push(u);return a},setPrototypeOf(){Sr()}})}var cn,jn,Gn,Un;function Wr(){if(cn===void 0){cn=window,jn=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Gn=We(e,"firstChild").get,Un=We(e,"nextSibling").get,an(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),an(n)&&(n.__t=void 0)}}function zn(t=""){return document.createTextNode(t)}function Mn(t){return Gn.call(t)}function Qt(t){return Un.call(t)}function Z(t,e){return Mn(t)}function _e(t,e=1,n=!1){let r=t;for(;e--;)r=Qt(r);return r}function Jr(){return!1}function en(t){var e=_,n=w;D(null),X(null);try{return t()}finally{D(e),X(n)}}function qn(t){w===null&&_===null&&mr(),_!==null&&(_.f&U)!==0&&w===null&&br(),Ve&&wr()}function Kr(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function se(t,e,n,r=!0){var s=w;s!==null&&(s.f&de)!==0&&(t|=de);var i={ctx:y,deps:null,nodes_start:null,nodes_end:null,f:t|P,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{tt(i),i.f|=Ht}catch(a){throw K(i),a}else e!==null&&Ae(i);if(r){var o=i;if(n&&o.deps===null&&o.teardown===null&&o.nodes_start===null&&o.first===o.last&&(o.f&qe)===0&&(o=o.first),o!==null&&(o.parent=s,s!==null&&Kr(o,s),_!==null&&(_.f&F)!==0&&(t&Oe)===0)){var l=_;(l.effects??(l.effects=[])).push(o)}}return i}function Xr(){return _!==null&&!V}function tn(t){const e=se(yt,null,!1);return T(e,x),e.teardown=t,e}function fn(t){qn();var e=w.f,n=!_&&(e&re)!==0&&(e&Ht)===0;if(n){var r=y;(r.e??(r.e=[])).push(t)}else return Vn(t)}function Vn(t){return se(An|Tn,t,!1)}function Zr(t){return qn(),se(yt|Tn,t,!0)}function Qr(t){ee.ensure();const e=se(Oe|qe,t,!0);return(n={})=>new Promise(r=>{n.outro?Ze(e,()=>{K(e),r(void 0)}):(K(e),r(void 0))})}function es(t){return se(St|qe,t,!0)}function ts(t,e=0){return se(yt|e,t,!0)}function jt(t,e=[],n=[]){zr(e,n,r=>{se(yt,()=>t(...r.map(J)),!0)})}function Yn(t,e=0){var n=se(Te|e,t,!0);return n}function Q(t,e=!0){return se(re|qe,t,!0,e)}function Hn(t){var e=t.teardown;if(e!==null){const n=Ve,r=_;dn(!0),D(null);try{e.call(null)}finally{dn(n),D(r)}}}function Wn(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&en(()=>{s.abort(Ke)});var r=n.next;(n.f&Oe)!==0?n.parent=null:K(n,e),n=r}}function ns(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&re)===0&&K(e),e=n}}function K(t,e=!0){var n=!1;(e||(t.f&vr)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(rs(t.nodes_start,t.nodes_end),n=!0),Wn(t,e&&!n),wt(t,0),T(t,Me);var r=t.transitions;if(r!==null)for(const i of r)i.stop();Hn(t);var s=t.parent;s!==null&&s.first!==null&&Jn(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function rs(t,e){for(;t!==null;){var n=t===e?null:Qt(t);t.remove(),t=n}}function Jn(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Ze(t,e){var n=[];Kn(t,n,!0),ss(n,()=>{K(t),e&&e()})}function ss(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var s of t)s.out(r)}else e()}function Kn(t,e,n){if((t.f&de)===0){if(t.f^=de,t.transitions!==null)for(const o of t.transitions)(o.is_global||n)&&e.push(o);for(var r=t.first;r!==null;){var s=r.next,i=(r.f&Et)!==0||(r.f&re)!==0;Kn(r,e,i?n:!1),r=s}}}function is(t){Xn(t,!0)}function Xn(t,e){if((t.f&de)!==0){t.f^=de,(t.f&x)===0&&(T(t,P),Ae(t));for(var n=t.first;n!==null;){var r=n.next,s=(n.f&Et)!==0||(n.f&re)!==0;Xn(n,s?e:!1),n=r}if(t.transitions!==null)for(const i of t.transitions)(i.is_global||e)&&i.in()}}let Be=!1;function hn(t){Be=t}let Ve=!1;function dn(t){Ve=t}let _=null,V=!1;function D(t){_=t}let w=null;function X(t){w=t}let ne=null;function os(t){_!==null&&(ne===null?ne=[t]:ne.push(t))}let A=null,B=0,L=null;function as(t){L=t}let Zn=1,et=0,xe=et;function gn(t){xe=t}let fe=!1;function Qn(){return++Zn}function kt(t){var e=t.f;if((e&P)!==0)return!0;if((e&ge)!==0){var n=t.deps,r=(e&U)!==0;if(n!==null){var s,i,o=(e&vt)!==0,l=r&&w!==null&&!fe,a=n.length;if((o||l)&&(w===null||(w.f&Me)===0)){var u=t,f=u.parent;for(s=0;s<a;s++)i=n[s],(o||!i?.reactions?.includes(u))&&(i.reactions??(i.reactions=[])).push(u);o&&(u.f^=vt),l&&f!==null&&(f.f&U)===0&&(u.f^=U)}for(s=0;s<a;s++)if(i=n[s],kt(i)&&Nn(i),i.wv>t.wv)return!0}(!r||w!==null&&!fe)&&T(t,x)}return!1}function er(t,e,n=!0){var r=t.reactions;if(r!==null&&!ne?.includes(t))for(var s=0;s<r.length;s++){var i=r[s];(i.f&F)!==0?er(i,e,!1):e===i&&(n?T(i,P):(i.f&x)!==0&&T(i,ge),Ae(i))}}function tr(t){var m;var e=A,n=B,r=L,s=_,i=fe,o=ne,l=y,a=V,u=xe,f=t.f;A=null,B=0,L=null,fe=(f&U)!==0&&(V||!Be||_===null),_=(f&(re|Oe))===0?t:null,ne=null,Ue(t.ctx),V=!1,xe=++et,t.ac!==null&&(en(()=>{t.ac.abort(Ke)}),t.ac=null);try{t.f|=Rt;var g=t.fn,d=g(),h=t.deps;if(A!==null){var p;if(wt(t,B),h!==null&&B>0)for(h.length=B+A.length,p=0;p<A.length;p++)h[B+p]=A[p];else t.deps=h=A;if(!fe||(f&F)!==0&&t.reactions!==null)for(p=B;p<h.length;p++)((m=h[p]).reactions??(m.reactions=[])).push(t)}else h!==null&&B<h.length&&(wt(t,B),h.length=B);if(it()&&L!==null&&!V&&h!==null&&(t.f&(F|ge|P))===0)for(p=0;p<L.length;p++)er(L[p],t);return s!==null&&s!==t&&(et++,L!==null&&(r===null?r=L:r.push(...L))),(t.f&ke)!==0&&(t.f^=ke),d}catch(I){return Fn(I)}finally{t.f^=Rt,A=e,B=n,L=r,_=s,fe=i,ne=o,Ue(l),V=a,xe=u}}function ls(t,e){let n=e.reactions;if(n!==null){var r=fr.call(n,t);if(r!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[r]=n[s],n.pop())}}n===null&&(e.f&F)!==0&&(A===null||!A.includes(e))&&(T(e,ge),(e.f&(U|vt))===0&&(e.f^=vt),Pn(e),wt(e,0))}function wt(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)ls(t,n[r])}function tt(t){var e=t.f;if((e&Me)===0){T(t,x);var n=w,r=Be;w=t,Be=!0;try{(e&Te)!==0?ns(t):Wn(t),Hn(t);var s=tr(t);t.teardown=typeof s=="function"?s:null,t.wv=Zn;var i;Sn&&Or&&(t.f&P)!==0&&t.deps}finally{Be=r,w=n}}}function J(t){var e=t.f,n=(e&F)!==0;if(_!==null&&!V){var r=w!==null&&(w.f&Me)!==0;if(!r&&!ne?.includes(t)){var s=_.deps;if((_.f&Rt)!==0)t.rv<et&&(t.rv=et,A===null&&s!==null&&s[B]===t?B++:A===null?A=[t]:(!fe||!A.includes(t))&&A.push(t));else{(_.deps??(_.deps=[])).push(t);var i=t.reactions;i===null?t.reactions=[_]:i.includes(_)||i.push(_)}}}else if(n&&t.deps===null&&t.effects===null){var o=t,l=o.parent;l!==null&&(l.f&U)===0&&(o.f^=U)}if(Ve){if(he.has(t))return he.get(t);if(n){o=t;var a=o.v;return((o.f&x)===0&&o.reactions!==null||nr(o))&&(a=Zt(o)),he.set(o,a),a}}else n&&(o=t,kt(o)&&Nn(o));if((t.f&ke)!==0)throw t.v;return t.v}function nr(t){if(t.v===E)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(he.has(e)||(e.f&F)!==0&&nr(e))return!0;return!1}function nn(t){var e=V;try{return V=!0,t()}finally{V=e}}const us=-7169;function T(t,e){t.f=t.f&us|e}function cs(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Je in t)Gt(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Je in n&&Gt(n)}}}function Gt(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{Gt(t[r],e)}catch{}const n=Vt(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=kn(n);for(let s in r){const i=r[s].get;if(i)try{i.call(t)}catch{}}}}}const fs=["touchstart","touchmove"];function hs(t){return fs.includes(t)}const ds=new Set,pn=new Set;function gs(t,e,n,r={}){function s(i){if(r.capture||He.call(e,i),!i.cancelBubble)return en(()=>n?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Qe(()=>{e.addEventListener(t,s,r)}):e.addEventListener(t,s,r),s}function ht(t,e,n,r,s){var i={capture:r,passive:s},o=gs(t,e,n,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&tn(()=>{e.removeEventListener(t,o,i)})}let vn=null;function He(t){var e=this,n=e.ownerDocument,r=t.type,s=t.composedPath?.()||[],i=s[0]||t.target;vn=t;var o=0,l=vn===t&&t.__root;if(l){var a=s.indexOf(l);if(a!==-1&&(e===document||e===window)){t.__root=e;return}var u=s.indexOf(e);if(u===-1)return;a<=u&&(o=a)}if(i=s[o]||t.target,i!==e){gt(t,"currentTarget",{configurable:!0,get(){return i||n}});var f=_,g=w;D(null),X(null);try{for(var d,h=[];i!==null;){var p=i.assignedSlot||i.parentNode||i.host||null;try{var m=i["__"+r];if(m!=null&&(!i.disabled||t.target===i))if(In(m)){var[I,...M]=m;I.apply(i,[t,...M])}else m.call(i,t)}catch(R){d?h.push(R):d=R}if(t.cancelBubble||p===e||p===null)break;i=p}if(d){for(let R of h)queueMicrotask(()=>{throw R});throw d}}finally{t.__root=e,delete t.currentTarget,D(f),X(g)}}}function ps(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function vs(t,e){var n=w;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function xt(t,e){var n=(e&xr)!==0,r,s=!t.startsWith("<!>");return()=>{r===void 0&&(r=ps(s?t:"<!>"+t),r=Mn(r));var i=n||jn?document.importNode(r,!0):r.cloneNode(!0);return vs(i,i),i}}function dt(t,e){t!==null&&t.before(e)}function _n(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??(t.__t=t.nodeValue))&&(t.__t=n,t.nodeValue=n+"")}function _s(t,e){return ws(t,e)}const De=new Map;function ws(t,{target:e,anchor:n,props:r={},events:s,context:i,intro:o=!0}){Wr();var l=new Set,a=g=>{for(var d=0;d<g.length;d++){var h=g[d];if(!l.has(h)){l.add(h);var p=hs(h);e.addEventListener(h,He,{passive:p});var m=De.get(h);m===void 0?(document.addEventListener(h,He,{passive:p}),De.set(h,1)):De.set(h,m+1)}}};a(hr(ds)),pn.add(a);var u=void 0,f=Qr(()=>{var g=n??e.appendChild(zn());return Nr(g,{pending:()=>{}},d=>{if(i){Wt({});var h=y;h.c=i}s&&(r.$$events=s),u=t(d,r)||{},i&&Jt()}),()=>{for(var d of l){e.removeEventListener(d,He);var h=De.get(d);--h===0?(document.removeEventListener(d,He),De.delete(d)):De.set(d,h)}pn.delete(a),g!==n&&g.parentNode?.removeChild(g)}});return bs.set(u,f),u}let bs=new WeakMap;function wn(t,e,n=!1){var r=t,s=null,i=null,o=E,l=n?Et:0,a=!1;const u=(h,p=!0)=>{a=!0,d(p,h)};var f=null;function g(){f!==null&&(f.lastChild.remove(),r.before(f),f=null);var h=o?s:i,p=o?i:s;h&&is(h),p&&Ze(p,()=>{o?i=null:s=null})}const d=(h,p)=>{if(o!==(o=h)){var m=Jr(),I=r;if(m&&(f=document.createDocumentFragment(),f.append(I=zn())),o?s??(s=p&&Q(()=>p(I))):i??(i=p&&Q(()=>p(I))),m){var M=S,R=o?s:i,at=o?i:s;R&&M.skipped_effects.delete(R),at&&M.skipped_effects.add(at),M.add_callback(g)}else g()}};Yn(()=>{a=!1,e(u),a||d(null,null)},l)}const bn=[...` 	
\r\f \v\uFEFF`];function ms(t,e,n){var r=""+t;if(n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,o=0;(o=r.indexOf(s,o))>=0;){var l=o+i;(o===0||bn.includes(r[o-1]))&&(l===r.length||bn.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function Tt(t,e,n,r,s,i){var o=t.__className;if(o!==n||o===void 0){var l=ms(n,r,i);l==null?t.removeAttribute("class"):t.className=l,t.__className=n}else if(i&&s!==i)for(var a in i){var u=!!i[a];(s==null||u!==!!s[a])&&t.classList.toggle(a,u)}return i}const ys=Symbol("is custom element"),Es=Symbol("is html");function Ot(t,e,n,r){var s=Ss(t);s[e]!==(s[e]=n)&&(n==null?t.removeAttribute(e):typeof n!="string"&&Is(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Ss(t){return t.__attributes??(t.__attributes={[ys]:t.nodeName.includes("-"),[Es]:t.namespaceURI===Ar})}var mn=new Map;function Is(t){var e=t.getAttribute("is")||t.nodeName,n=mn.get(e);if(n)return n;mn.set(e,n=[]);for(var r,s=t,i=Element.prototype;i!==s;){r=kn(s);for(var o in r)r[o].set&&n.push(o);s=Vt(s)}return n}function rr(t=!1){const e=y,n=e.l.u;if(!n)return;let r=()=>cs(e.s);if(t){let s=0,i={};const o=Xt(()=>{let l=!1;const a=e.s;for(const u in a)a[u]!==i[u]&&(i[u]=a[u],l=!0);return l&&s++,s});r=()=>J(o)}n.b.length&&Zr(()=>{yn(e,r),pt(n.b)}),fn(()=>{const s=nn(()=>n.m.map(pr));return()=>{for(const i of s)typeof i=="function"&&i()}}),n.a.length&&fn(()=>{yn(e,r),pt(n.a)})}function yn(t,e){if(t.l.s)for(const n of t.l.s)J(n);e()}function rn(t,e,n){if(t==null)return e(void 0),n&&n(void 0),te;const r=nn(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const Fe=[];function ks(t,e){return{subscribe:sn(t,e).subscribe}}function sn(t,e=te){let n=null;const r=new Set;function s(l){if($n(t,l)&&(t=l,n)){const a=!Fe.length;for(const u of r)u[1](),Fe.push(u,t);if(a){for(let u=0;u<Fe.length;u+=2)Fe[u][0](Fe[u+1]);Fe.length=0}}}function i(l){s(l(t))}function o(l,a=te){const u=[l,a];return r.add(u),r.size===1&&(n=e(s,i)||te),l(t),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:o}}function $t(t,e,n){const r=!Array.isArray(t),s=r?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=e.length<2;return ks(n,(o,l)=>{let a=!1;const u=[];let f=0,g=te;const d=()=>{if(f)return;g();const p=e(r?u[0]:u,o,l);i?o(p):g=typeof p=="function"?p:te},h=s.map((p,m)=>rn(p,I=>{u[m]=I,f&=~(1<<m),a&&d()},()=>{f|=1<<m}));return a=!0,d(),function(){pt(h),g(),a=!1}})}function xs(t){let e;return rn(t,n=>e=n)(),e}let Ut=Symbol();function zt(t,e,n){const r=n[e]??(n[e]={store:null,source:Hr(void 0),unsubscribe:te});if(r.store!==t&&!(Ut in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=te;else{var s=!0;r.unsubscribe=rn(t,i=>{s?r.source.v=i:oe(r.source,i)}),s=!1}return t&&Ut in n?xs(t):J(r.source)}function sr(){const t={};function e(){tn(()=>{for(var n in t)t[n].unsubscribe();gt(t,Ut,{enumerable:!1,value:!0})})}return[t,e]}const As="5";var En;typeof window<"u"&&((En=window.__svelte??(window.__svelte={})).v??(En.v=new Set)).add(As);$r();function Ts(){const{subscribe:t,set:e}=sn("local");return{subscribe:t,setTab:n=>e(n)}}const Mt=Ts();class we extends EventTarget{constructor(){super(),this.setupDebugLogging()}static getInstance(){return we.instance||(we.instance=new we),we.instance}dispatch(e){const n=new CustomEvent("app:event",{detail:e,bubbles:!1,cancelable:!1});this.dispatchEvent(n)}on(e,n){const r=s=>{const i=s;i.detail.type===e&&n(i.detail)};return this.addEventListener("app:event",r),()=>this.removeEventListener("app:event",r)}onAll(e){const n=r=>{e(r.detail)};return this.addEventListener("app:event",n),()=>this.removeEventListener("app:event",n)}once(e,n){let r=null;const s=i=>{n(i),r&&r()};return r=this.on(e,s),r}clearAllListeners(){const e=this._listeners;e&&Object.keys(e).forEach(n=>{delete e[n]})}setupDebugLogging(){typeof window<"u"&&localStorage.getItem("debugBridge")==="true"&&this.onAll(e=>{console.log("[AppBridge]",e.type,e)})}}typeof window<"u"&&(window.enableBridgeDebug=()=>{localStorage.setItem("debugBridge","true"),console.log("AppBridge debug logging enabled. Reload the page to see events.")},window.disableBridgeDebug=()=>{localStorage.removeItem("debugBridge"),console.log("AppBridge debug logging disabled.")});var Os=xt('<nav class="tabs sv-tab-nav svelte-1mmy281" aria-label="Main navigation"><button>📁 Local Files</button> <button>☁️ Google Drive</button> <button>📦 Box</button></nav>');function $s(t,e){Wt(e,!1);const n=()=>zt(Mt,"$currentTab",r),[r,s]=sr(),i=we.getInstance();function o(p){Mt.setTab(p),i.dispatch({type:"tab:changed",tab:p})}rr();var l=Os(),a=Z(l);let u;var f=_e(a,2);let g;var d=_e(f,2);let h;jt((p,m,I)=>{u=Tt(a,1,"tab-button svelte-1mmy281",null,u,p),Ot(a,"aria-current",n()==="local"?"page":void 0),g=Tt(f,1,"tab-button svelte-1mmy281",null,g,m),Ot(f,"aria-current",n()==="googleDrive"?"page":void 0),h=Tt(d,1,"tab-button svelte-1mmy281",null,h,I),Ot(d,"aria-current",n()==="box"?"page":void 0)},[()=>({active:n()==="local"}),()=>({active:n()==="googleDrive"}),()=>({active:n()==="box"})]),ht("click",a,()=>o("local")),ht("click",f,()=>o("googleDrive")),ht("click",d,()=>o("box")),dt(t,l),Jt(),s()}const Ds=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",Fs=window.location.pathname.startsWith("/beta"),ir=Ds?"http://localhost:3000":Fs?"https://audio-analyzer.tinytech.site/beta":"https://audio-analyzer.tinytech.site",Dt={CLIENT_ID:"708688597317-bmmrje6hqg8vo52nctned54m32q8uhsr.apps.googleusercontent.com",REDIRECT_URI:ir,SCOPE:"https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email",DISCOVERY_DOCS:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]},N={CLIENT_ID:"0y78slky3xitt421wmoa0fjdz6fi14hn",REDIRECT_URI:ir,AUTHORIZATION_URL:"https://account.box.com/api/oauth2/authorize",TOKEN_URL:"https://api.box.com/oauth2/token",API_URL:"https://api.box.com/2.0",PROXY_URL:"https://box-proxy-708688597317.us-central1.run.app"};class Rs{constructor(){this.isInitialized=!1,this.accessToken=null,this.codeClient=null,this.userInfo=null}async init(){if(!this.isInitialized)return new Promise((e,n)=>{this.loadGoogleAPI().then(()=>{this.initializeGIS().then(e).catch(n)}).catch(n)})}async loadGoogleAPI(){return new Promise((e,n)=>{if(window.gapi){e();return}const r=document.createElement("script");r.src="https://apis.google.com/js/api.js",r.onload=()=>e(),r.onerror=()=>n(new Error("Failed to load Google API script")),document.head.appendChild(r)})}async initializeGIS(){return new Promise((e,n)=>{const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.onload=()=>{this.setupGIS().then(e).catch(n)},r.onerror=()=>n(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async setupGIS(){return new Promise((e,n)=>{const r=setTimeout(()=>{n(new Error("Google API setup timeout"))},1e4);window.gapi.load("client",async()=>{try{clearTimeout(r),await window.gapi.client.init({discoveryDocs:Dt.DISCOVERY_DOCS}),this.tokenClient=window.google.accounts.oauth2.initTokenClient({client_id:Dt.CLIENT_ID,scope:Dt.SCOPE,callback:s=>{if(s.error){console.error("Token response error:",s),n(new Error(`Google sign-in failed: ${s.error}`));return}this.accessToken=s.access_token;const i={access_token:s.access_token,expires_at:Date.now()+s.expires_in*1e3,scope:s.scope};localStorage.setItem("google_token",JSON.stringify(i)),e(i)}}),this.isInitialized=!0,e()}catch(s){clearTimeout(r),console.error("Google API setup error:",s);let i="Unknown setup error";s&&typeof s=="object"?i=s.message||s.error||s.details||JSON.stringify(s):s&&(i=s.toString()),n(new Error(`Failed to setup Google API: ${i}`))}})})}async signIn(){return this.isInitialized||await this.init(),new Promise((e,n)=>{try{this.tokenClient.callback=r=>{if(r.error){console.error("Token response error:",r),n(new Error(`Google sign-in failed: ${r.error}`));return}if(!(r.scope&&r.scope.includes("https://www.googleapis.com/auth/drive.readonly"))){console.warn("Drive scope not granted, retrying with consent prompt"),this.tokenClient.requestAccessToken({prompt:"consent"});return}this.accessToken=r.access_token;const i={access_token:r.access_token,expires_at:Date.now()+r.expires_in*1e3,scope:r.scope};localStorage.setItem("google_token",JSON.stringify(i)),e(i)},this.tokenClient.requestAccessToken({prompt:""})}catch(r){console.error("Google sign-in error:",r);let s="Unknown sign-in error";r&&typeof r=="object"?s=r.error||r.message||r.details||JSON.stringify(r):r&&(s=r.toString()),n(new Error(`Google sign-in failed: ${s}`))}})}async getValidToken(){const e=localStorage.getItem("google_token");if(e)try{const n=JSON.parse(e);if(n.expires_at>Date.now()+3e5)return this.accessToken=n.access_token,n}catch(n){console.warn("Invalid stored token:",n),localStorage.removeItem("google_token")}return await this.signIn()}async getUserInfo(){const e=await this.getValidToken();try{const n=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!n.ok)throw new Error(`Failed to get user info: ${n.status}`);const r=await n.json();return this.userInfo=r,r}catch(n){throw new Error(`Failed to get user info: ${n.message}`)}}async downloadFile(e){const n=await this.getValidToken();try{const r=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?fields=name,mimeType,size`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!r.ok)throw r.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive. Please sign in again and grant Drive access.")):new Error(`Failed to get file metadata: ${r.status}`);const s=await r.json(),i=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?alt=media`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!i.ok)throw new Error(`Failed to download file: ${i.status}`);const o=await i.blob();return new File([o],s.name,{type:s.mimeType||"audio/mpeg"})}catch(r){throw new Error(`Google Drive download failed: ${r.message}`)}}async listAudioFilesInFolder(e){const n=await this.getValidToken();try{const s=["audio/mpeg","audio/wav","audio/x-wav","audio/wave","audio/flac","audio/x-flac","audio/aac","audio/mp4","audio/ogg","audio/x-m4a"].map(a=>`mimeType='${a}'`).join(" or "),i=`'${e}' in parents and (${s}) and trashed=false`,o=await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(i)}&fields=files(id,name,mimeType,size,modifiedTime,videoMediaMetadata)&pageSize=1000`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!o.ok)throw o.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive folder. Please sign in again.")):new Error(`Failed to list folder contents: ${o.status}`);return(await o.json()).files||[]}catch(r){throw new Error(`Failed to list folder: ${r.message}`)}}async listFilesInFolder(e,n){const r=await this.getValidToken();try{const s=`'${e}' in parents and trashed=false`,i=await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(s)}&fields=files(id,name,mimeType)&pageSize=1000`,{headers:{Authorization:`Bearer ${r.access_token}`}});if(!i.ok)throw i.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive folder. Please sign in again.")):new Error(`Failed to list folder contents: ${i.status}`);const l=(await i.json()).files||[];return n?l.filter(a=>a.name.toLowerCase().endsWith(n.toLowerCase())):l}catch(s){throw new Error(`Failed to list folder: ${s.message}`)}}async downloadFileHeaders(e,n=102400){const r=await this.getValidToken();try{const s=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?alt=media`,{headers:{Authorization:`Bearer ${r.access_token}`,Range:`bytes=0-${n-1}`}});if(!s.ok&&s.status!==206)throw new Error(`Failed to download file headers: ${s.status}`);return await s.blob()}catch(s){throw new Error(`Failed to download headers: ${s.message}`)}}async getFileMetadata(e){if(e.videoMediaMetadata)return e;const n=await this.getValidToken();try{const r=await fetch(`https://www.googleapis.com/drive/v3/files/${e.id}?fields=name,mimeType,size,modifiedTime,videoMediaMetadata`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!r.ok)throw r.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive. Please sign in again and grant Drive access.")):new Error(`Failed to get file metadata: ${r.status}`);return await r.json()}catch(r){throw new Error(`Google Drive metadata fetch failed: ${r.message}`)}}signOut(){this.accessToken&&window.google&&window.google.accounts.oauth2.revoke(this.accessToken),this.accessToken=null,localStorage.removeItem("google_token")}isSignedIn(){const e=localStorage.getItem("google_token");if(!e)return!1;try{return JSON.parse(e).expires_at>Date.now()}catch{return!1}}}class Cs{constructor(){this.isInitialized=!1,this.accessToken=null,this.userInfo=null}async init(){this.isInitialized||(console.log("[Box Auth] Init started at:",new Date().toISOString()),await this.handleOAuthCallback(),console.log("[Box Auth] Init completed at:",new Date().toISOString()),this.isInitialized=!0)}async handleOAuthCallback(){const e=new URLSearchParams(window.location.search);if(e.has("code")){console.log("[Box OAuth] Callback received at:",new Date().toISOString());const n=e.get("code"),r=e.get("state"),s=localStorage.getItem("box_oauth_state");if(!s||s!==r)return console.error("OAuth state mismatch"),!1;console.log("[Box OAuth] State verified, exchanging code at:",new Date().toISOString());try{const i=await fetch(`${N.PROXY_URL}?action=token&code=${encodeURIComponent(n)}`);if(console.log("[Box OAuth] Token exchange response at:",new Date().toISOString(),"Status:",i.status),!i.ok){const a=await i.text();throw console.error("[Box OAuth] Token exchange failed:",a),new Error(`Token exchange failed: ${i.status}`)}const o=await i.json(),l={access_token:o.access_token,refresh_token:o.refresh_token,expires_at:Date.now()+o.expires_in*1e3};return localStorage.setItem("box_token",JSON.stringify(l)),this.accessToken=o.access_token,localStorage.setItem("box_just_authenticated","true"),window.history.replaceState({},document.title,window.location.pathname),!0}catch(i){return console.error("Failed to exchange authorization code:",i),!1}}return!1}async signIn(){this.isInitialized||await this.init();const e=Math.random().toString(36).substring(2,15);localStorage.setItem("box_oauth_state",e);const n=new URL(N.AUTHORIZATION_URL);n.searchParams.append("client_id",N.CLIENT_ID),n.searchParams.append("response_type","code"),n.searchParams.append("redirect_uri",N.REDIRECT_URI),n.searchParams.append("state",e),window.location.href=n.toString()}async getValidToken(){const e=localStorage.getItem("box_token");if(e)try{const n=JSON.parse(e);if(n.expires_at>Date.now()+3e5)return this.accessToken=n.access_token,n}catch(n){console.warn("Invalid stored token:",n),localStorage.removeItem("box_token")}throw new Error("Not signed in to Box")}async getUserInfo(){const e=await this.getValidToken();try{const n=await fetch(`${N.API_URL}/users/me`,{headers:{Authorization:`Bearer ${e.access_token}`}});if(!n.ok)throw new Error(`Failed to get user info: ${n.status}`);const r=await n.json();return this.userInfo=r,r}catch(n){throw new Error(`Failed to get user info: ${n.message}`)}}async downloadFile(e,n=null){try{const r=await this.getValidToken();console.log("[Box Download] Token retrieved:",r?"Yes":"No","Expires at:",new Date(r.expires_at).toISOString());const s={Authorization:`Bearer ${r.access_token}`};console.log("[Box Download] Fetching metadata for file:",e);const i=await fetch(`${N.API_URL}/files/${e}`,{headers:s});if(!i.ok){const u=await i.text();throw console.error("[Box Download] Metadata fetch failed:",i.status,u),i.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to get file metadata: ${i.status}`)}const o=await i.json();console.log("[Box Download] Metadata retrieved:",o.name),console.log("[Box Download] Downloading file content...");const l=await fetch(`${N.API_URL}/files/${e}/content`,{headers:s});if(!l.ok){const u=await l.text();throw console.error("[Box Download] File download failed:",l.status,u),new Error(`Failed to download file: ${l.status}`)}const a=await l.blob();return new File([a],o.name,{type:o.content_type||"audio/mpeg"})}catch(r){throw new Error(`Box download failed: ${r.message}`)}}async listAudioFilesInFolder(e,n=null){try{const r=`${N.API_URL}/folders/${e}/items?fields=id,name,type,size,modified_at&limit=1000`;let s=`${N.PROXY_URL}?url=${encodeURIComponent(r)}`;if(n)s+=`&boxapi=${encodeURIComponent(n)}`;else{const f=await this.getValidToken();s+=`&token=${encodeURIComponent(f.access_token)}`}const i=await fetch(s);if(!i.ok)throw!n&&i.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to list folder contents: ${i.status}`);const l=(await i.json()).entries||[],a=[".mp3",".wav",".flac",".aac",".m4a",".ogg"];return l.filter(f=>{if(f.type!=="file")return!1;const g=f.name.toLowerCase();return a.some(d=>g.endsWith(d))})}catch(r){throw new Error(`Failed to list folder: ${r.message}`)}}async listFilesInFolder(e,n,r=null){try{const s={};if(r)s.BoxApi=`shared_link=${r}`;else{const u=await this.getValidToken();s.Authorization=`Bearer ${u.access_token}`}const i=await fetch(`${N.API_URL}/folders/${e}/items?fields=id,name,type&limit=1000`,{headers:s});if(!i.ok)throw!r&&i.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to list folder contents: ${i.status}`);let a=((await i.json()).entries||[]).filter(u=>u.type==="file");return n&&(a=a.filter(u=>u.name.toLowerCase().endsWith(n.toLowerCase()))),a}catch(s){throw new Error(`Failed to list folder: ${s.message}`)}}async downloadFileHeaders(e,n=102400,r=null){try{const s={Range:`bytes=0-${n-1}`};if(r)s.BoxApi=`shared_link=${r}`;else{const o=await this.getValidToken();s.Authorization=`Bearer ${o.access_token}`}const i=await fetch(`${N.API_URL}/files/${e}/content`,{headers:s});if(!i.ok&&i.status!==206)throw new Error(`Failed to download file headers: ${i.status}`);return await i.blob()}catch(s){throw new Error(`Failed to download headers: ${s.message}`)}}async getFileMetadata(e,n=null){try{const r={};if(n)r.BoxApi=`shared_link=${n}`;else{const i=await this.getValidToken();r.Authorization=`Bearer ${i.access_token}`}const s=await fetch(`${N.API_URL}/files/${e.id}?fields=id,name,size,modified_at,content_type`,{headers:r});if(!s.ok)throw!n&&s.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to get file metadata: ${s.status}`);return await s.json()}catch(r){throw new Error(`Box metadata fetch failed: ${r.message}`)}}signOut(){this.accessToken=null,this.userInfo=null,localStorage.removeItem("box_token"),localStorage.removeItem("box_oauth_state")}isSignedIn(){const e=localStorage.getItem("box_token");if(!e)return!1;try{return JSON.parse(e).expires_at>Date.now()}catch{return!1}}}class be{constructor(){this.authStateStore=sn({google:{isAuthenticated:!1,isInitialized:!1,userInfo:null,error:null},box:{isAuthenticated:!1,isInitialized:!1,error:null}}),this.googleAuth=new Rs,this.boxAuth=new Cs,this.authState={subscribe:e=>this.authStateStore.subscribe(e)},this.isGoogleAuthenticated=$t(this.authStateStore,e=>e.google.isAuthenticated),this.isBoxAuthenticated=$t(this.authStateStore,e=>e.box.isAuthenticated),this.googleUserInfo=$t(this.authStateStore,e=>e.google.userInfo),this.initialize()}static getInstance(){return be.instance||(be.instance=new be),be.instance}async initialize(){try{if(await this.googleAuth.init(),this.updateGoogleState({isInitialized:!0}),this.googleAuth.isSignedIn()){const e=await this.googleAuth.getUserInfo();this.updateGoogleState({isAuthenticated:!0,userInfo:e})}}catch(e){console.error("Failed to initialize Google auth:",e),this.updateGoogleState({error:e instanceof Error?e:new Error(String(e))})}try{await this.boxAuth.init(),this.updateBoxState({isInitialized:!0}),this.boxAuth.isSignedIn()&&this.updateBoxState({isAuthenticated:!0})}catch(e){console.error("Failed to initialize Box auth:",e),this.updateBoxState({error:e instanceof Error?e:new Error(String(e))})}}async signInGoogle(){try{await this.googleAuth.signIn();const e=await this.googleAuth.getUserInfo();this.updateGoogleState({isAuthenticated:!0,userInfo:e,error:null})}catch(e){const n=e instanceof Error?e:new Error(String(e));throw this.updateGoogleState({error:n}),n}}async signOutGoogle(){try{await this.googleAuth.signOut(),this.updateGoogleState({isAuthenticated:!1,userInfo:null,error:null})}catch(e){const n=e instanceof Error?e:new Error(String(e));throw this.updateGoogleState({error:n}),n}}async signInBox(){try{await this.boxAuth.signIn(),this.updateBoxState({isAuthenticated:!0,error:null})}catch(e){const n=e instanceof Error?e:new Error(String(e));throw this.updateBoxState({error:n}),n}}async signOutBox(){try{await this.boxAuth.signOut(),this.updateBoxState({isAuthenticated:!1,error:null})}catch(e){const n=e instanceof Error?e:new Error(String(e));throw this.updateBoxState({error:n}),n}}getGoogleAuthInstance(){return this.googleAuth}getBoxAuthInstance(){return this.boxAuth}isGoogleAuthenticatedSync(){return this.googleAuth.isSignedIn()}isBoxAuthenticatedSync(){return this.boxAuth.isSignedIn()}updateGoogleState(e){this.authStateStore.update(n=>({...n,google:{...n.google,...e}}))}updateBoxState(e){this.authStateStore.update(n=>({...n,box:{...n.box,...e}}))}resetState(){this.authStateStore.set({google:{isAuthenticated:!1,isInitialized:!1,userInfo:null,error:null},box:{isAuthenticated:!1,isInitialized:!1,error:null}})}}let Ft=null;function or(){return Ft||(Ft=be.getInstance()),Ft}or();const Bs={subscribe:t=>or().authState.subscribe(t)};var Ps=xt('<p style="margin-top: 1rem;" class="svelte-nejbyb"> </p>'),Ns=xt('<p style="margin-top: 1rem;" class="svelte-nejbyb">✅ Signed in to Box</p>'),Ls=xt('<div class="app sv-app svelte-nejbyb"><header class="header svelte-nejbyb"><div class="header-content svelte-nejbyb"><div class="header-spacer svelte-nejbyb"></div> <h1 class="logo svelte-nejbyb">🎵 Audio Analyzer</h1> <button class="dark-mode-toggle svelte-nejbyb" aria-label="Toggle dark mode"><span class="light-icon svelte-nejbyb">🌙</span> <span class="dark-icon svelte-nejbyb">☀️</span></button></div></header> <main class="main svelte-nejbyb"><div class="container svelte-nejbyb"><!> <div class="tab-content-placeholder svelte-nejbyb"><h3 class="svelte-nejbyb"> </h3> <p class="svelte-nejbyb">Tab content will be implemented in Phase 5.3+</p> <!> <!></div></div></main> <footer class="footer svelte-nejbyb"><div class="container svelte-nejbyb"><p id="buildInfo" class="svelte-nejbyb">Audio Analyzer - Phase 5.2b App Shell</p></div></footer></div>');function js(t,e){Wt(e,!1);const n=()=>zt(Mt,"$currentTab",s),r=()=>zt(Bs,"$authState",s),[s,i]=sr();function o(){const C=document.documentElement,pe=C.getAttribute("data-theme")==="dark";C.setAttribute("data-theme",pe?"light":"dark"),localStorage.setItem("theme",pe?"light":"dark")}if(typeof window<"u"){const C=localStorage.getItem("theme");C&&document.documentElement.setAttribute("data-theme",C)}rr();var l=Ls(),a=Z(l),u=Z(a),f=_e(Z(u),4),g=_e(a,2),d=Z(g),h=Z(d);$s(h,{});var p=_e(h,2),m=Z(p),I=Z(m),M=_e(m,4);{var R=C=>{var pe=Ps(),lr=Z(pe);jt(()=>_n(lr,`✅ Signed in as ${r().google.userInfo?.email??""}`)),dt(C,pe)};wn(M,C=>{n()==="googleDrive"&&r().google.isAuthenticated&&C(R)})}var at=_e(M,2);{var ar=C=>{var pe=Ns();dt(C,pe)};wn(at,C=>{n()==="box"&&r().box.isAuthenticated&&C(ar)})}jt(()=>_n(I,`Current Tab: ${n()??""}`)),ht("click",f,o),dt(t,l),Jt(),i()}class Gs{constructor(){this.unsubscribers=[],this.bridge=we.getInstance(),this.authService=be.getInstance(),this.attachEventListeners()}attachEventListeners(){this.unsubscribers.push(this.bridge.on("auth:google:signin:requested",()=>this.handleGoogleSignIn())),this.unsubscribers.push(this.bridge.on("auth:google:signout:requested",()=>this.handleGoogleSignOut())),this.unsubscribers.push(this.bridge.on("auth:box:signin:requested",()=>this.handleBoxSignIn())),this.unsubscribers.push(this.bridge.on("auth:box:signout:requested",()=>this.handleBoxSignOut())),this.unsubscribers.push(this.bridge.on("file:local:selected",e=>{console.log("[ServiceCoordinator] File selected:",e.file.name)})),this.unsubscribers.push(this.bridge.on("file:drive:requested",e=>{console.log("[ServiceCoordinator] Google Drive file requested:",e.url)})),this.unsubscribers.push(this.bridge.on("file:box:requested",e=>{console.log("[ServiceCoordinator] Box file requested:",e.url)}))}async handleGoogleSignIn(){try{await this.authService.signInGoogle();const n=await this.authService.getGoogleAuthInstance().getUserInfo();this.bridge.dispatch({type:"auth:google:signin:success",userInfo:n})}catch(e){this.bridge.dispatch({type:"auth:google:signin:error",error:e instanceof Error?e:new Error(String(e))})}}async handleGoogleSignOut(){try{await this.authService.signOutGoogle(),this.bridge.dispatch({type:"auth:google:signout:success"})}catch(e){this.bridge.dispatch({type:"auth:google:signout:error",error:e instanceof Error?e:new Error(String(e))})}}async handleBoxSignIn(){try{await this.authService.signInBox(),this.bridge.dispatch({type:"auth:box:signin:success"})}catch(e){this.bridge.dispatch({type:"auth:box:signin:error",error:e instanceof Error?e:new Error(String(e))})}}async handleBoxSignOut(){try{await this.authService.signOutBox(),this.bridge.dispatch({type:"auth:box:signout:success"})}catch(e){this.bridge.dispatch({type:"auth:box:signout:error",error:e instanceof Error?e:new Error(String(e))})}}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[]}}new Gs;_s(js,{target:document.getElementById("app")});
