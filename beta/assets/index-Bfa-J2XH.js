var Ia=Object.defineProperty;var or=n=>{throw TypeError(n)};var ka=(n,e,t)=>e in n?Ia(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var bt=(n,e,t)=>ka(n,typeof e!="symbol"?e+"":e,t),Rn=(n,e,t)=>e.has(n)||or("Cannot "+t);var y=(n,e,t)=>(Rn(n,e,"read from private field"),t?t.call(n):e.get(n)),q=(n,e,t)=>e.has(n)?or("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),O=(n,e,t,r)=>(Rn(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),te=(n,e,t)=>(Rn(n,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=t(a);fetch(a.href,i)}})();const kr=!1;var Xt=Array.isArray,Aa=Array.prototype.indexOf,Wn=Array.from,dn=Object.defineProperty,kt=Object.getOwnPropertyDescriptor,Ar=Object.getOwnPropertyDescriptors,xa=Object.prototype,Da=Array.prototype,Hn=Object.getPrototypeOf,lr=Object.isExtensible;const Ne=()=>{};function Ta(n){return n()}function hn(n){for(var e=0;e<n.length;e++)n[e]()}function xr(){var n,e,t=new Promise((r,a)=>{n=r,e=a});return{promise:t,resolve:n,reject:e}}function Ra(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const r of n)if(t.push(r),t.length===e)break;return t}const fe=2,Dr=4,yn=8,gt=16,Ue=32,pt=64,Jn=128,we=256,vn=512,ee=1024,ge=2048,qe=4096,Te=8192,mt=16384,Yn=32768,Sn=65536,cr=1<<17,Fa=1<<18,Mt=1<<19,Tr=1<<20,$n=1<<21,En=1<<22,ct=1<<23,Xe=Symbol("$state"),Ca=Symbol("legacy props"),Oa=Symbol(""),Ut=new class extends Error{constructor(){super(...arguments);bt(this,"name","StaleReactionError");bt(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Rr(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function $a(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ba(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ma(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Pa(n){throw new Error("https://svelte.dev/e/effect_orphan")}function La(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Na(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function za(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ua(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function qa(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ja(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Va=1,Ga=2,Wa=16,Ha=1,Ja=2,Ya=4,Xa=8,Ka=16,Za=1,Qa=2,Q=Symbol(),ei="http://www.w3.org/1999/xhtml";function ti(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function ni(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let ri=!1;function Fr(n){return n===this.v}function Cr(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Or(n){return!Cr(n,this.v)}let Pt=!1,ai=!1;function ii(){Pt=!0}let W=null;function Ot(n){W=n}function Qe(n,e=!1,t){W={p:W,c:null,e:null,s:n,x:null,l:Pt&&!e?{s:null,u:null,$:[]}:null}}function et(n){var e=W,t=e.e;if(t!==null){e.e=null;for(var r of t)Wr(r)}return W=e.p,{}}function Kt(){return!Pt||W!==null&&W.l===null}let St=[];function si(){var n=St;St=[],hn(n)}function Vt(n){if(St.length===0){var e=St;queueMicrotask(()=>{e===St&&si()})}St.push(n)}const oi=new WeakMap;function $r(n){var e=N;if(e===null)return L.f|=ct,n;if((e.f&Yn)===0){if((e.f&Jn)===0)throw!e.parent&&n instanceof Error&&Br(n),n;e.b.error(n)}else $t(n,e)}function $t(n,e){for(;e!==null;){if((e.f&Jn)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&Br(n),n}function Br(n){const e=oi.get(n);e&&(dn(n,"message",{value:e.message}),dn(n,"stack",{value:e.stack}))}const an=new Set;let X=null,Bn=new Set,Ge=[],Xn=null,Mn=!1;var Dt,Tt,at,Ht,Rt,Ft,it,Ct,Jt,Yt,Se,Pn,on,Ln;const It=class It{constructor(){q(this,Se);bt(this,"current",new Map);q(this,Dt,new Map);q(this,Tt,new Set);q(this,at,0);q(this,Ht,null);q(this,Rt,[]);q(this,Ft,[]);q(this,it,[]);q(this,Ct,[]);q(this,Jt,[]);q(this,Yt,[]);bt(this,"skipped_effects",new Set)}process(e){Ge=[];var t=It.apply(this);for(const i of e)te(this,Se,Pn).call(this,i);if(y(this,at)===0){te(this,Se,Ln).call(this);var r=y(this,Ft),a=y(this,it);O(this,Ft,[]),O(this,it,[]),O(this,Ct,[]),X=null,ur(r),ur(a),y(this,Ht)?.resolve()}else te(this,Se,on).call(this,y(this,Ft)),te(this,Se,on).call(this,y(this,it)),te(this,Se,on).call(this,y(this,Ct));t();for(const i of y(this,Rt))Bt(i);O(this,Rt,[])}capture(e,t){y(this,Dt).has(e)||y(this,Dt).set(e,t),this.current.set(e,e.v)}activate(){X=this}deactivate(){X=null}flush(){if(Ge.length>0){if(this.activate(),li(),X!==null&&X!==this)return}else y(this,at)===0&&te(this,Se,Ln).call(this);this.deactivate();for(const e of Bn)if(Bn.delete(e),e(),X!==null)break}increment(){O(this,at,y(this,at)+1)}decrement(){O(this,at,y(this,at)-1);for(const e of y(this,Jt))ne(e,ge),ht(e);for(const e of y(this,Yt))ne(e,qe),ht(e);this.flush()}add_callback(e){y(this,Tt).add(e)}settled(){return(y(this,Ht)??O(this,Ht,xr())).promise}static ensure(){if(X===null){const e=X=new It;an.add(X),It.enqueue(()=>{X===e&&e.flush()})}return X}static enqueue(e){Vt(e)}static apply(e){return Ne}};Dt=new WeakMap,Tt=new WeakMap,at=new WeakMap,Ht=new WeakMap,Rt=new WeakMap,Ft=new WeakMap,it=new WeakMap,Ct=new WeakMap,Jt=new WeakMap,Yt=new WeakMap,Se=new WeakSet,Pn=function(e){e.f^=ee;for(var t=e.first;t!==null;){var r=t.f,a=(r&(Ue|pt))!==0,i=a&&(r&ee)!==0,s=i||(r&Te)!==0||this.skipped_effects.has(t);if(!s&&t.fn!==null){a?t.f^=ee:(r&Dr)!==0?y(this,it).push(t):(r&ee)===0&&((r&En)!==0&&t.b?.is_pending()?y(this,Rt).push(t):tn(t)&&((t.f&gt)!==0&&y(this,Ct).push(t),Bt(t)));var o=t.first;if(o!==null){t=o;continue}}var l=t.parent;for(t=t.next;t===null&&l!==null;)t=l.next,l=l.parent}},on=function(e){for(const t of e)((t.f&ge)!==0?y(this,Jt):y(this,Yt)).push(t),ne(t,ee);e.length=0},Ln=function(){var e;for(const t of y(this,Tt))t();if(y(this,Tt).clear(),an.size>1){y(this,Dt).clear();let t=!0;for(const r of an){if(r===this){t=!1;continue}for(const[a,i]of this.current){if(r.current.has(a))if(t)r.current.set(a,i);else continue;Mr(a)}if(Ge.length>0){X=r;const a=It.apply(r);for(const i of Ge)te(e=r,Se,Pn).call(e,i);Ge=[],a()}}X=null}an.delete(this)};let Pe=It;function li(){var n=xt;Mn=!0;try{var e=0;for(vr(!0);Ge.length>0;){var t=Pe.ensure();if(e++>1e3){var r,a;ci()}t.process(Ge),Ke.clear()}}finally{Mn=!1,vr(n),Xn=null}}function ci(){try{La()}catch(n){$t(n,Xn)}}let nt=null;function ur(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(mt|Te))===0&&tn(r)&&(nt=[],Bt(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?Yr(r):r.fn=null),nt?.length>0)){Ke.clear();for(const a of nt)Bt(a);nt=[]}}nt=null}}function Mr(n){if(n.reactions!==null)for(const e of n.reactions){const t=e.f;(t&fe)!==0?Mr(e):(t&(En|gt))!==0&&(ne(e,ge),ht(e))}}function ht(n){for(var e=Xn=n;e.parent!==null;){e=e.parent;var t=e.f;if(Mn&&e===N&&(t&gt)!==0)return;if((t&(pt|Ue))!==0){if((t&ee)===0)return;e.f^=ee}}Ge.push(e)}function ui(n){let e=0,t=vt(0),r;return()=>{Di()&&(b(t),xn(()=>(e===0&&(r=$(()=>n(()=>qt(t)))),e+=1,()=>{Vt(()=>{e-=1,e===0&&(r?.(),r=void 0,qt(t))})})))}}var fi=Sn|Mt|Jn;function di(n,e,t){new hi(n,e,t)}var ke,_e,Gn,Ce,st,Oe,be,ce,$e,We,ot,He,lt,Je,bn,wn,se,vi,gi,ln,cn,Nn;class hi{constructor(e,t,r){q(this,se);bt(this,"parent");q(this,ke,!1);q(this,_e);q(this,Gn,null);q(this,Ce);q(this,st);q(this,Oe);q(this,be,null);q(this,ce,null);q(this,$e,null);q(this,We,null);q(this,ot,0);q(this,He,0);q(this,lt,!1);q(this,Je,null);q(this,bn,()=>{y(this,Je)&&Gt(y(this,Je),y(this,ot))});q(this,wn,ui(()=>(O(this,Je,vt(y(this,ot))),()=>{O(this,Je,null)})));O(this,_e,e),O(this,Ce,t),O(this,st,r),this.parent=N.b,O(this,ke,!!y(this,Ce).pending),O(this,Oe,Qn(()=>{N.b=this;{try{O(this,be,Ae(()=>r(y(this,_e))))}catch(a){this.error(a)}y(this,He)>0?te(this,se,cn).call(this):O(this,ke,!1)}},fi))}is_pending(){return y(this,ke)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!y(this,Ce).pending}update_pending_count(e){te(this,se,Nn).call(this,e),O(this,ot,y(this,ot)+e),Bn.add(y(this,bn))}get_effect_pending(){return y(this,wn).call(this),b(y(this,Je))}error(e){var t=y(this,Ce).onerror;let r=y(this,Ce).failed;if(y(this,lt)||!t&&!r)throw e;y(this,be)&&(ye(y(this,be)),O(this,be,null)),y(this,ce)&&(ye(y(this,ce)),O(this,ce,null)),y(this,$e)&&(ye(y(this,$e)),O(this,$e,null));var a=!1,i=!1;const s=()=>{if(a){ni();return}a=!0,i&&ja(),Pe.ensure(),O(this,ot,0),y(this,$e)!==null&&At(y(this,$e),()=>{O(this,$e,null)}),O(this,ke,this.has_pending_snippet()),O(this,be,te(this,se,ln).call(this,()=>(O(this,lt,!1),Ae(()=>y(this,st).call(this,y(this,_e)))))),y(this,He)>0?te(this,se,cn).call(this):O(this,ke,!1)};var o=L;try{ue(null),i=!0,t?.(e,s),i=!1}catch(l){$t(l,y(this,Oe)&&y(this,Oe).parent)}finally{ue(o)}r&&Vt(()=>{O(this,$e,te(this,se,ln).call(this,()=>{O(this,lt,!0);try{return Ae(()=>{r(y(this,_e),()=>e,()=>s)})}catch(l){return $t(l,y(this,Oe).parent),null}finally{O(this,lt,!1)}}))})}}ke=new WeakMap,_e=new WeakMap,Gn=new WeakMap,Ce=new WeakMap,st=new WeakMap,Oe=new WeakMap,be=new WeakMap,ce=new WeakMap,$e=new WeakMap,We=new WeakMap,ot=new WeakMap,He=new WeakMap,lt=new WeakMap,Je=new WeakMap,bn=new WeakMap,wn=new WeakMap,se=new WeakSet,vi=function(){try{O(this,be,Ae(()=>y(this,st).call(this,y(this,_e))))}catch(e){this.error(e)}O(this,ke,!1)},gi=function(){const e=y(this,Ce).pending;e&&(O(this,ce,Ae(()=>e(y(this,_e)))),Pe.enqueue(()=>{O(this,be,te(this,se,ln).call(this,()=>(Pe.ensure(),Ae(()=>y(this,st).call(this,y(this,_e)))))),y(this,He)>0?te(this,se,cn).call(this):(At(y(this,ce),()=>{O(this,ce,null)}),O(this,ke,!1))}))},ln=function(e){var t=N,r=L,a=W;Me(y(this,Oe)),ue(y(this,Oe)),Ot(y(this,Oe).ctx);try{return e()}catch(i){return $r(i),null}finally{Me(t),ue(r),Ot(a)}},cn=function(){const e=y(this,Ce).pending;y(this,be)!==null&&(O(this,We,document.createDocumentFragment()),pi(y(this,be),y(this,We))),y(this,ce)===null&&O(this,ce,Ae(()=>e(y(this,_e))))},Nn=function(e){var t;if(!this.has_pending_snippet()){this.parent&&te(t=this.parent,se,Nn).call(t,e);return}O(this,He,y(this,He)+e),y(this,He)===0&&(O(this,ke,!1),y(this,ce)&&At(y(this,ce),()=>{O(this,ce,null)}),y(this,We)&&(y(this,_e).before(y(this,We)),O(this,We,null)),Vt(()=>{Pe.ensure().flush()}))};function pi(n,e){for(var t=n.nodes_start,r=n.nodes_end;t!==null;){var a=t===r?null:en(t);e.append(t),t=a}}function mi(n,e,t){const r=Kt()?Zt:In;if(e.length===0){t(n.map(r));return}var a=X,i=N,s=_i();Promise.all(e.map(o=>bi(o))).then(o=>{s();try{t([...n.map(r),...o])}catch(l){(i.f&mt)===0&&$t(l,i)}a?.deactivate(),Pr()}).catch(o=>{$t(o,i)})}function _i(){var n=N,e=L,t=W,r=X;return function(){Me(n),ue(e),Ot(t),r?.activate()}}function Pr(){Me(null),ue(null),Ot(null)}function Zt(n){var e=fe|ge,t=L!==null&&(L.f&fe)!==0?L:null;return N===null||t!==null&&(t.f&we)!==0?e|=we:N.f|=Mt,{ctx:W,deps:null,effects:null,equals:Fr,f:e,fn:n,reactions:null,rv:0,v:Q,wv:0,parent:t??N,ac:null}}function bi(n,e){let t=N;t===null&&$a();var r=t.b,a=void 0,i=vt(Q),s=!L,o=new Map;return Fi(()=>{var l=xr();a=l.promise;try{Promise.resolve(n()).then(l.resolve,l.reject)}catch(u){l.reject(u)}var c=X,f=r.is_pending();s&&(r.update_pending_count(1),f||(c.increment(),o.get(c)?.reject(Ut),o.set(c,l)));const d=(u,g=void 0)=>{f||c.activate(),g?g!==Ut&&(i.f|=ct,Gt(i,g)):((i.f&ct)!==0&&(i.f^=ct),Gt(i,u)),s&&(r.update_pending_count(-1),f||c.decrement()),Pr()};l.promise.then(d,u=>d(null,u||"unknown"))}),An(()=>{for(const l of o.values())l.reject(Ut)}),new Promise(l=>{function c(f){function d(){f===a?l(i):c(a)}f.then(d,d)}c(a)})}function wi(n){const e=Zt(n);return Zr(e),e}function In(n){const e=Zt(n);return e.equals=Or,e}function Lr(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)ye(e[t])}}function yi(n){for(var e=n.parent;e!==null;){if((e.f&fe)===0)return e;e=e.parent}return null}function Kn(n){var e,t=N;Me(yi(n));try{Lr(n),e=na(n)}finally{Me(t)}return e}function Nr(n){var e=Kn(n);if(n.equals(e)||(n.v=e,n.wv=ea()),!_t){var t=(Ye||(n.f&we)!==0)&&n.deps!==null?qe:ee;ne(n,t)}}const Ke=new Map;function vt(n,e){var t={f:0,v:n,reactions:null,equals:Fr,rv:0,wv:0};return t}function Ve(n,e){const t=vt(n);return Zr(t),t}function Be(n,e=!1,t=!0){var a;const r=vt(n);return e||(r.equals=Or),Pt&&t&&W!==null&&W.l!==null&&((a=W.l).s??(a.s=[])).push(r),r}function H(n,e,t=!1){L!==null&&(!De||(L.f&cr)!==0)&&Kt()&&(L.f&(fe|gt|En|cr))!==0&&!ze?.includes(n)&&qa();let r=t?Et(e):e;return Gt(n,r)}function Gt(n,e){if(!n.equals(e)){var t=n.v;_t?Ke.set(n,e):Ke.set(n,t),n.v=e;var r=Pe.ensure();r.capture(n,t),(n.f&fe)!==0&&((n.f&ge)!==0&&Kn(n),ne(n,(n.f&we)===0?ee:qe)),n.wv=ea(),zr(n,ge),Kt()&&N!==null&&(N.f&ee)!==0&&(N.f&(Ue|pt))===0&&(me===null?$i([n]):me.push(n))}return e}function qt(n){H(n,n.v+1)}function zr(n,e){var t=n.reactions;if(t!==null)for(var r=Kt(),a=t.length,i=0;i<a;i++){var s=t[i],o=s.f;if(!(!r&&s===N)){var l=(o&ge)===0;l&&ne(s,e),(o&fe)!==0?zr(s,qe):l&&((o&gt)!==0&&nt!==null&&nt.push(s),ht(s))}}}function Et(n){if(typeof n!="object"||n===null||Xe in n)return n;const e=Hn(n);if(e!==xa&&e!==Da)return n;var t=new Map,r=Xt(n),a=Ve(0),i=ut,s=o=>{if(ut===i)return o();var l=L,c=ut;ue(null),pr(i);var f=o();return ue(l),pr(c),f};return r&&t.set("length",Ve(n.length)),new Proxy(n,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&za();var f=t.get(l);return f===void 0?f=s(()=>{var d=Ve(c.value);return t.set(l,d),d}):H(f,c.value,!0),!0},deleteProperty(o,l){var c=t.get(l);if(c===void 0){if(l in o){const f=s(()=>Ve(Q));t.set(l,f),qt(a)}}else H(c,Q),qt(a);return!0},get(o,l,c){if(l===Xe)return n;var f=t.get(l),d=l in o;if(f===void 0&&(!d||kt(o,l)?.writable)&&(f=s(()=>{var g=Et(d?o[l]:Q),h=Ve(g);return h}),t.set(l,f)),f!==void 0){var u=b(f);return u===Q?void 0:u}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var f=t.get(l);f&&(c.value=b(f))}else if(c===void 0){var d=t.get(l),u=d?.v;if(d!==void 0&&u!==Q)return{enumerable:!0,configurable:!0,value:u,writable:!0}}return c},has(o,l){if(l===Xe)return!0;var c=t.get(l),f=c!==void 0&&c.v!==Q||Reflect.has(o,l);if(c!==void 0||N!==null&&(!f||kt(o,l)?.writable)){c===void 0&&(c=s(()=>{var u=f?Et(o[l]):Q,g=Ve(u);return g}),t.set(l,c));var d=b(c);if(d===Q)return!1}return f},set(o,l,c,f){var d=t.get(l),u=l in o;if(r&&l==="length")for(var g=c;g<d.v;g+=1){var h=t.get(g+"");h!==void 0?H(h,Q):g in o&&(h=s(()=>Ve(Q)),t.set(g+"",h))}if(d===void 0)(!u||kt(o,l)?.writable)&&(d=s(()=>Ve(void 0)),H(d,Et(c)),t.set(l,d));else{u=d.v!==Q;var v=s(()=>Et(c));H(d,v)}var p=Reflect.getOwnPropertyDescriptor(o,l);if(p?.set&&p.set.call(f,c),!u){if(r&&typeof l=="string"){var w=t.get("length"),S=Number(l);Number.isInteger(S)&&S>=w.v&&H(w,S+1)}qt(a)}return!0},ownKeys(o){b(a);var l=Reflect.ownKeys(o).filter(d=>{var u=t.get(d);return u===void 0||u.v!==Q});for(var[c,f]of t)f.v!==Q&&!(c in o)&&l.push(c);return l},setPrototypeOf(){Ua()}})}function fr(n){try{if(n!==null&&typeof n=="object"&&Xe in n)return n[Xe]}catch{}return n}function Si(n,e){return Object.is(fr(n),fr(e))}var dr,Ur,qr,jr;function Ei(){if(dr===void 0){dr=window,Ur=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;qr=kt(e,"firstChild").get,jr=kt(e,"nextSibling").get,lr(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),lr(t)&&(t.__t=void 0)}}function Qt(n=""){return document.createTextNode(n)}function gn(n){return qr.call(n)}function en(n){return jr.call(n)}function D(n,e){return gn(n)}function ie(n,e=!1){{var t=gn(n);return t instanceof Comment&&t.data===""?en(t):t}}function x(n,e=1,t=!1){let r=n;for(;e--;)r=en(r);return r}function Ii(n){n.textContent=""}function Vr(){return!1}let hr=!1;function ki(){hr||(hr=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function kn(n){var e=L,t=N;ue(null),Me(null);try{return n()}finally{ue(e),Me(t)}}function Ai(n,e,t,r=t){n.addEventListener(e,()=>kn(t));const a=n.__on_r;a?n.__on_r=()=>{a(),r(!0)}:n.__on_r=()=>r(!0),ki()}function Gr(n){N===null&&L===null&&Pa(),L!==null&&(L.f&we)!==0&&N===null&&Ma(),_t&&Ba()}function xi(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function je(n,e,t,r=!0){var a=N;a!==null&&(a.f&Te)!==0&&(n|=Te);var i={ctx:W,deps:null,nodes_start:null,nodes_end:null,f:n|ge,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{Bt(i),i.f|=Yn}catch(l){throw ye(i),l}else e!==null&&ht(i);if(r){var s=i;if(t&&s.deps===null&&s.teardown===null&&s.nodes_start===null&&s.first===s.last&&(s.f&Mt)===0&&(s=s.first),s!==null&&(s.parent=a,a!==null&&xi(s,a),L!==null&&(L.f&fe)!==0&&(n&pt)===0)){var o=L;(o.effects??(o.effects=[])).push(s)}}return i}function Di(){return L!==null&&!De}function An(n){const e=je(yn,null,!1);return ne(e,ee),e.teardown=n,e}function zn(n){Gr();var e=N.f,t=!L&&(e&Ue)!==0&&(e&Yn)===0;if(t){var r=W;(r.e??(r.e=[])).push(n)}else return Wr(n)}function Wr(n){return je(Dr|Tr,n,!1)}function Ti(n){return Gr(),je(yn|Tr,n,!0)}function Ri(n){Pe.ensure();const e=je(pt|Mt,n,!0);return(t={})=>new Promise(r=>{t.outro?At(e,()=>{ye(e),r(void 0)}):(ye(e),r(void 0))})}function pn(n,e){var t=W,r={effect:null,ran:!1,deps:n};t.l.$.push(r),r.effect=xn(()=>{n(),!r.ran&&(r.ran=!0,$(e))})}function Zn(){var n=W;xn(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&ee)!==0&&ne(t,qe),tn(t)&&Bt(t),e.ran=!1}})}function Fi(n){return je(En|Mt,n,!0)}function xn(n,e=0){return je(yn|e,n,!0)}function K(n,e=[],t=[]){mi(e,t,r=>{je(yn,()=>n(...r.map(b)),!0)})}function Qn(n,e=0){var t=je(gt|e,n,!0);return t}function Ae(n,e=!0){return je(Ue|Mt,n,!0,e)}function Hr(n){var e=n.teardown;if(e!==null){const t=_t,r=L;gr(!0),ue(null);try{e.call(null)}finally{gr(t),ue(r)}}}function Jr(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const a=t.ac;a!==null&&kn(()=>{a.abort(Ut)});var r=t.next;(t.f&pt)!==0?t.parent=null:ye(t,e),t=r}}function Ci(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Ue)===0&&ye(e),e=t}}function ye(n,e=!0){var t=!1;(e||(n.f&Fa)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(Oi(n.nodes_start,n.nodes_end),t=!0),Jr(n,e&&!t),mn(n,0),ne(n,mt);var r=n.transitions;if(r!==null)for(const i of r)i.stop();Hr(n);var a=n.parent;a!==null&&a.first!==null&&Yr(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function Oi(n,e){for(;n!==null;){var t=n===e?null:en(n);n.remove(),n=t}}function Yr(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function At(n,e){var t=[];er(n,t,!0),Xr(t,()=>{ye(n),e&&e()})}function Xr(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var a of n)a.out(r)}else e()}function er(n,e,t){if((n.f&Te)===0){if(n.f^=Te,n.transitions!==null)for(const s of n.transitions)(s.is_global||t)&&e.push(s);for(var r=n.first;r!==null;){var a=r.next,i=(r.f&Sn)!==0||(r.f&Ue)!==0;er(r,e,i?t:!1),r=a}}}function tr(n){Kr(n,!0)}function Kr(n,e){if((n.f&Te)!==0){n.f^=Te,(n.f&ee)===0&&(ne(n,ge),ht(n));for(var t=n.first;t!==null;){var r=t.next,a=(t.f&Sn)!==0||(t.f&Ue)!==0;Kr(t,a?e:!1),t=r}if(n.transitions!==null)for(const i of n.transitions)(i.is_global||e)&&i.in()}}let xt=!1;function vr(n){xt=n}let _t=!1;function gr(n){_t=n}let L=null,De=!1;function ue(n){L=n}let N=null;function Me(n){N=n}let ze=null;function Zr(n){L!==null&&(ze===null?ze=[n]:ze.push(n))}let ae=null,de=0,me=null;function $i(n){me=n}let Qr=1,Wt=0,ut=Wt;function pr(n){ut=n}let Ye=!1;function ea(){return++Qr}function tn(n){var e=n.f;if((e&ge)!==0)return!0;if((e&qe)!==0){var t=n.deps,r=(e&we)!==0;if(t!==null){var a,i,s=(e&vn)!==0,o=r&&N!==null&&!Ye,l=t.length;if((s||o)&&(N===null||(N.f&mt)===0)){var c=n,f=c.parent;for(a=0;a<l;a++)i=t[a],(s||!i?.reactions?.includes(c))&&(i.reactions??(i.reactions=[])).push(c);s&&(c.f^=vn),o&&f!==null&&(f.f&we)===0&&(c.f^=we)}for(a=0;a<l;a++)if(i=t[a],tn(i)&&Nr(i),i.wv>n.wv)return!0}(!r||N!==null&&!Ye)&&ne(n,ee)}return!1}function ta(n,e,t=!0){var r=n.reactions;if(r!==null&&!ze?.includes(n))for(var a=0;a<r.length;a++){var i=r[a];(i.f&fe)!==0?ta(i,e,!1):e===i&&(t?ne(i,ge):(i.f&ee)!==0&&ne(i,qe),ht(i))}}function na(n){var v;var e=ae,t=de,r=me,a=L,i=Ye,s=ze,o=W,l=De,c=ut,f=n.f;ae=null,de=0,me=null,Ye=(f&we)!==0&&(De||!xt||L===null),L=(f&(Ue|pt))===0?n:null,ze=null,Ot(n.ctx),De=!1,ut=++Wt,n.ac!==null&&(kn(()=>{n.ac.abort(Ut)}),n.ac=null);try{n.f|=$n;var d=n.fn,u=d(),g=n.deps;if(ae!==null){var h;if(mn(n,de),g!==null&&de>0)for(g.length=de+ae.length,h=0;h<ae.length;h++)g[de+h]=ae[h];else n.deps=g=ae;if(!Ye||(f&fe)!==0&&n.reactions!==null)for(h=de;h<g.length;h++)((v=g[h]).reactions??(v.reactions=[])).push(n)}else g!==null&&de<g.length&&(mn(n,de),g.length=de);if(Kt()&&me!==null&&!De&&g!==null&&(n.f&(fe|qe|ge))===0)for(h=0;h<me.length;h++)ta(me[h],n);return a!==null&&a!==n&&(Wt++,me!==null&&(r===null?r=me:r.push(...me))),(n.f&ct)!==0&&(n.f^=ct),u}catch(p){return $r(p)}finally{n.f^=$n,ae=e,de=t,me=r,L=a,Ye=i,ze=s,Ot(o),De=l,ut=c}}function Bi(n,e){let t=e.reactions;if(t!==null){var r=Aa.call(t,n);if(r!==-1){var a=t.length-1;a===0?t=e.reactions=null:(t[r]=t[a],t.pop())}}t===null&&(e.f&fe)!==0&&(ae===null||!ae.includes(e))&&(ne(e,qe),(e.f&(we|vn))===0&&(e.f^=vn),Lr(e),mn(e,0))}function mn(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)Bi(n,t[r])}function Bt(n){var e=n.f;if((e&mt)===0){ne(n,ee);var t=N,r=xt;N=n,xt=!0;try{(e&gt)!==0?Ci(n):Jr(n),Hr(n);var a=na(n);n.teardown=typeof a=="function"?a:null,n.wv=Qr;var i;kr&&ai&&(n.f&ge)!==0&&n.deps}finally{xt=r,N=t}}}function b(n){var e=n.f,t=(e&fe)!==0;if(L!==null&&!De){var r=N!==null&&(N.f&mt)!==0;if(!r&&!ze?.includes(n)){var a=L.deps;if((L.f&$n)!==0)n.rv<Wt&&(n.rv=Wt,ae===null&&a!==null&&a[de]===n?de++:ae===null?ae=[n]:(!Ye||!ae.includes(n))&&ae.push(n));else{(L.deps??(L.deps=[])).push(n);var i=n.reactions;i===null?n.reactions=[L]:i.includes(L)||i.push(L)}}}else if(t&&n.deps===null&&n.effects===null){var s=n,o=s.parent;o!==null&&(o.f&we)===0&&(s.f^=we)}if(_t){if(Ke.has(n))return Ke.get(n);if(t){s=n;var l=s.v;return((s.f&ee)===0&&s.reactions!==null||ra(s))&&(l=Kn(s)),Ke.set(s,l),l}}else t&&(s=n,tn(s)&&Nr(s));if((n.f&ct)!==0)throw n.v;return n.v}function ra(n){if(n.v===Q)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(Ke.has(e)||(e.f&fe)!==0&&ra(e))return!0;return!1}function $(n){var e=De;try{return De=!0,n()}finally{De=e}}const Mi=-7169;function ne(n,e){n.f=n.f&Mi|e}function jt(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(Xe in n)Un(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&Xe in t&&Un(t)}}}function Un(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{Un(n[r],e)}catch{}const t=Hn(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Ar(t);for(let a in r){const i=r[a].get;if(i)try{i.call(n)}catch{}}}}}const Pi=["touchstart","touchmove"];function Li(n){return Pi.includes(n)}const Ni=new Set,mr=new Set;function zi(n,e,t,r={}){function a(i){if(r.capture||zt.call(e,i),!i.cancelBubble)return kn(()=>t?.call(this,i))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Vt(()=>{e.addEventListener(n,a,r)}):e.addEventListener(n,a,r),a}function ve(n,e,t,r,a){var i={capture:r,passive:a},s=zi(n,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&An(()=>{e.removeEventListener(n,s,i)})}let _r=null;function zt(n){var e=this,t=e.ownerDocument,r=n.type,a=n.composedPath?.()||[],i=a[0]||n.target;_r=n;var s=0,o=_r===n&&n.__root;if(o){var l=a.indexOf(o);if(l!==-1&&(e===document||e===window)){n.__root=e;return}var c=a.indexOf(e);if(c===-1)return;l<=c&&(s=l)}if(i=a[s]||n.target,i!==e){dn(n,"currentTarget",{configurable:!0,get(){return i||t}});var f=L,d=N;ue(null),Me(null);try{for(var u,g=[];i!==null;){var h=i.assignedSlot||i.parentNode||i.host||null;try{var v=i["__"+r];if(v!=null&&(!i.disabled||n.target===i))if(Xt(v)){var[p,...w]=v;p.apply(i,[n,...w])}else v.call(i,n)}catch(S){u?g.push(S):u=S}if(n.cancelBubble||h===e||h===null)break;i=h}if(u){for(let S of g)queueMicrotask(()=>{throw S});throw u}}finally{n.__root=e,delete n.currentTarget,ue(f),Me(d)}}}function Ui(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function qn(n,e){var t=N;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function z(n,e){var t=(e&Za)!==0,r=(e&Qa)!==0,a,i=!n.startsWith("<!>");return()=>{a===void 0&&(a=Ui(i?n:"<!>"+n),t||(a=gn(a)));var s=r||Ur?document.importNode(a,!0):a.cloneNode(!0);if(t){var o=gn(s),l=s.lastChild;qn(o,l)}else qn(s,s);return s}}function un(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Qt();return n.append(e,t),qn(e,t),n}function B(n,e){n!==null&&n.before(e)}function Z(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=t,n.nodeValue=t+"")}function qi(n,e){return ji(n,e)}const wt=new Map;function ji(n,{target:e,anchor:t,props:r={},events:a,context:i,intro:s=!0}){Ei();var o=new Set,l=d=>{for(var u=0;u<d.length;u++){var g=d[u];if(!o.has(g)){o.add(g);var h=Li(g);e.addEventListener(g,zt,{passive:h});var v=wt.get(g);v===void 0?(document.addEventListener(g,zt,{passive:h}),wt.set(g,1)):wt.set(g,v+1)}}};l(Wn(Ni)),mr.add(l);var c=void 0,f=Ri(()=>{var d=t??e.appendChild(Qt());return di(d,{pending:()=>{}},u=>{if(i){Qe({});var g=W;g.c=i}a&&(r.$$events=a),c=n(u,r)||{},i&&et()}),()=>{for(var u of o){e.removeEventListener(u,zt);var g=wt.get(u);--g===0?(document.removeEventListener(u,zt),wt.delete(u)):wt.set(u,g)}mr.delete(l),d!==t&&d.parentNode?.removeChild(d)}});return Vi.set(c,f),c}let Vi=new WeakMap;function j(n,e,t=!1){var r=n,a=null,i=null,s=Q,o=t?Sn:0,l=!1;const c=(g,h=!0)=>{l=!0,u(h,g)};var f=null;function d(){f!==null&&(f.lastChild.remove(),r.before(f),f=null);var g=s?a:i,h=s?i:a;g&&tr(g),h&&At(h,()=>{s?i=null:a=null})}const u=(g,h)=>{if(s!==(s=g)){var v=Vr(),p=r;if(v&&(f=document.createDocumentFragment(),f.append(p=Qt())),s?a??(a=h&&Ae(()=>h(p))):i??(i=h&&Ae(()=>h(p))),v){var w=X,S=s?a:i,m=s?i:a;S&&w.skipped_effects.delete(S),m&&w.skipped_effects.add(m),w.add_callback(d)}else d()}};Qn(()=>{l=!1,e(c),l||u(null,null)},o)}function aa(n,e){return e}function Gi(n,e,t){for(var r=n.items,a=[],i=e.length,s=0;s<i;s++)er(e[s].e,a,!0);var o=i>0&&a.length===0&&t!==null;if(o){var l=t.parentNode;Ii(l),l.append(t),r.clear(),Fe(n,e[0].prev,e[i-1].next)}Xr(a,()=>{for(var c=0;c<i;c++){var f=e[c];o||(r.delete(f.k),Fe(n,f.prev,f.next)),ye(f.e,!o)}})}function ia(n,e,t,r,a,i=null){var s=n,o={flags:e,items:new Map,first:null};{var l=n;s=l.appendChild(Qt())}var c=null,f=!1,d=new Map,u=In(()=>{var p=t();return Xt(p)?p:p==null?[]:Wn(p)}),g,h;function v(){Wi(h,g,o,d,s,a,e,r,t),i!==null&&(g.length===0?c?tr(c):c=Ae(()=>i(s)):c!==null&&At(c,()=>{c=null}))}Qn(()=>{h??(h=N),g=b(u);var p=g.length;if(!(f&&p===0)){f=p===0;var w,S,m,I;if(Vr()){var E=new Set,_=X;for(S=0;S<p;S+=1){m=g[S],I=r(m,S);var A=o.items.get(I)??d.get(I);A?sa(A,m,S):(w=oa(null,o,null,null,m,I,S,a,e,t,!0),d.set(I,w)),E.add(I)}for(const[F,T]of o.items)E.has(F)||_.skipped_effects.add(T.e);_.add_callback(v)}else v();b(u)}})}function Wi(n,e,t,r,a,i,s,o,l){var c=e.length,f=t.items,d=t.first,u=d,g,h=null,v=[],p=[],w,S,m,I;for(I=0;I<c;I+=1){if(w=e[I],S=o(w,I),m=f.get(S),m===void 0){var E=r.get(S);if(E!==void 0){r.delete(S),f.set(S,E);var _=h?h.next:u;Fe(t,h,E),Fe(t,E,_),Fn(E,_,a),h=E}else{var A=u?u.e.nodes_start:a;h=oa(A,t,h,h===null?t.first:h.next,w,S,I,i,s,l)}f.set(S,h),v=[],p=[],u=h.next;continue}if(sa(m,w,I),(m.e.f&Te)!==0&&tr(m.e),m!==u){if(g!==void 0&&g.has(m)){if(v.length<p.length){var F=p[0],T;h=F.prev;var R=v[0],M=v[v.length-1];for(T=0;T<v.length;T+=1)Fn(v[T],F,a);for(T=0;T<p.length;T+=1)g.delete(p[T]);Fe(t,R.prev,M.next),Fe(t,h,R),Fe(t,M,F),u=F,h=M,I-=1,v=[],p=[]}else g.delete(m),Fn(m,u,a),Fe(t,m.prev,m.next),Fe(t,m,h===null?t.first:h.next),Fe(t,h,m),h=m;continue}for(v=[],p=[];u!==null&&u.k!==S;)(u.e.f&Te)===0&&(g??(g=new Set)).add(u),p.push(u),u=u.next;if(u===null)continue;m=u}v.push(m),h=m,u=m.next}if(u!==null||g!==void 0){for(var U=g===void 0?[]:Wn(g);u!==null;)(u.e.f&Te)===0&&U.push(u),u=u.next;var V=U.length;if(V>0){var oe=c===0?a:null;Gi(t,U,oe)}}n.first=t.first&&t.first.e,n.last=h&&h.e;for(var k of r.values())ye(k.e);r.clear()}function sa(n,e,t,r){Gt(n.v,e),n.i=t}function oa(n,e,t,r,a,i,s,o,l,c,f){var d=(l&Va)!==0,u=(l&Wa)===0,g=d?u?Be(a,!1,!1):vt(a):a,h=(l&Ga)===0?s:vt(s),v={i:h,v:g,k:i,a:null,e:null,prev:t,next:r};try{if(n===null){var p=document.createDocumentFragment();p.append(n=Qt())}return v.e=Ae(()=>o(n,g,h,c),ri),v.e.prev=t&&t.e,v.e.next=r&&r.e,t===null?f||(e.first=v):(t.next=v,t.e.next=v.e),r!==null&&(r.prev=v,r.e.prev=v.e),v}finally{}}function Fn(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,a=e?e.e.nodes_start:t,i=n.e.nodes_start;i!==null&&i!==r;){var s=en(i);a.before(i),i=s}}function Fe(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const br=[...` 	
\r\f \v\uFEFF`];function Hi(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var a in t)if(t[a])r=r?r+" "+a:a;else if(r.length)for(var i=a.length,s=0;(s=r.indexOf(a,s))>=0;){var o=s+i;(s===0||br.includes(r[s-1]))&&(o===r.length||br.includes(r[o]))?r=(s===0?"":r.substring(0,s))+r.substring(o+1):s=o}}return r===""?null:r}function xe(n,e,t,r,a,i){var s=n.__className;if(s!==t||s===void 0){var o=Hi(t,r,i);o==null?n.removeAttribute("class"):n.className=o,n.__className=t}else if(i&&a!==i)for(var l in i){var c=!!i[l];(a==null||c!==!!a[l])&&n.classList.toggle(l,c)}return i}function la(n,e,t=!1){if(n.multiple){if(e==null)return;if(!Xt(e))return ti();for(var r of n.options)r.selected=e.includes(wr(r));return}for(r of n.options){var a=wr(r);if(Si(a,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function Ji(n){var e=new MutationObserver(()=>{la(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),An(()=>{e.disconnect()})}function wr(n){return"__value"in n?n.__value:n.value}const Yi=Symbol("is custom element"),Xi=Symbol("is html");function he(n,e,t,r){var a=Ki(n);a[e]!==(a[e]=t)&&(e==="loading"&&(n[Oa]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Zi(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Ki(n){return n.__attributes??(n.__attributes={[Yi]:n.nodeName.includes("-"),[Xi]:n.namespaceURI===ei})}var yr=new Map;function Zi(n){var e=n.getAttribute("is")||n.nodeName,t=yr.get(e);if(t)return t;yr.set(e,t=[]);for(var r,a=n,i=Element.prototype;i!==a;){r=Ar(a);for(var s in r)r[s].set&&t.push(s);a=Hn(a)}return t}function Qi(n,e,t=e){Ai(n,"change",r=>{var a=r?n.defaultChecked:n.checked;t(a)}),$(e)==null&&t(n.checked),xn(()=>{var r=e();n.checked=!!r})}function Sr(n){return function(...e){var t=e[0];return t.preventDefault(),n?.apply(this,e)}}function Lt(n=!1){const e=W,t=e.l.u;if(!t)return;let r=()=>jt(e.s);if(n){let a=0,i={};const s=Zt(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==i[c]&&(i[c]=l[c],o=!0);return o&&a++,a});r=()=>b(s)}t.b.length&&Ti(()=>{Er(e,r),hn(t.b)}),zn(()=>{const a=$(()=>t.m.map(Ta));return()=>{for(const i of a)typeof i=="function"&&i()}}),t.a.length&&zn(()=>{Er(e,r),hn(t.a)})}function Er(n,e){if(n.l.s)for(const t of n.l.s)b(t);e()}function es(n,e){var t=n.$$events?.[e.type],r=Xt(t)?t.slice():t==null?[]:[t];for(var a of r)a.call(this,e)}function nr(n,e,t){if(n==null)return e(void 0),t&&t(void 0),Ne;const r=$(()=>n.subscribe(e,t));return r.unsubscribe?()=>r.unsubscribe():r}const yt=[];function ts(n,e){return{subscribe:nn(n,e).subscribe}}function nn(n,e=Ne){let t=null;const r=new Set;function a(o){if(Cr(n,o)&&(n=o,t)){const l=!yt.length;for(const c of r)c[1](),yt.push(c,n);if(l){for(let c=0;c<yt.length;c+=2)yt[c][0](yt[c+1]);yt.length=0}}}function i(o){a(o(n))}function s(o,l=Ne){const c=[o,l];return r.add(c),r.size===1&&(t=e(a,i)||Ne),o(n),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:a,update:i,subscribe:s}}function fn(n,e,t){const r=!Array.isArray(n),a=r?[n]:n;if(!a.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=e.length<2;return ts(t,(s,o)=>{let l=!1;const c=[];let f=0,d=Ne;const u=()=>{if(f)return;d();const h=e(r?c[0]:c,s,o);i?s(h):d=typeof h=="function"?h:Ne},g=a.map((h,v)=>nr(h,p=>{c[v]=p,f&=~(1<<v),l&&u()},()=>{f|=1<<v}));return l=!0,u(),function(){hn(g),d(),l=!1}})}function ns(n){let e;return nr(n,t=>e=t)(),e}let sn=!1,jn=Symbol();function Ze(n,e,t){const r=t[e]??(t[e]={store:null,source:Be(void 0),unsubscribe:Ne});if(r.store!==n&&!(jn in t))if(r.unsubscribe(),r.store=n??null,n==null)r.source.v=void 0,r.unsubscribe=Ne;else{var a=!0;r.unsubscribe=nr(n,i=>{a?r.source.v=i:H(r.source,i)}),a=!1}return n&&jn in t?ns(n):b(r.source)}function Nt(){const n={};function e(){An(()=>{for(var t in n)n[t].unsubscribe();dn(n,jn,{enumerable:!1,value:!0})})}return[n,e]}function rs(n){var e=sn;try{return sn=!1,[n(),sn]}finally{sn=e}}function ft(n,e,t,r){var a=!Pt||(t&Ja)!==0,i=(t&Xa)!==0,s=(t&Ka)!==0,o=r,l=!0,c=()=>(l&&(l=!1,o=s?$(r):r),o),f;if(i){var d=Xe in n||Ca in n;f=kt(n,e)?.set??(d&&e in n?m=>n[e]=m:void 0)}var u,g=!1;i?[u,g]=rs(()=>n[e]):u=n[e],u===void 0&&r!==void 0&&(u=c(),f&&(a&&Na(),f(u)));var h;if(a?h=()=>{var m=n[e];return m===void 0?c():(l=!0,m)}:h=()=>{var m=n[e];return m!==void 0&&(o=void 0),m===void 0?o:m},a&&(t&Ya)===0)return h;if(f){var v=n.$$legacy;return(function(m,I){return arguments.length>0?((!a||!I||v||g)&&f(I?h():m),m):h()})}var p=!1,w=((t&Ha)!==0?Zt:In)(()=>(p=!1,h()));i&&b(w);var S=N;return(function(m,I){if(arguments.length>0){const E=I?b(w):a&&i?Et(m):m;return H(w,E),p=!0,o!==void 0&&(o=E),m}return _t&&p||(S.f&mt)!==0?w.v:b(w)})}function as(n){W===null&&Rr(),Pt&&W.l!==null?ss(W).m.push(n):zn(()=>{const e=$(n);if(typeof e=="function")return e})}function is(n){W===null&&Rr(),as(()=>()=>$(n))}function ss(n){var e=n.l;return e.u??(e.u={a:[],b:[],m:[]})}const os="5";var Ir;typeof window<"u"&&((Ir=window.__svelte??(window.__svelte={})).v??(Ir.v=new Set)).add(os);ii();function ls(){const{subscribe:n,set:e}=nn("local");return{subscribe:n,setTab:t=>e(t)}}const _n=ls();class Le extends EventTarget{constructor(){super(),this.setupDebugLogging()}static getInstance(){return Le.instance||(Le.instance=new Le),Le.instance}dispatch(e){const t=new CustomEvent("app:event",{detail:e,bubbles:!1,cancelable:!1});this.dispatchEvent(t)}on(e,t){const r=a=>{const i=a;i.detail.type===e&&t(i.detail)};return this.addEventListener("app:event",r),()=>this.removeEventListener("app:event",r)}onAll(e){const t=r=>{e(r.detail)};return this.addEventListener("app:event",t),()=>this.removeEventListener("app:event",t)}once(e,t){let r=null;const a=i=>{t(i),r&&r()};return r=this.on(e,a),r}clearAllListeners(){const e=this._listeners;e&&Object.keys(e).forEach(t=>{delete e[t]})}setupDebugLogging(){typeof window<"u"&&localStorage.getItem("debugBridge")==="true"&&this.onAll(e=>{console.log("[AppBridge]",e.type,e)})}}typeof window<"u"&&(window.enableBridgeDebug=()=>{localStorage.setItem("debugBridge","true"),console.log("AppBridge debug logging enabled. Reload the page to see events.")},window.disableBridgeDebug=()=>{localStorage.removeItem("debugBridge"),console.log("AppBridge debug logging disabled.")});var cs=z('<nav class="tabs sv-tab-nav svelte-1mmy281" aria-label="Main navigation"><button>📁 Local Files</button> <button>☁️ Google Drive</button> <button>📦 Box</button> <button>⚙️ Settings</button></nav>');function us(n,e){Qe(e,!1);const t=()=>Ze(_n,"$currentTab",r),[r,a]=Nt(),i=Le.getInstance();function s(p){_n.setTab(p),i.dispatch({type:"tab:changed",tab:p})}Lt();var o=cs(),l=D(o);let c;var f=x(l,2);let d;var u=x(f,2);let g;var h=x(u,2);let v;K((p,w,S,m)=>{c=xe(l,1,"tab-button svelte-1mmy281",null,c,p),he(l,"aria-current",t()==="local"?"page":void 0),d=xe(f,1,"tab-button svelte-1mmy281",null,d,w),he(f,"aria-current",t()==="googleDrive"?"page":void 0),g=xe(u,1,"tab-button svelte-1mmy281",null,g,S),he(u,"aria-current",t()==="box"?"page":void 0),v=xe(h,1,"tab-button svelte-1mmy281",null,v,m),he(h,"aria-current",t()==="settings"?"page":void 0)},[()=>({active:t()==="local"}),()=>({active:t()==="googleDrive"}),()=>({active:t()==="box"}),()=>({active:t()==="settings"})]),ve("click",l,()=>s("local")),ve("click",f,()=>s("googleDrive")),ve("click",u,()=>s("box")),ve("click",h,()=>s("settings")),B(n,o),et(),a()}var fs=z("<p>Processing...</p>"),ds=z('<div class="file-upload-wrapper svelte-heqs4d"><label class="file-upload-label svelte-heqs4d">Upload a file</label> <input type="file"/> <!></div>');function hs(n,e){let t=ft(e,"id",8),r=ft(e,"processing",8,!1),a=ft(e,"accept",8,"audio/*");var i=ds(),s=D(i),o=x(s,2),l=x(o,2);{var c=f=>{var d=fs();B(f,d)};j(l,f=>{r()&&f(c)})}K(()=>{he(s,"for",t()),he(o,"id",t()),he(o,"accept",a()),o.disabled=r()}),ve("change",o,function(f){es.call(this,e,f)}),B(n,i)}var vs=z("<span> </span>");function gs(n,e){Qe(e,!1);const t=Be();let r=ft(e,"status",8);const a={pass:{icon:"✓",class:"badge-success",text:"Pass"},fail:{icon:"✗",class:"badge-danger",text:"Fail"},warning:{icon:"⚠",class:"badge-warning",text:"Warning"},error:{icon:"✗",class:"badge-danger",text:"Error"}};pn(()=>jt(r()),()=>{H(t,a[r()]||a.error)}),Zn();var i=vs(),s=D(i);K(()=>{xe(i,1,`badge ${b(t),$(()=>b(t).class)??""}`,"svelte-1hqr9xd"),Z(s,`${b(t),$(()=>b(t).icon)??""} ${b(t),$(()=>b(t).text)??""}`)}),B(n,i),et()}var ps=z('<div class="batch-summary svelte-1bx7qjq"><h3>Summary</h3> <p> </p></div>'),ms=z('<th class="svelte-1bx7qjq">Sample Rate</th> <th class="svelte-1bx7qjq">Bit Depth</th> <th class="svelte-1bx7qjq">Channels</th> <th class="svelte-1bx7qjq">Duration</th>',1),_s=z('<th class="svelte-1bx7qjq">Play</th>'),bs=z("<td> </td> <td> </td> <td> </td> <td> </td>",1),ws=z("<audio controls></audio>"),ys=z('<td class="svelte-1bx7qjq"><!></td>'),Ss=z('<tr><td class="svelte-1bx7qjq"> </td><td class="svelte-1bx7qjq"><!></td><!><td> </td><!></tr>'),Es=z('<div class="results-container svelte-1bx7qjq"><!> <table class="results-table svelte-1bx7qjq"><thead><tr><th class="svelte-1bx7qjq">Filename</th><th class="svelte-1bx7qjq">Status</th><!><th class="svelte-1bx7qjq">File Size</th><!></tr></thead><tbody class="svelte-1bx7qjq"></tbody></table></div>');function Is(n,e){Qe(e,!1);const t=Be(),r=Be();let a=ft(e,"results",24,()=>[]),i=ft(e,"mode",8,"single"),s=ft(e,"metadataOnly",8,!1);function o(E,_){return E.validation&&E.validation[_]?.status||null}function l(E,_){if(E.validation)return E.validation[_]?.issue}function c(E,_=2){if(E===0)return"0 Bytes";const A=1024,F=_<0?0:_,T=["Bytes","KB","MB","GB","TB"],R=Math.floor(Math.log(E)/Math.log(A));return parseFloat((E/Math.pow(A,R)).toFixed(F))+" "+T[R]}pn(()=>jt(i()),()=>{H(t,i()==="single")}),pn(()=>(jt(i()),jt(a())),()=>{H(r,i()==="batch"?{total:a().length,passed:a().filter(E=>E.status==="pass").length,failed:a().filter(E=>E.status==="fail").length,warnings:a().filter(E=>E.status==="warning").length,errors:a().filter(E=>E.status==="error").length}:null)}),Zn(),Lt();var f=Es(),d=D(f);{var u=E=>{var _=ps(),A=x(D(_),2),F=D(A);K(()=>Z(F,`${b(r),$(()=>b(r).total)??""} files: ${b(r),$(()=>b(r).passed)??""} passed, ${b(r),$(()=>b(r).failed)??""} failed`)),B(E,_)};j(d,E=>{i()==="batch"&&b(r)&&E(u)})}var g=x(d,2),h=D(g),v=D(h),p=x(D(v),2);{var w=E=>{var _=ms();B(E,_)};j(p,E=>{s()||E(w)})}var S=x(p,2);{var m=E=>{var _=_s();B(E,_)};j(S,E=>{b(t)&&E(m)})}var I=x(h);ia(I,5,a,aa,(E,_)=>{var A=Ss();let F;var T=D(A),R=D(T),M=x(T),U=D(M);gs(U,{get status(){return b(_),$(()=>b(_).status)}});var V=x(M);{var oe=re=>{var Re=bs(),le=ie(Re);let Ee;var Ie=D(le),tt=x(le,2);let ar;var ha=D(tt),rn=x(tt,2);let ir;var va=D(rn),Tn=x(rn,2);let sr;var ga=D(Tn);K((pa,ma,_a,ba,wa,ya,Sa,Ea)=>{he(le,"title",pa),Ee=xe(le,1,"svelte-1bx7qjq",null,Ee,ma),Z(Ie,`${b(_),$(()=>b(_).sampleRate)??""} Hz`),he(tt,"title",_a),ar=xe(tt,1,"svelte-1bx7qjq",null,ar,ba),Z(ha,`${b(_),$(()=>b(_).bitDepth)??""} bit`),he(rn,"title",wa),ir=xe(rn,1,"svelte-1bx7qjq",null,ir,ya),Z(va,(b(_),$(()=>b(_).channels))),he(Tn,"title",Sa),sr=xe(Tn,1,"svelte-1bx7qjq",null,sr,Ea),Z(ga,`${b(_),$(()=>b(_).duration)??""}s`)},[()=>(b(_),$(()=>l(b(_),"sampleRate"))),()=>({"validation-pass":o(b(_),"sampleRate")==="pass","validation-warning":o(b(_),"sampleRate")==="warning","validation-fail":o(b(_),"sampleRate")==="fail","validation-issue":l(b(_),"sampleRate")}),()=>(b(_),$(()=>l(b(_),"bitDepth"))),()=>({"validation-pass":o(b(_),"bitDepth")==="pass","validation-warning":o(b(_),"bitDepth")==="warning","validation-fail":o(b(_),"bitDepth")==="fail","validation-issue":l(b(_),"bitDepth")}),()=>(b(_),$(()=>l(b(_),"channels"))),()=>({"validation-pass":o(b(_),"channels")==="pass","validation-warning":o(b(_),"channels")==="warning","validation-fail":o(b(_),"channels")==="fail","validation-issue":l(b(_),"channels")}),()=>(b(_),$(()=>l(b(_),"duration"))),()=>({"validation-pass":o(b(_),"duration")==="pass","validation-warning":o(b(_),"duration")==="warning","validation-fail":o(b(_),"duration")==="fail","validation-issue":l(b(_),"duration")})]),B(re,Re)};j(V,re=>{s()||re(oe)})}var k=x(V);let C;var P=D(k),J=x(k);{var G=re=>{var Re=ys(),le=D(Re);{var Ee=Ie=>{var tt=ws();K(()=>he(tt,"src",(b(_),$(()=>b(_).audioUrl)))),B(Ie,tt)};j(le,Ie=>{b(_),$(()=>b(_).audioUrl)&&Ie(Ee)})}B(re,Re)};j(J,re=>{b(t)&&re(G)})}K((re,Re,le,Ee)=>{F=xe(A,1,"svelte-1bx7qjq",null,F,re),Z(R,(b(_),$(()=>b(_).filename))),he(k,"title",Re),C=xe(k,1,"svelte-1bx7qjq",null,C,le),Z(P,Ee)},[()=>({"status-pass":b(_).status==="pass","status-warning":b(_).status==="warning","status-fail":b(_).status==="fail"}),()=>(b(_),$(()=>l(b(_),"fileType"))),()=>({"validation-pass":o(b(_),"fileType")==="pass","validation-warning":o(b(_),"fileType")==="warning","validation-fail":o(b(_),"fileType")==="fail","validation-issue":l(b(_),"fileType")}),()=>(b(_),$(()=>c(b(_).fileSize)))]),B(E,A)}),B(n,f),et()}class ks{constructor(){this.audioContext=null,this.audioBuffer=null}async analyzeFile(e){const t=await e.arrayBuffer();if(e.name.toLowerCase().endsWith(".wav")){const r=new DataView(t),a=this.parseWavHeaders(r);let i=this.getFileType(e.name);return i==="WAV"&&(a.audioFormat===1?i="WAV (PCM)":typeof a.audioFormat=="number"?i=`WAV (Compressed - Format ${a.audioFormat})`:i="WAV (Unknown Format)"),{fileType:i,sampleRate:a.sampleRate,channels:a.channels,bitDepth:a.bitDepth,duration:a.duration,fileSize:e.size}}this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));try{const r=t.slice(0);return this.audioBuffer=await this.audioContext.decodeAudioData(r),{fileType:this.getFileType(e.name),sampleRate:this.audioBuffer.sampleRate,channels:this.audioBuffer.numberOfChannels,duration:this.audioBuffer.duration,fileSize:e.size,bitDepth:this.estimateBitDepth(t,e.name)}}catch{return await this.analyzeFileHeaders(t,e.name,e.size)}}async analyzeFileHeaders(e,t,r){const a=new DataView(e),i={fileType:this.getFileType(t),fileSize:r};if(t.toLowerCase().endsWith(".wav")){const s=this.parseWavHeaders(a);Object.assign(i,s)}else i.sampleRate="Unknown",i.bitDepth="Unknown",i.channels="Unknown",i.duration="Unknown";return i}parseWavHeaders(e){try{if(String.fromCharCode(e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3))!=="RIFF")throw new Error("Not a valid WAV file");if(String.fromCharCode(e.getUint8(8),e.getUint8(9),e.getUint8(10),e.getUint8(11))!=="WAVE")throw new Error("Not a valid WAV file");let a=12;for(;a<e.byteLength-8;){const i=String.fromCharCode(e.getUint8(a),e.getUint8(a+1),e.getUint8(a+2),e.getUint8(a+3)),s=e.getUint32(a+4,!0);if(i==="fmt "){const o=e.getUint16(a+8,!0),l=e.getUint16(a+10,!0),c=e.getUint32(a+12,!0),f=e.getUint16(a+22,!0),d=this.calculateWavDuration(e,c,l,f);return{sampleRate:c,channels:l,bitDepth:f,duration:d,audioFormat:o}}a+=8+s}throw new Error("fmt chunk not found")}catch(t){return console.error("Error parsing WAV headers:",t),{sampleRate:"Unknown",channels:"Unknown",bitDepth:"Unknown",duration:"Unknown",audioFormat:"Unknown"}}}calculateWavDuration(e,t,r,a){try{let i=12;for(;i<e.byteLength-8;){const s=String.fromCharCode(e.getUint8(i),e.getUint8(i+1),e.getUint8(i+2),e.getUint8(i+3)),o=e.getUint32(i+4,!0);if(s==="data"){const l=a/8;return o/(r*l)/t}i+=8+o}return"Unknown"}catch{return"Unknown"}}getFileType(e){const t=e.split(".").pop().toLowerCase();return{wav:"WAV",mp3:"MP3",flac:"FLAC",aac:"AAC",m4a:"M4A",ogg:"OGG",webm:"WebM"}[t]||t.toUpperCase()}estimateBitDepth(e,t){if(t.toLowerCase().endsWith(".wav"))return"See WAV analysis";const r=t.split(".").pop().toLowerCase();return["mp3","aac","m4a"].includes(r)?"Compressed (variable)":"Unknown"}}class As{constructor(){this.analysisInProgress=!1}async analyzeAudioBuffer(e,t=null){const r=e.sampleRate,a=e.numberOfChannels,i=e.length,s=[];for(let o=0;o<a;o++)s.push(e.getChannelData(o));this.analysisInProgress=!0;try{t&&t("Analyzing peak levels...",0);let o=0;for(let w=0;w<a;w++){const S=s[w];for(let m=0;m<i;m++){if(!this.analysisInProgress)throw new Error("Analysis cancelled");const I=Math.abs(S[m]);if(I>o&&(o=I),m%1e4===0){const E=(w*i+m)/(a*i)*.5;t&&t("Analyzing peak levels...",E),m%1e5===0&&await new Promise(_=>setTimeout(_,1))}}}const l=o>0?20*Math.log10(o):-1/0;t&&t("Analyzing noise floor...",.5);const c=await this.analyzeNoiseFloor(s,a,i,t),f=await this.analyzeNoiseFloorHistogram(s,a,i);t&&t("Checking normalization...",.9);const d=this.checkNormalization(l);t&&t("Estimating reverb...",.95);const u=await this.estimateReverb(s,a,i,r,f),g=this.interpretReverb(u);t&&t("Analyzing silence...",.98);const{leadingSilence:h,trailingSilence:v,longestSilence:p}=this.analyzeSilence(s,a,i,r,f,l);return t&&t("Analysis complete!",1),{peakDb:l,noiseFloorDb:c,noiseFloorDbHistogram:f,normalizationStatus:d,reverbInfo:g,leadingSilence:h,trailingSilence:v,longestSilence:p}}finally{this.analysisInProgress=!1}}interpretReverb(e){return e<=0?{time:e,label:"N/A",description:"No reverb detected."}:e<.3?{time:e,label:"Excellent (Dry)",description:"Ideal for voiceover. Matches a vocal booth or well-treated studio environment."}:e<.5?{time:e,label:"Good (Controlled)",description:"A well-controlled room with minimal reflections. Acceptable for most recording."}:e<.8?{time:e,label:"Fair (Slightly Live)",description:"Noticeable room reflections. May reduce clarity for voiceover work."}:e<1.2?{time:e,label:"Poor (Reverberant)",description:"Significant reverb is present, making the recording sound distant and unprofessional."}:{time:e,label:"Very Poor (Echoey)",description:"Excessive echo and reverb. Unsuitable for professional voice recording."}}analyzeSilence(e,t,r,a,i,s){const o=s-i,l=.25,c=Math.max(0,o),f=i+c*l,d=Math.pow(10,f/20),u=50,g=Math.floor(a*(u/1e3)),h=Math.ceil(r/g),p=Math.ceil(150/u),w=new Array(h).fill(0);for(let R=0;R<h;R++){const M=R*g,U=Math.min(M+g,r);let V=0;for(let oe=0;oe<t;oe++){const k=e[oe];for(let C=M;C<U;C++){const P=Math.abs(k[C]);P>V&&(V=P)}}V>d&&(w[R]=1)}let S=0;for(let R=0;R<h;R++)if(w[R]===1)S++;else{if(S>0&&S<p)for(let M=1;M<=S;M++)w[R-M]=0;S=0}if(S>0&&S<p)for(let R=1;R<=S;R++)w[h-R]=0;let m=0,I=0;for(let R=0;R<h;R++)w[R]===0?I++:(I>m&&(m=I),I=0);I>m&&(m=I);const E=m*(u/1e3),_=w.indexOf(1),A=w.lastIndexOf(1);let F=0,T=0;return _===-1?(F=r/a,T=r/a):(F=_*(u/1e3),T=(h-1-A)*(u/1e3)),{leadingSilence:F,trailingSilence:T,longestSilence:E}}async estimateReverb(e,t,r,a,i){const c=Math.floor(a*.02),f=-25;let d=[];const u=e[0];let g=0;for(let p=0;p<r-1024;p+=1024){let w=0;for(let m=p;m<p+1024;m++)w+=u[m]*u[m];const S=Math.sqrt(w/1024);if(S>g*1.5&&S>.01){let m=0,I=p;for(let _=p;_<p+1024;_++)Math.abs(u[_])>m&&(m=Math.abs(u[_]),I=_);const E=20*Math.log10(m);if(E>i+10){let _=-1;for(let A=I;A<r-c;A+=c){let F=0;for(let M=A;M<A+c;M++)F+=u[M]*u[M];const T=Math.sqrt(F/c);if((T>0?20*Math.log10(T):-120)<E+f){_=A;break}}if(_!==-1){const A=(_-I)/a;if(A>0){const F=A*(60/Math.abs(f));d.push(F)}}}}g=S}if(d.length<1)return 0;d.sort((p,w)=>p-w);const h=Math.floor(d.length/2);return d.length%2!==0?d[h]:(d[h-1]+d[h])/2}async analyzeNoiseFloorHistogram(e,t,r){const i=new Array(100).fill(0),s=-100,o=100,l=Math.floor(44100*.05);for(let u=0;u<t;u++){const g=e[u];for(let h=0;h<r;h+=l){const v=Math.min(h+l,r);let p=0;for(let m=h;m<v;m++)p+=g[m]*g[m];const w=Math.sqrt(p/(v-h)),S=w>0?20*Math.log10(w):s;if(S>=s){const m=Math.min(Math.floor((S-s)/o*100),99);i[m]++}}}let c=-1,f=0;for(let u=0;u<100;u++)i[u]>f&&(f=i[u],c=u);return c===-1?-1/0:c*(o/100)+s}async analyzeNoiseFloor(e,t,r,a){const i=Math.floor(r/100),s=[];for(let d=0;d<t;d++){const u=e[d];for(let g=0;g<r-i;g+=i){let h=0;for(let p=g;p<g+i&&p<r;p++)h+=u[p]*u[p];const v=Math.sqrt(h/i);s.push(v)}}s.sort((d,u)=>d-u);const o=Math.floor(s.length*.2),l=s.slice(0,o),c=l.reduce((d,u)=>d+u,0)/l.length;return c>0?20*Math.log10(c):-1/0}checkNormalization(e){let a,i;return Math.abs(e- -6)<=.1?(a="normalized",i="Properly normalized"):e>-6?(a="too_loud",i="Too loud"):(a="too_quiet",i="Too quiet"),{status:a,message:i,peakDb:e,targetDb:-6}}cancelAnalysis(){this.analysisInProgress=!1}analyzeStereoSeparation(e){if(e.numberOfChannels!==2)return null;const t=e.getChannelData(0),r=e.getChannelData(1),a=e.sampleRate,i=e.length,s=Math.floor(a*.25),o=1.1,l=.001;let c=0,f=0,d=0,u=0,g=0;for(let I=0;I<i;I+=s){let E=0,_=0;const A=Math.min(I+s,i),F=A-I;for(let U=I;U<A;U++)E+=t[U]*t[U],_+=r[U]*r[U];const T=Math.sqrt(E/F),R=Math.sqrt(_/F);if(g++,T<l&&R<l){u++;continue}const M=T/R;M>o?c++:M<1/o?f++:d++}const h=g-u;let v="Undetermined",p=0,w=0,S=0,m=0;return h>0?(m=d/h,w=c/h,S=f/h,m>.9?(v="Mono as Stereo",p=m):w>.1&&S>.1?(v="Conversational Stereo",p=w+S):w>.9?(v="Mono in Left Channel",p=w):S>.9?(v="Mono in Right Channel",p=S):(v="Mixed Stereo",p=1-m)):(v="Silent",p=1),{totalBlocks:g,activeBlocks:h,silentBlocks:u,leftDominantBlocks:c,rightDominantBlocks:f,balancedBlocks:d,stereoType:v,stereoConfidence:Math.min(p,1)}}analyzeMicBleed(e){if(e.numberOfChannels!==2)return null;const t=e.getChannelData(0),r=e.getChannelData(1),a=e.sampleRate,i=e.length,s=Math.floor(a*.25),o=1.5,l=.001,c=15,f=[],d=[],u=[],g=[];for(let A=0;A<i;A+=s){let F=0,T=0;const R=Math.min(A+s,i),M=R-A;for(let k=A;k<R;k++)F+=t[k]*t[k],T+=r[k]*r[k];const U=Math.sqrt(F/M),V=Math.sqrt(T/M);if(U<l&&V<l)continue;const oe=U/V;if(oe>o){const k=20*Math.log10(U),C=V>0?20*Math.log10(V):-1/0,P=k-C;d.push(V),u.push(P),P<c&&g.push({startSample:A,endSample:R,dominantChannel:"left",separation:P,dominantRms:U,bleedRms:V})}else if(oe<1/o){const k=20*Math.log10(V),C=U>0?20*Math.log10(U):-1/0,P=k-C;f.push(U),u.push(P),P<c&&g.push({startSample:A,endSample:R,dominantChannel:"right",separation:P,dominantRms:V,bleedRms:U})}}const h=A=>{if(A.length===0)return-1/0;const T=A.reduce((R,M)=>R+M,0)/A.length;return 20*Math.log10(T)},v=h(f),p=h(d);let w=-1/0,S=-1/0,m=0;if(u.length>0){const A=[...u].sort((M,U)=>M-U),F=Math.floor(A.length/2);w=A.length%2!==0?A[F]:(A[F-1]+A[F])/2;const T=Math.floor(A.length*.1);S=A[T],m=u.filter(M=>M<15).length/u.length*100}const I=[],E=.3;for(const A of g){const F=this.calculateCrossCorrelation(t,r,A.startSample,A.endSample,A.dominantChannel);F>E&&I.push({...A,correlation:F,timestamp:A.startSample/a})}const _=u.length>0?I.length/u.length*100:0;return{old:{leftChannelBleedDb:v,rightChannelBleedDb:p,leftBleedSamples:f.length,rightBleedSamples:d.length},new:{medianSeparation:w,p10Separation:S,percentagePoorSeparation:m,percentageConfirmedBleed:_,totalBlocks:u.length,concerningBlocks:g.length,confirmedBleedBlocks:I.length,worstBlocks:I.slice(0,5)}}}calculateCrossCorrelation(e,t,r,a,i){const s=a-r;let o=0,l=0;for(let v=r;v<a;v++)i==="left"?(o+=e[v],l+=t[v]):(o+=t[v],l+=e[v]);const c=o/s,f=l/s;let d=0,u=0,g=0;for(let v=r;v<a;v++){const p=i==="left"?e[v]:t[v],w=i==="left"?t[v]:e[v],S=p-c,m=w-f;d+=S*m,u+=S*S,g+=m*m}const h=Math.sqrt(u*g);return h===0?0:Math.abs(d/h)}}class rr{static matchesFileType(e,t){const r={matches:!1,status:"fail"};if(e===t)return r.matches=!0,r.status="pass",r;if(t==="wav"||t==="WAV")return e==="WAV (PCM)"||e==="WAV"?(r.matches=!0,r.status="pass",r):(e.startsWith("WAV")&&(r.matches=!0,r.status="warning"),r);const a=e.replace(/\s*\(.*\)/,"").trim(),i=t.toUpperCase();return a===i&&(r.matches=!0,r.status="pass"),r}static validateResults(e,t,r=!1){const a={},i=o=>o?Array.isArray(o)?o:[o]:[],s=i(t.fileType);if(s.length>0){let o={matches:!1,status:"fail"};for(const l of s){const c=this.matchesFileType(e.fileType,l);if(c.status==="pass"){o=c;break}else c.status==="warning"&&o.status==="fail"&&(o=c)}a.fileType={matches:o.matches,target:s,actual:e.fileType,status:o.status}}if(!r){const o=i(t.sampleRate).map(f=>parseInt(f)).filter(f=>!isNaN(f));if(o.length>0){const f=e.sampleRate;let d,u;f==="Unknown"||typeof f!="number"?(u=!1,d="warning"):(u=o.includes(f),d=u?"pass":"fail"),a.sampleRate={matches:u,target:o,actual:f,status:d}}const l=i(t.bitDepth).map(f=>parseInt(f)).filter(f=>!isNaN(f));if(l.length>0){const f=e.bitDepth;let d,u;f==="Unknown"||typeof f!="number"?(u=!1,d="warning"):(u=l.includes(f),d=u?"pass":"fail"),a.bitDepth={matches:u,target:l,actual:f,status:d}}const c=i(t.channels).map(f=>parseInt(f)).filter(f=>!isNaN(f));if(c.length>0){const f=e.channels;let d,u;f==="Unknown"||typeof f!="number"?(u=!1,d="warning"):(u=c.includes(f),d=u?"pass":"fail"),a.channels={matches:u,target:c,actual:f,status:d}}if(t.minDuration){const f=parseInt(t.minDuration),d=e.duration;let u,g;d==="Unknown"||typeof d!="number"?(g=!1,u="warning"):(g=d>=f,u=g?"pass":"warning"),a.duration={matches:g,target:`${f}s minimum`,actual:d,status:u}}}return a}static formatDuration(e){const t=Math.floor(e/3600),r=Math.floor(e%3600/60),a=Math.floor(e%60);return t>0?`${t}h:${r.toString().padStart(2,"0")}m:${a.toString().padStart(2,"0")}s`:`${r}m:${a.toString().padStart(2,"0")}s`}static formatDisplayText(e){const t={};return t.fileType=e.fileType,t.sampleRate=typeof e.sampleRate=="number"?`${(e.sampleRate/1e3).toFixed(1)} kHz`:e.sampleRate,t.bitDepth=typeof e.bitDepth=="number"?`${e.bitDepth}-bit`:e.bitDepth,t.channels=typeof e.channels=="number"?`${e.channels}${e.channels===1?" (Mono)":e.channels===2?" (Stereo)":""}`:e.channels,t.duration=typeof e.duration=="number"?rr.formatDuration(e.duration):e.duration,t.fileSize=`${(e.fileSize/1024/1024).toFixed(2)} MB`,t}static formatAdvancedResults(e){const t={};return t.peakLevel=e.peakDb===-1/0?"Silent":`${e.peakDb.toFixed(1)} dB`,t.peakStatus=e.peakDb<=-6?"pass":e.peakDb<=-3?"warning":"fail",t.noiseFloor=e.noiseFloorDb===-1/0?"Silent":`${e.noiseFloorDb.toFixed(1)} dB`,t.noiseStatus=e.noiseFloorDb<=-60?"pass":"fail",t.normalization=e.normalizationStatus.message,t.normalizationStatus=e.normalizationStatus.status==="normalized"?"pass":"fail",t}}const Y={SETTINGS:"audio-analyzer-settings",SELECTED_PRESET:"audio-analyzer-selected-preset",FILENAME_VALIDATION:"audio-analyzer-filename-validation",BOX_FILENAME_VALIDATION:"audio-analyzer-box-filename-validation",LOCAL_FILENAME_VALIDATION:"audio-analyzer-local-filename-validation",DARK_MODE:"darkMode",BOX_JUST_AUTHENTICATED:"box_just_authenticated"},xs={"auditions-character-recordings":{name:"Auditions: Character Recordings",fileType:["wav"],sampleRate:["48000"],bitDepth:["24"],channels:["1"],minDuration:"120"},"auditions-emotional-voice":{name:"Auditions: Emotional Voice",fileType:["wav"],sampleRate:["48000"],bitDepth:["16","24"],channels:["1","2"],minDuration:"30"},"character-recordings":{name:"Character Recordings",fileType:["wav"],sampleRate:["48000"],bitDepth:["24"],channels:["1"],minDuration:""},"p2b2-pairs-mono":{name:"P2B2 Pairs (Mono)",fileType:["wav"],sampleRate:["44100","48000"],bitDepth:["16","24"],channels:["1"],minDuration:""},"p2b2-pairs-stereo":{name:"P2B2 Pairs (Stereo)",fileType:["wav"],sampleRate:["44100","48000"],bitDepth:["16","24"],channels:["2"],minDuration:""},"p2b2-pairs-mixed":{name:"P2B2 Pairs (Mixed)",fileType:["wav"],sampleRate:["44100","48000"],bitDepth:["16","24"],channels:["1","2"],minDuration:""},"three-hour":{name:"Three Hour",fileType:["wav"],sampleRate:["48000"],bitDepth:["24"],channels:["1"],minDuration:"",supportsFilenameValidation:!0,filenameValidationType:"script-match",gdriveOnly:!0},"bilingual-conversational":{name:"Bilingual Conversational",fileType:["wav"],sampleRate:["48000"],bitDepth:["16","24"],channels:["2"],minDuration:"",supportsFilenameValidation:!0,filenameValidationType:"bilingual-pattern"},custom:{name:"Custom"}};class dt{static getCriteria(){const e=localStorage.getItem(Y.SETTINGS);if(!e)return null;try{return JSON.parse(e).criteria||null}catch(t){return console.warn("Failed to load criteria from localStorage:",t),null}}static saveCriteria(e){const t={criteria:e};localStorage.setItem(Y.SETTINGS,JSON.stringify(t))}static getSelectedPreset(){return localStorage.getItem(Y.SELECTED_PRESET)}static saveSelectedPreset(e){localStorage.setItem(Y.SELECTED_PRESET,e)}static getPresetConfigurations(){return xs}static getPresetConfig(e){return this.getPresetConfigurations()[e]||null}static loadFilenameValidationSettings(){const e=localStorage.getItem(Y.FILENAME_VALIDATION),t={enableAudioAnalysis:!0,enableFilenameValidation:!1,speakerId:"",scriptsFolderUrl:""};if(!e)return t;try{const r=JSON.parse(e);return{enableAudioAnalysis:r.enableAudioAnalysis!==!1,enableFilenameValidation:r.enableFilenameValidation||!1,speakerId:r.speakerId||"",scriptsFolderUrl:r.scriptsFolderUrl||""}}catch(r){return console.error("Error loading filename validation settings:",r),t}}static saveFilenameValidationSettings(e){localStorage.setItem(Y.FILENAME_VALIDATION,JSON.stringify(e))}static loadBoxFilenameValidationSettings(){const e=localStorage.getItem(Y.BOX_FILENAME_VALIDATION),t={enableAudioAnalysis:!0,enableFilenameValidation:!1};if(!e)return t;try{const r=JSON.parse(e);return{enableAudioAnalysis:r.enableAudioAnalysis!==!1,enableFilenameValidation:r.enableFilenameValidation||!1}}catch(r){return console.error("Error loading Box filename validation settings:",r),t}}static saveBoxFilenameValidationSettings(e){localStorage.setItem(Y.BOX_FILENAME_VALIDATION,JSON.stringify(e))}static loadLocalFilenameValidationSettings(){const e=localStorage.getItem(Y.LOCAL_FILENAME_VALIDATION),t={enableAudioAnalysis:!0,enableFilenameValidation:!1};if(!e)return t;try{const r=JSON.parse(e);return{enableAudioAnalysis:r.enableAudioAnalysis!==!1,enableFilenameValidation:r.enableFilenameValidation||!1}}catch(r){return console.error("Error loading local filename validation settings:",r),t}}static saveLocalFilenameValidationSettings(e){localStorage.setItem(Y.LOCAL_FILENAME_VALIDATION,JSON.stringify(e))}static getDarkModePreference(){const e=localStorage.getItem(Y.DARK_MODE);return e===null?null:e==="true"}static saveDarkModePreference(e){localStorage.setItem(Y.DARK_MODE,e?"true":"false")}static wasBoxJustAuthenticated(){return localStorage.getItem(Y.BOX_JUST_AUTHENTICATED)==="true"}static clearBoxAuthenticationFlag(){localStorage.removeItem(Y.BOX_JUST_AUTHENTICATED)}static setBoxAuthenticationFlag(){localStorage.setItem(Y.BOX_JUST_AUTHENTICATED,"true")}static clearAllSettings(){Object.values(Y).forEach(e=>{localStorage.removeItem(e)})}static exportSettings(){const e={};return Object.entries(Y).forEach(([t,r])=>{const a=localStorage.getItem(r);if(a!==null)try{e[t]=JSON.parse(a)}catch{e[t]=a}}),e}static importSettings(e){Object.entries(e).forEach(([t,r])=>{const a=Y[t];if(a){const i=typeof r=="string"?r:JSON.stringify(r);localStorage.setItem(a,i)}})}}const Dn=nn(dt.getSelectedPreset()||"custom");Dn.subscribe(n=>{if(n&&(dt.saveSelectedPreset(n),n!=="custom")){const e=dt.getPresetConfig(n);if(e){const t={fileType:e.fileType||[],sampleRate:e.sampleRate||[],bitDepth:e.bitDepth||[],channels:e.channels||[],minDuration:e.minDuration||""};dt.saveCriteria(t)}}});const Ds=nn(dt.getCriteria()),Vn=dt.getPresetConfigurations(),Ts=fn(Dn,n=>n?dt.getPresetConfig(n):null);function Rs(n){Dn.set(n)}const ca={subscribe:Dn.subscribe},Fs={subscribe:Ds.subscribe};var Cs=z('<div class="current-preset svelte-ujtmwg"><span class="preset-label svelte-ujtmwg">Current Preset:</span> <span class="preset-name svelte-ujtmwg"> </span> <a href="#" class="svelte-ujtmwg">Change</a></div>'),Os=z('<div class="no-preset-warning svelte-ujtmwg"><span>⚠️ No preset selected. Files will be analyzed without validation.</span> <a href="#" class="svelte-ujtmwg">Select a preset</a></div>'),$s=z('<div class="error-message svelte-ujtmwg"> </div>'),Bs=z('<div class="processing-indicator svelte-ujtmwg">Processing file...</div>'),Ms=z('<div class="local-file-tab svelte-ujtmwg"><!> <!> <div class="options svelte-ujtmwg"><label class="svelte-ujtmwg"><input type="checkbox" class="svelte-ujtmwg"/> Metadata Only (skip audio analysis for faster processing)</label></div> <!> <!> <!></div>');function Ps(n,e){Qe(e,!1);const t=()=>Ze(Fs,"$currentCriteria",a),r=()=>Ze(ca,"$currentPresetId",a),[a,i]=Nt();function s(){_n.setTab("settings")}let o=Be(!1),l=Be(""),c=Be(!1),f=Be(null),d=null,u=null;const g=new ks,h=new As;function v(){u&&(URL.revokeObjectURL(u),u=null)}is(v);async function p(k){const P=k.target?.files?.[0];if(P){v(),H(o,!0),H(l,""),H(f,null),d=null;try{const J=await g.analyzeFile(P);let G=null;if(!b(c)){const le=new(window.AudioContext||window.webkitAudioContext),Ee=await P.arrayBuffer(),Ie=await le.decodeAudioData(Ee);G=await h.analyzeAudioBuffer(Ie)}u=URL.createObjectURL(P);const re={filename:P.name,fileSize:P.size,audioUrl:u,...J,...G||{}},Re=t();if(Re&&r()!=="custom"){d=rr.validateResults(re,Re,b(c));let le="pass";if(d){const Ee=Object.values(d);Ee.some(Ie=>Ie.status==="fail")?le="fail":Ee.some(Ie=>Ie.status==="warning")&&(le="warning")}H(f,{...re,status:le,validation:d})}else H(f,{...re,status:"pass"})}catch(J){H(l,J instanceof Error?J.message:"Unknown error occurred"),H(f,null)}finally{H(o,!1)}}}Lt();var w=Ms(),S=D(w);{var m=k=>{var C=Cs(),P=x(D(C),2),J=D(P),G=x(P,2);K(()=>Z(J,Vn[r()]?.name||r())),ve("click",G,Sr(s)),B(k,C)},I=k=>{var C=Os(),P=x(D(C),2);ve("click",P,Sr(s)),B(k,C)};j(S,k=>{r()&&r()!=="custom"?k(m):k(I,!1)})}var E=x(S,2);hs(E,{id:"local-file-upload",get processing(){return b(o)},accept:"audio/*",$$events:{change:p}});var _=x(E,2),A=D(_),F=D(A),T=x(_,2);{var R=k=>{var C=$s(),P=D(C);K(()=>Z(P,b(l))),B(k,C)};j(T,k=>{b(l)&&k(R)})}var M=x(T,2);{var U=k=>{var C=Bs();B(k,C)};j(M,k=>{b(o)&&k(U)})}var V=x(M,2);{var oe=k=>{{let C=In(()=>[b(f)]);Is(k,{get results(){return b(C)},mode:"single",get metadataOnly(){return b(c)}})}};j(V,k=>{b(f)&&k(oe)})}Qi(F,()=>b(c),k=>H(c,k)),B(n,w),et(),i()}const Ls=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",Ns=window.location.pathname.startsWith("/beta"),ua=Ls?"http://localhost:3000":Ns?"https://audio-analyzer.tinytech.site/beta":"https://audio-analyzer.tinytech.site",Cn={CLIENT_ID:"708688597317-bmmrje6hqg8vo52nctned54m32q8uhsr.apps.googleusercontent.com",REDIRECT_URI:ua,SCOPE:"https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email",DISCOVERY_DOCS:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]},pe={CLIENT_ID:"0y78slky3xitt421wmoa0fjdz6fi14hn",REDIRECT_URI:ua,AUTHORIZATION_URL:"https://account.box.com/api/oauth2/authorize",TOKEN_URL:"https://api.box.com/oauth2/token",API_URL:"https://api.box.com/2.0",PROXY_URL:"https://box-proxy-708688597317.us-central1.run.app"};class zs{constructor(){this.isInitialized=!1,this.accessToken=null,this.codeClient=null,this.userInfo=null}async init(){if(!this.isInitialized)return new Promise((e,t)=>{this.loadGoogleAPI().then(()=>{this.initializeGIS().then(e).catch(t)}).catch(t)})}async loadGoogleAPI(){return new Promise((e,t)=>{if(window.gapi){e();return}const r=document.createElement("script");r.src="https://apis.google.com/js/api.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load Google API script")),document.head.appendChild(r)})}async initializeGIS(){return new Promise((e,t)=>{const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.onload=()=>{this.setupGIS().then(e).catch(t)},r.onerror=()=>t(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async setupGIS(){return new Promise((e,t)=>{const r=setTimeout(()=>{t(new Error("Google API setup timeout"))},1e4);window.gapi.load("client",async()=>{try{clearTimeout(r),await window.gapi.client.init({discoveryDocs:Cn.DISCOVERY_DOCS}),this.tokenClient=window.google.accounts.oauth2.initTokenClient({client_id:Cn.CLIENT_ID,scope:Cn.SCOPE,callback:a=>{if(a.error){console.error("Token response error:",a),t(new Error(`Google sign-in failed: ${a.error}`));return}this.accessToken=a.access_token;const i={access_token:a.access_token,expires_at:Date.now()+a.expires_in*1e3,scope:a.scope};localStorage.setItem("google_token",JSON.stringify(i)),e(i)}}),this.isInitialized=!0,e()}catch(a){clearTimeout(r),console.error("Google API setup error:",a);let i="Unknown setup error";a&&typeof a=="object"?i=a.message||a.error||a.details||JSON.stringify(a):a&&(i=a.toString()),t(new Error(`Failed to setup Google API: ${i}`))}})})}async signIn(){return this.isInitialized||await this.init(),new Promise((e,t)=>{try{this.tokenClient.callback=r=>{if(r.error){console.error("Token response error:",r),t(new Error(`Google sign-in failed: ${r.error}`));return}if(!(r.scope&&r.scope.includes("https://www.googleapis.com/auth/drive.readonly"))){console.warn("Drive scope not granted, retrying with consent prompt"),this.tokenClient.requestAccessToken({prompt:"consent"});return}this.accessToken=r.access_token;const i={access_token:r.access_token,expires_at:Date.now()+r.expires_in*1e3,scope:r.scope};localStorage.setItem("google_token",JSON.stringify(i)),e(i)},this.tokenClient.requestAccessToken({prompt:""})}catch(r){console.error("Google sign-in error:",r);let a="Unknown sign-in error";r&&typeof r=="object"?a=r.error||r.message||r.details||JSON.stringify(r):r&&(a=r.toString()),t(new Error(`Google sign-in failed: ${a}`))}})}async getValidToken(){const e=localStorage.getItem("google_token");if(e)try{const t=JSON.parse(e);if(t.expires_at>Date.now()+3e5)return this.accessToken=t.access_token,t}catch(t){console.warn("Invalid stored token:",t),localStorage.removeItem("google_token")}return await this.signIn()}async getUserInfo(){const e=await this.getValidToken();try{const t=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!t.ok)throw new Error(`Failed to get user info: ${t.status}`);const r=await t.json();return this.userInfo=r,r}catch(t){throw new Error(`Failed to get user info: ${t.message}`)}}async downloadFile(e){const t=await this.getValidToken();try{const r=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?fields=name,mimeType,size`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!r.ok)throw r.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive. Please sign in again and grant Drive access.")):new Error(`Failed to get file metadata: ${r.status}`);const a=await r.json(),i=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?alt=media`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!i.ok)throw new Error(`Failed to download file: ${i.status}`);const s=await i.blob();return new File([s],a.name,{type:a.mimeType||"audio/mpeg"})}catch(r){throw new Error(`Google Drive download failed: ${r.message}`)}}async listAudioFilesInFolder(e){const t=await this.getValidToken();try{const a=["audio/mpeg","audio/wav","audio/x-wav","audio/wave","audio/flac","audio/x-flac","audio/aac","audio/mp4","audio/ogg","audio/x-m4a"].map(l=>`mimeType='${l}'`).join(" or "),i=`'${e}' in parents and (${a}) and trashed=false`,s=await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(i)}&fields=files(id,name,mimeType,size,modifiedTime,videoMediaMetadata)&pageSize=1000`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!s.ok)throw s.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive folder. Please sign in again.")):new Error(`Failed to list folder contents: ${s.status}`);return(await s.json()).files||[]}catch(r){throw new Error(`Failed to list folder: ${r.message}`)}}async listFilesInFolder(e,t){const r=await this.getValidToken();try{const a=`'${e}' in parents and trashed=false`,i=await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(a)}&fields=files(id,name,mimeType)&pageSize=1000`,{headers:{Authorization:`Bearer ${r.access_token}`}});if(!i.ok)throw i.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive folder. Please sign in again.")):new Error(`Failed to list folder contents: ${i.status}`);const o=(await i.json()).files||[];return t?o.filter(l=>l.name.toLowerCase().endsWith(t.toLowerCase())):o}catch(a){throw new Error(`Failed to list folder: ${a.message}`)}}async downloadFileHeaders(e,t=102400){const r=await this.getValidToken();try{const a=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?alt=media`,{headers:{Authorization:`Bearer ${r.access_token}`,Range:`bytes=0-${t-1}`}});if(!a.ok&&a.status!==206)throw new Error(`Failed to download file headers: ${a.status}`);return await a.blob()}catch(a){throw new Error(`Failed to download headers: ${a.message}`)}}async getFileMetadata(e){if(e.videoMediaMetadata)return e;const t=await this.getValidToken();try{const r=await fetch(`https://www.googleapis.com/drive/v3/files/${e.id}?fields=name,mimeType,size,modifiedTime,videoMediaMetadata`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!r.ok)throw r.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive. Please sign in again and grant Drive access.")):new Error(`Failed to get file metadata: ${r.status}`);return await r.json()}catch(r){throw new Error(`Google Drive metadata fetch failed: ${r.message}`)}}signOut(){this.accessToken&&window.google&&window.google.accounts.oauth2.revoke(this.accessToken),this.accessToken=null,localStorage.removeItem("google_token")}isSignedIn(){const e=localStorage.getItem("google_token");if(!e)return!1;try{return JSON.parse(e).expires_at>Date.now()}catch{return!1}}}class Us{constructor(){this.isInitialized=!1,this.accessToken=null,this.userInfo=null}async init(){this.isInitialized||(console.log("[Box Auth] Init started at:",new Date().toISOString()),await this.handleOAuthCallback(),console.log("[Box Auth] Init completed at:",new Date().toISOString()),this.isInitialized=!0)}async handleOAuthCallback(){const e=new URLSearchParams(window.location.search);if(e.has("code")){console.log("[Box OAuth] Callback received at:",new Date().toISOString());const t=e.get("code"),r=e.get("state"),a=localStorage.getItem("box_oauth_state");if(!a||a!==r)return console.error("OAuth state mismatch"),!1;console.log("[Box OAuth] State verified, exchanging code at:",new Date().toISOString());try{const i=await fetch(`${pe.PROXY_URL}?action=token&code=${encodeURIComponent(t)}`);if(console.log("[Box OAuth] Token exchange response at:",new Date().toISOString(),"Status:",i.status),!i.ok){const l=await i.text();throw console.error("[Box OAuth] Token exchange failed:",l),new Error(`Token exchange failed: ${i.status}`)}const s=await i.json(),o={access_token:s.access_token,refresh_token:s.refresh_token,expires_at:Date.now()+s.expires_in*1e3};return localStorage.setItem("box_token",JSON.stringify(o)),this.accessToken=s.access_token,localStorage.setItem("box_just_authenticated","true"),window.history.replaceState({},document.title,window.location.pathname),!0}catch(i){return console.error("Failed to exchange authorization code:",i),!1}}return!1}async signIn(){this.isInitialized||await this.init();const e=Math.random().toString(36).substring(2,15);localStorage.setItem("box_oauth_state",e);const t=new URL(pe.AUTHORIZATION_URL);t.searchParams.append("client_id",pe.CLIENT_ID),t.searchParams.append("response_type","code"),t.searchParams.append("redirect_uri",pe.REDIRECT_URI),t.searchParams.append("state",e),window.location.href=t.toString()}async getValidToken(){const e=localStorage.getItem("box_token");if(e)try{const t=JSON.parse(e);if(t.expires_at>Date.now()+3e5)return this.accessToken=t.access_token,t}catch(t){console.warn("Invalid stored token:",t),localStorage.removeItem("box_token")}throw new Error("Not signed in to Box")}async getUserInfo(){const e=await this.getValidToken();try{const t=await fetch(`${pe.API_URL}/users/me`,{headers:{Authorization:`Bearer ${e.access_token}`}});if(!t.ok)throw new Error(`Failed to get user info: ${t.status}`);const r=await t.json();return this.userInfo=r,r}catch(t){throw new Error(`Failed to get user info: ${t.message}`)}}async downloadFile(e,t=null){try{const r=await this.getValidToken();console.log("[Box Download] Token retrieved:",r?"Yes":"No","Expires at:",new Date(r.expires_at).toISOString());const a={Authorization:`Bearer ${r.access_token}`};console.log("[Box Download] Fetching metadata for file:",e);const i=await fetch(`${pe.API_URL}/files/${e}`,{headers:a});if(!i.ok){const c=await i.text();throw console.error("[Box Download] Metadata fetch failed:",i.status,c),i.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to get file metadata: ${i.status}`)}const s=await i.json();console.log("[Box Download] Metadata retrieved:",s.name),console.log("[Box Download] Downloading file content...");const o=await fetch(`${pe.API_URL}/files/${e}/content`,{headers:a});if(!o.ok){const c=await o.text();throw console.error("[Box Download] File download failed:",o.status,c),new Error(`Failed to download file: ${o.status}`)}const l=await o.blob();return new File([l],s.name,{type:s.content_type||"audio/mpeg"})}catch(r){throw new Error(`Box download failed: ${r.message}`)}}async listAudioFilesInFolder(e,t=null){try{const r=`${pe.API_URL}/folders/${e}/items?fields=id,name,type,size,modified_at&limit=1000`;let a=`${pe.PROXY_URL}?url=${encodeURIComponent(r)}`;if(t)a+=`&boxapi=${encodeURIComponent(t)}`;else{const f=await this.getValidToken();a+=`&token=${encodeURIComponent(f.access_token)}`}const i=await fetch(a);if(!i.ok)throw!t&&i.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to list folder contents: ${i.status}`);const o=(await i.json()).entries||[],l=[".mp3",".wav",".flac",".aac",".m4a",".ogg"];return o.filter(f=>{if(f.type!=="file")return!1;const d=f.name.toLowerCase();return l.some(u=>d.endsWith(u))})}catch(r){throw new Error(`Failed to list folder: ${r.message}`)}}async listFilesInFolder(e,t,r=null){try{const a={};if(r)a.BoxApi=`shared_link=${r}`;else{const c=await this.getValidToken();a.Authorization=`Bearer ${c.access_token}`}const i=await fetch(`${pe.API_URL}/folders/${e}/items?fields=id,name,type&limit=1000`,{headers:a});if(!i.ok)throw!r&&i.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to list folder contents: ${i.status}`);let l=((await i.json()).entries||[]).filter(c=>c.type==="file");return t&&(l=l.filter(c=>c.name.toLowerCase().endsWith(t.toLowerCase()))),l}catch(a){throw new Error(`Failed to list folder: ${a.message}`)}}async downloadFileHeaders(e,t=102400,r=null){try{const a={Range:`bytes=0-${t-1}`};if(r)a.BoxApi=`shared_link=${r}`;else{const s=await this.getValidToken();a.Authorization=`Bearer ${s.access_token}`}const i=await fetch(`${pe.API_URL}/files/${e}/content`,{headers:a});if(!i.ok&&i.status!==206)throw new Error(`Failed to download file headers: ${i.status}`);return await i.blob()}catch(a){throw new Error(`Failed to download headers: ${a.message}`)}}async getFileMetadata(e,t=null){try{const r={};if(t)r.BoxApi=`shared_link=${t}`;else{const i=await this.getValidToken();r.Authorization=`Bearer ${i.access_token}`}const a=await fetch(`${pe.API_URL}/files/${e.id}?fields=id,name,size,modified_at,content_type`,{headers:r});if(!a.ok)throw!t&&a.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to get file metadata: ${a.status}`);return await a.json()}catch(r){throw new Error(`Box metadata fetch failed: ${r.message}`)}}signOut(){this.accessToken=null,this.userInfo=null,localStorage.removeItem("box_token"),localStorage.removeItem("box_oauth_state")}isSignedIn(){const e=localStorage.getItem("box_token");if(!e)return!1;try{return JSON.parse(e).expires_at>Date.now()}catch{return!1}}}class rt{constructor(){this.authStateStore=nn({google:{isAuthenticated:!1,isInitialized:!1,userInfo:null,error:null},box:{isAuthenticated:!1,isInitialized:!1,error:null}}),this.googleAuth=new zs,this.boxAuth=new Us,this.authState={subscribe:e=>this.authStateStore.subscribe(e)},this.isGoogleAuthenticated=fn(this.authStateStore,e=>e.google.isAuthenticated),this.isBoxAuthenticated=fn(this.authStateStore,e=>e.box.isAuthenticated),this.googleUserInfo=fn(this.authStateStore,e=>e.google.userInfo),this.initialize()}static getInstance(){return rt.instance||(rt.instance=new rt),rt.instance}async initialize(){try{if(await this.googleAuth.init(),this.updateGoogleState({isInitialized:!0}),this.googleAuth.isSignedIn()){const e=await this.googleAuth.getUserInfo();this.updateGoogleState({isAuthenticated:!0,userInfo:e})}}catch(e){console.error("Failed to initialize Google auth:",e),this.updateGoogleState({error:e instanceof Error?e:new Error(String(e))})}try{await this.boxAuth.init(),this.updateBoxState({isInitialized:!0}),this.boxAuth.isSignedIn()&&this.updateBoxState({isAuthenticated:!0})}catch(e){console.error("Failed to initialize Box auth:",e),this.updateBoxState({error:e instanceof Error?e:new Error(String(e))})}}async signInGoogle(){try{await this.googleAuth.signIn();const e=await this.googleAuth.getUserInfo();this.updateGoogleState({isAuthenticated:!0,userInfo:e,error:null})}catch(e){const t=e instanceof Error?e:new Error(String(e));throw this.updateGoogleState({error:t}),t}}async signOutGoogle(){try{await this.googleAuth.signOut(),this.updateGoogleState({isAuthenticated:!1,userInfo:null,error:null})}catch(e){const t=e instanceof Error?e:new Error(String(e));throw this.updateGoogleState({error:t}),t}}async signInBox(){try{await this.boxAuth.signIn(),this.updateBoxState({isAuthenticated:!0,error:null})}catch(e){const t=e instanceof Error?e:new Error(String(e));throw this.updateBoxState({error:t}),t}}async signOutBox(){try{await this.boxAuth.signOut(),this.updateBoxState({isAuthenticated:!1,error:null})}catch(e){const t=e instanceof Error?e:new Error(String(e));throw this.updateBoxState({error:t}),t}}getGoogleAuthInstance(){return this.googleAuth}getBoxAuthInstance(){return this.boxAuth}isGoogleAuthenticatedSync(){return this.googleAuth.isSignedIn()}isBoxAuthenticatedSync(){return this.boxAuth.isSignedIn()}updateGoogleState(e){this.authStateStore.update(t=>({...t,google:{...t.google,...e}}))}updateBoxState(e){this.authStateStore.update(t=>({...t,box:{...t.box,...e}}))}resetState(){this.authStateStore.set({google:{isAuthenticated:!1,isInitialized:!1,userInfo:null,error:null},box:{isAuthenticated:!1,isInitialized:!1,error:null}})}}let On=null;function fa(){return On||(On=rt.getInstance()),On}fa();const da={subscribe:n=>fa().authState.subscribe(n)};var qs=z('<div class="user-info svelte-6mpjkk"><span class="user-email svelte-6mpjkk"> </span></div> <button class="secondary svelte-6mpjkk">Sign Out</button>',1),js=z('<p>Sign in to access your Google Drive files</p> <button class="svelte-6mpjkk">Sign in with Google</button>',1),Vs=z('<div class="placeholder svelte-6mpjkk"><h3>Google Drive File Analysis</h3> <p>Full Google Drive integration will be implemented in Phase 5.5+</p> <p style="margin-top: 1rem;">This will include: <br/>• Browse and select files from Google Drive <br/>• Batch processing of folders <br/>• Direct file URL input</p></div>'),Gs=z('<div class="google-drive-tab svelte-6mpjkk"><div class="auth-section svelte-6mpjkk"><h3>Google Drive Authentication</h3> <!></div> <!></div>');function Ws(n,e){Qe(e,!1);const t=()=>Ze(da,"$authState",r),[r,a]=Nt(),i=Le.getInstance();function s(){i.dispatch({type:"auth:google:signin:requested"})}function o(){i.dispatch({type:"auth:google:signout:requested"})}Lt();var l=Gs(),c=D(l),f=x(D(c),2);{var d=v=>{var p=qs(),w=ie(p),S=D(w),m=D(S),I=x(w,2);K(()=>Z(m,`✅ Signed in as ${t().google.userInfo?.email??""}`)),ve("click",I,o),B(v,p)},u=v=>{var p=js(),w=x(ie(p),2);ve("click",w,s),B(v,p)};j(f,v=>{t().google.isAuthenticated?v(d):v(u,!1)})}var g=x(c,2);{var h=v=>{var p=Vs();B(v,p)};j(g,v=>{t().google.isAuthenticated&&v(h)})}B(n,l),et(),a()}var Hs=z('<div class="user-info svelte-1ttt140"><span>✅ Signed in to Box</span></div> <button class="secondary svelte-1ttt140">Sign Out</button>',1),Js=z('<p>Sign in to access your Box files</p> <button class="svelte-1ttt140">Sign in with Box</button>',1),Ys=z('<div class="placeholder svelte-1ttt140"><h3>Box File Analysis</h3> <p>Full Box integration will be implemented in Phase 5.5+</p> <p style="margin-top: 1rem;">This will include: <br/>• Browse and select files from Box <br/>• Batch processing of folders <br/>• Direct shared link input</p></div>'),Xs=z('<div class="box-tab svelte-1ttt140"><div class="auth-section svelte-1ttt140"><h3>Box Authentication</h3> <!></div> <!></div>');function Ks(n,e){Qe(e,!1);const t=()=>Ze(da,"$authState",r),[r,a]=Nt(),i=Le.getInstance();function s(){i.dispatch({type:"auth:box:signin:requested"})}function o(){i.dispatch({type:"auth:box:signout:requested"})}Lt();var l=Xs(),c=D(l),f=x(D(c),2);{var d=v=>{var p=Hs(),w=x(ie(p),2);ve("click",w,o),B(v,p)},u=v=>{var p=Js(),w=x(ie(p),2);ve("click",w,s),B(v,p)};j(f,v=>{t().box.isAuthenticated?v(d):v(u,!1)})}var g=x(c,2);{var h=v=>{var p=Ys();B(v,p)};j(g,v=>{t().box.isAuthenticated&&v(h)})}B(n,l),et(),a()}var Zs=z("<option> </option>"),Qs=z('<dt class="svelte-1102y3w">File Type:</dt> <dd class="svelte-1102y3w"> </dd>',1),eo=z('<dt class="svelte-1102y3w">Sample Rate:</dt> <dd class="svelte-1102y3w"> </dd>',1),to=z('<dt class="svelte-1102y3w">Bit Depth:</dt> <dd class="svelte-1102y3w"> </dd>',1),no=z('<dt class="svelte-1102y3w">Channels:</dt> <dd class="svelte-1102y3w"> </dd>',1),ro=z('<dt class="svelte-1102y3w">Min Duration:</dt> <dd class="svelte-1102y3w"> </dd>',1),ao=z('<dt class="svelte-1102y3w">Filename Validation:</dt> <dd class="svelte-1102y3w"> </dd>',1),io=z('<div class="preset-info svelte-1102y3w"><h4 class="svelte-1102y3w">Preset Requirements</h4> <dl class="svelte-1102y3w"><!> <!> <!> <!> <!> <!></dl></div>'),so=z('<div class="placeholder svelte-1102y3w"><p>Custom criteria configuration will be available in a future update.</p> <p style="margin-top: 0.5rem;">For now, select a preset above to apply validation rules.</p></div>'),oo=z('<div class="settings-tab svelte-1102y3w"><div class="settings-section svelte-1102y3w"><h3 class="svelte-1102y3w">Criteria Presets</h3> <div class="form-group svelte-1102y3w"><label for="preset-select" class="svelte-1102y3w">Select Preset:</label> <select id="preset-select" class="svelte-1102y3w"></select></div> <!></div></div>');function lo(n,e){Qe(e,!1);const t=()=>Ze(ca,"$currentPresetId",a),r=()=>Ze(Ts,"$selectedPreset",a),[a,i]=Nt(),s=Be();function o(p){const w=p.target;Rs(w.value)}pn(()=>Vn,()=>{H(s,Object.entries(Vn).sort((p,w)=>p[0]==="custom"?1:w[0]==="custom"?-1:p[1].name.localeCompare(w[1].name)))}),Zn(),Lt();var l=oo(),c=D(l),f=x(D(c),2),d=x(D(f),2);ia(d,5,()=>b(s),aa,(p,w)=>{var S=wi(()=>Ra(b(w),2));let m=()=>b(S)[0],I=()=>b(S)[1];var E=Zs(),_=D(E),A={};K(()=>{Z(_,(I(),$(()=>I().name))),A!==(A=m())&&(E.value=(E.__value=m())??"")}),B(p,E)});var u;Ji(d);var g=x(f,2);{var h=p=>{var w=io(),S=x(D(w),2),m=D(S);{var I=k=>{var C=Qs(),P=x(ie(C),2),J=D(P);K(G=>Z(J,G),[()=>(r(),$(()=>r().fileType.join(", ").toUpperCase()))]),B(k,C)};j(m,k=>{r(),$(()=>r().fileType&&r().fileType.length>0)&&k(I)})}var E=x(m,2);{var _=k=>{var C=eo(),P=x(ie(C),2),J=D(P);K(G=>Z(J,G),[()=>(r(),$(()=>r().sampleRate.map(G=>`${parseInt(G)/1e3} kHz`).join(", ")))]),B(k,C)};j(E,k=>{r(),$(()=>r().sampleRate&&r().sampleRate.length>0)&&k(_)})}var A=x(E,2);{var F=k=>{var C=to(),P=x(ie(C),2),J=D(P);K(G=>Z(J,G),[()=>(r(),$(()=>r().bitDepth.map(G=>`${G}-bit`).join(", ")))]),B(k,C)};j(A,k=>{r(),$(()=>r().bitDepth&&r().bitDepth.length>0)&&k(F)})}var T=x(A,2);{var R=k=>{var C=no(),P=x(ie(C),2),J=D(P);K(G=>Z(J,G),[()=>(r(),$(()=>r().channels.map(G=>G==="1"?"Mono":G==="2"?"Stereo":G).join(", ")))]),B(k,C)};j(T,k=>{r(),$(()=>r().channels&&r().channels.length>0)&&k(R)})}var M=x(T,2);{var U=k=>{var C=ro(),P=x(ie(C),2),J=D(P);K((G,re)=>Z(J,`${G??""}m ${re??""}s`),[()=>(r(),$(()=>Math.floor(parseInt(r().minDuration)/60))),()=>(r(),$(()=>parseInt(r().minDuration)%60))]),B(k,C)};j(M,k=>{r(),$(()=>r().minDuration)&&k(U)})}var V=x(M,2);{var oe=k=>{var C=ao(),P=x(ie(C),2),J=D(P);K(()=>Z(J,`Supported (${r(),$(()=>r().filenameValidationType)??""})`)),B(k,C)};j(V,k=>{r(),$(()=>r().supportsFilenameValidation)&&k(oe)})}B(p,w)},v=p=>{var w=un(),S=ie(w);{var m=I=>{var E=so();B(I,E)};j(S,I=>{t()==="custom"&&I(m)},!0)}B(p,w)};j(g,p=>{r()&&t()!=="custom"?p(h):p(v,!1)})}K(()=>{u!==(u=t())&&(d.value=(d.__value=t())??"",la(d,t()))}),ve("change",d,o),B(n,l),et(),i()}var co=z('<div class="app sv-app svelte-nejbyb"><header class="header svelte-nejbyb"><div class="header-content svelte-nejbyb"><div class="header-spacer svelte-nejbyb"></div> <h1 class="logo svelte-nejbyb">🎵 Audio Analyzer</h1> <button class="dark-mode-toggle svelte-nejbyb" aria-label="Toggle dark mode"><span class="light-icon svelte-nejbyb">🌙</span> <span class="dark-icon svelte-nejbyb">☀️</span></button></div></header> <main class="main svelte-nejbyb"><div class="container svelte-nejbyb"><!> <!></div></main> <footer class="footer svelte-nejbyb"><div class="container svelte-nejbyb"><p id="buildInfo" class="svelte-nejbyb">Audio Analyzer - Phase 5.5 Settings & Criteria</p></div></footer></div>');function uo(n){const e=()=>Ze(_n,"$currentTab",t),[t,r]=Nt();function a(){const v=document.documentElement,p=v.getAttribute("data-theme")==="dark";v.setAttribute("data-theme",p?"light":"dark"),localStorage.setItem("theme",p?"light":"dark")}if(typeof window<"u"){const v=localStorage.getItem("theme");v&&document.documentElement.setAttribute("data-theme",v)}var i=co(),s=D(i),o=D(s),l=x(D(o),4),c=x(s,2),f=D(c),d=D(f);us(d,{});var u=x(d,2);{var g=v=>{Ps(v,{})},h=v=>{var p=un(),w=ie(p);{var S=I=>{Ws(I,{})},m=I=>{var E=un(),_=ie(E);{var A=T=>{Ks(T,{})},F=T=>{var R=un(),M=ie(R);{var U=V=>{lo(V,{})};j(M,V=>{e()==="settings"&&V(U)},!0)}B(T,R)};j(_,T=>{e()==="box"?T(A):T(F,!1)},!0)}B(I,E)};j(w,I=>{e()==="googleDrive"?I(S):I(m,!1)},!0)}B(v,p)};j(u,v=>{e()==="local"?v(g):v(h,!1)})}ve("click",l,a),B(n,i),r()}class fo{constructor(){this.unsubscribers=[],this.bridge=Le.getInstance(),this.authService=rt.getInstance(),this.attachEventListeners()}attachEventListeners(){this.unsubscribers.push(this.bridge.on("auth:google:signin:requested",()=>this.handleGoogleSignIn())),this.unsubscribers.push(this.bridge.on("auth:google:signout:requested",()=>this.handleGoogleSignOut())),this.unsubscribers.push(this.bridge.on("auth:box:signin:requested",()=>this.handleBoxSignIn())),this.unsubscribers.push(this.bridge.on("auth:box:signout:requested",()=>this.handleBoxSignOut())),this.unsubscribers.push(this.bridge.on("file:local:selected",e=>{console.log("[ServiceCoordinator] File selected:",e.file.name)})),this.unsubscribers.push(this.bridge.on("file:drive:requested",e=>{console.log("[ServiceCoordinator] Google Drive file requested:",e.url)})),this.unsubscribers.push(this.bridge.on("file:box:requested",e=>{console.log("[ServiceCoordinator] Box file requested:",e.url)}))}async handleGoogleSignIn(){try{await this.authService.signInGoogle();const t=await this.authService.getGoogleAuthInstance().getUserInfo();this.bridge.dispatch({type:"auth:google:signin:success",userInfo:t})}catch(e){this.bridge.dispatch({type:"auth:google:signin:error",error:e instanceof Error?e:new Error(String(e))})}}async handleGoogleSignOut(){try{await this.authService.signOutGoogle(),this.bridge.dispatch({type:"auth:google:signout:success"})}catch(e){this.bridge.dispatch({type:"auth:google:signout:error",error:e instanceof Error?e:new Error(String(e))})}}async handleBoxSignIn(){try{await this.authService.signInBox(),this.bridge.dispatch({type:"auth:box:signin:success"})}catch(e){this.bridge.dispatch({type:"auth:box:signin:error",error:e instanceof Error?e:new Error(String(e))})}}async handleBoxSignOut(){try{await this.authService.signOutBox(),this.bridge.dispatch({type:"auth:box:signout:success"})}catch(e){this.bridge.dispatch({type:"auth:box:signout:error",error:e instanceof Error?e:new Error(String(e))})}}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[]}}new fo;qi(uo,{target:document.getElementById("app")});
