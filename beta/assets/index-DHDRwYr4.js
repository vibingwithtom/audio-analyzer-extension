var da=Object.defineProperty;var nr=n=>{throw TypeError(n)};var ha=(n,e,t)=>e in n?da(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var gt=(n,e,t)=>ha(n,typeof e!="symbol"?e+"":e,t),xn=(n,e,t)=>e.has(n)||nr("Cannot "+t);var w=(n,e,t)=>(xn(n,e,"read from private field"),t?t.call(n):e.get(n)),G=(n,e,t)=>e.has(n)?nr("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),$=(n,e,t,r)=>(xn(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),re=(n,e,t)=>(xn(n,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();const yr=!1;var Ht=Array.isArray,va=Array.prototype.indexOf,qn=Array.from,ln=Object.defineProperty,yt=Object.getOwnPropertyDescriptor,Sr=Object.getOwnPropertyDescriptors,ga=Object.prototype,pa=Array.prototype,jn=Object.getPrototypeOf,rr=Object.isExtensible;const $e=()=>{};function ma(n){return n()}function cn(n){for(var e=0;e<n.length;e++)n[e]()}function Er(){var n,e,t=new Promise((r,a)=>{n=r,e=a});return{promise:t,resolve:n,reject:e}}function Ir(n,e){if(Array.isArray(n))return n;if(!(Symbol.iterator in n))return Array.from(n);const t=[];for(const r of n)if(t.push(r),t.length===e)break;return t}const ue=2,Ar=4,mn=8,ft=16,Me=32,dt=64,Vn=128,me=256,un=512,ne=1024,de=2048,Pe=4096,Ae=8192,ht=16384,Gn=32768,_n=65536,ar=1<<17,_a=1<<18,Bt=1<<19,kr=1<<20,Rn=1<<21,bn=1<<22,st=1<<23,We=Symbol("$state"),ba=Symbol("legacy props"),wa=Symbol(""),zt=new class extends Error{constructor(){super(...arguments);gt(this,"name","StaleReactionError");gt(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function ya(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Sa(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ea(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ia(n){throw new Error("https://svelte.dev/e/effect_orphan")}function Aa(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ka(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function xa(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Da(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ta(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Fa(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const wn=1,yn=2,xr=4,Ra=8,Ca=16,Oa=1,$a=2,Ba=4,Ma=8,Pa=16,Na=1,za=2,ee=Symbol(),La="http://www.w3.org/1999/xhtml";function Ua(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function qa(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let ja=!1;function Dr(n){return n===this.v}function Tr(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Fr(n){return!Tr(n,this.v)}let Jt=!1,Va=!1;function Ga(){Jt=!0}let K=null;function Ft(n){K=n}function Xe(n,e=!1,t){K={p:K,c:null,e:null,s:n,x:null,l:Jt&&!e?{s:null,u:null,$:[]}:null}}function Ke(n){var e=K,t=e.e;if(t!==null){e.e=null;for(var r of t)Vr(r)}return K=e.p,{}}function Yt(){return!Jt||K!==null&&K.l===null}let _t=[];function Wa(){var n=_t;_t=[],cn(n)}function Rt(n){if(_t.length===0){var e=_t;queueMicrotask(()=>{e===_t&&Wa()})}_t.push(n)}const Ha=new WeakMap;function Rr(n){var e=q;if(e===null)return P.f|=st,n;if((e.f&Gn)===0){if((e.f&Vn)===0)throw!e.parent&&n instanceof Error&&Cr(n),n;e.b.error(n)}else Ct(n,e)}function Ct(n,e){for(;e!==null;){if((e.f&Vn)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n instanceof Error&&Cr(n),n}function Cr(n){const e=Ha.get(n);e&&(ln(n,"message",{value:e.message}),ln(n,"stack",{value:e.stack}))}const tn=new Set;let Q=null,Cn=new Set,Ue=[],Wn=null,On=!1;var At,kt,et,Vt,xt,Dt,tt,Tt,Gt,Wt,we,$n,rn,Bn;const wt=class wt{constructor(){G(this,we);gt(this,"current",new Map);G(this,At,new Map);G(this,kt,new Set);G(this,et,0);G(this,Vt,null);G(this,xt,[]);G(this,Dt,[]);G(this,tt,[]);G(this,Tt,[]);G(this,Gt,[]);G(this,Wt,[]);gt(this,"skipped_effects",new Set)}process(e){Ue=[];var t=wt.apply(this);for(const s of e)re(this,we,$n).call(this,s);if(w(this,et)===0){re(this,we,Bn).call(this);var r=w(this,Dt),a=w(this,tt);$(this,Dt,[]),$(this,tt,[]),$(this,Tt,[]),Q=null,sr(r),sr(a),w(this,Vt)?.resolve()}else re(this,we,rn).call(this,w(this,Dt)),re(this,we,rn).call(this,w(this,tt)),re(this,we,rn).call(this,w(this,Tt));t();for(const s of w(this,xt))$t(s);$(this,xt,[])}capture(e,t){w(this,At).has(e)||w(this,At).set(e,t),this.current.set(e,e.v)}activate(){Q=this}deactivate(){Q=null}flush(){if(Ue.length>0){if(this.activate(),Ja(),Q!==null&&Q!==this)return}else w(this,et)===0&&re(this,we,Bn).call(this);this.deactivate();for(const e of Cn)if(Cn.delete(e),e(),Q!==null)break}increment(){$(this,et,w(this,et)+1)}decrement(){$(this,et,w(this,et)-1);for(const e of w(this,Gt))ae(e,de),ct(e);for(const e of w(this,Wt))ae(e,Pe),ct(e);this.flush()}add_callback(e){w(this,kt).add(e)}settled(){return(w(this,Vt)??$(this,Vt,Er())).promise}static ensure(){if(Q===null){const e=Q=new wt;tn.add(Q),wt.enqueue(()=>{Q===e&&e.flush()})}return Q}static enqueue(e){Rt(e)}static apply(e){return $e}};At=new WeakMap,kt=new WeakMap,et=new WeakMap,Vt=new WeakMap,xt=new WeakMap,Dt=new WeakMap,tt=new WeakMap,Tt=new WeakMap,Gt=new WeakMap,Wt=new WeakMap,we=new WeakSet,$n=function(e){e.f^=ne;for(var t=e.first;t!==null;){var r=t.f,a=(r&(Me|dt))!==0,s=a&&(r&ne)!==0,i=s||(r&Ae)!==0||this.skipped_effects.has(t);if(!i&&t.fn!==null){a?t.f^=ne:(r&Ar)!==0?w(this,tt).push(t):(r&ne)===0&&((r&bn)!==0&&t.b?.is_pending()?w(this,xt).push(t):Qt(t)&&((t.f&ft)!==0&&w(this,Tt).push(t),$t(t)));var o=t.first;if(o!==null){t=o;continue}}var l=t.parent;for(t=t.next;t===null&&l!==null;)t=l.next,l=l.parent}},rn=function(e){for(const t of e)((t.f&de)!==0?w(this,Gt):w(this,Wt)).push(t),ae(t,ne);e.length=0},Bn=function(){var e;for(const t of w(this,kt))t();if(w(this,kt).clear(),tn.size>1){w(this,At).clear();let t=!0;for(const r of tn){if(r===this){t=!1;continue}for(const[a,s]of this.current){if(r.current.has(a))if(t)r.current.set(a,s);else continue;Or(a)}if(Ue.length>0){Q=r;const a=wt.apply(r);for(const s of Ue)re(e=r,we,$n).call(e,s);Ue=[],a()}}Q=null}tn.delete(this)};let Ce=wt;function Ja(){var n=Et;On=!0;try{var e=0;for(ur(!0);Ue.length>0;){var t=Ce.ensure();if(e++>1e3){var r,a;Ya()}t.process(Ue),He.clear()}}finally{On=!1,ur(n),Wn=null}}function Ya(){try{Aa()}catch(n){Ct(n,Wn)}}let Ze=null;function sr(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var r=n[t++];if((r.f&(ht|Ae))===0&&Qt(r)&&(Ze=[],$t(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?Hr(r):r.fn=null),Ze?.length>0)){He.clear();for(const a of Ze)$t(a);Ze=[]}}Ze=null}}function Or(n){if(n.reactions!==null)for(const e of n.reactions){const t=e.f;(t&ue)!==0?Or(e):(t&(bn|ft))!==0&&(ae(e,de),ct(e))}}function ct(n){for(var e=Wn=n;e.parent!==null;){e=e.parent;var t=e.f;if(On&&e===q&&(t&ft)!==0)return;if((t&(dt|Me))!==0){if((t&ne)===0)return;e.f^=ne}}Ue.push(e)}function Xa(n){let e=0,t=ut(0),r;return()=>{hs()&&(E(t),An(()=>(e===0&&(r=B(()=>n(()=>Lt(t)))),e+=1,()=>{Rt(()=>{e-=1,e===0&&(r?.(),r=void 0,Lt(t))})})))}}var Ka=_n|Bt|Vn;function Za(n,e,t){new Qa(n,e,t)}var ye,ge,Un,xe,nt,De,pe,le,Te,qe,rt,je,at,Ve,gn,pn,ie,es,ts,an,sn,Mn;class Qa{constructor(e,t,r){G(this,ie);gt(this,"parent");G(this,ye,!1);G(this,ge);G(this,Un,null);G(this,xe);G(this,nt);G(this,De);G(this,pe,null);G(this,le,null);G(this,Te,null);G(this,qe,null);G(this,rt,0);G(this,je,0);G(this,at,!1);G(this,Ve,null);G(this,gn,()=>{w(this,Ve)&&Ot(w(this,Ve),w(this,rt))});G(this,pn,Xa(()=>($(this,Ve,ut(w(this,rt))),()=>{$(this,Ve,null)})));$(this,ge,e),$(this,xe,t),$(this,nt,r),this.parent=q.b,$(this,ye,!!w(this,xe).pending),$(this,De,Yn(()=>{q.b=this;{try{$(this,pe,Se(()=>r(w(this,ge))))}catch(a){this.error(a)}w(this,je)>0?re(this,ie,sn).call(this):$(this,ye,!1)}},Ka))}is_pending(){return w(this,ye)||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!w(this,xe).pending}update_pending_count(e){re(this,ie,Mn).call(this,e),$(this,rt,w(this,rt)+e),Cn.add(w(this,gn))}get_effect_pending(){return w(this,pn).call(this),E(w(this,Ve))}error(e){var t=w(this,xe).onerror;let r=w(this,xe).failed;if(w(this,at)||!t&&!r)throw e;w(this,pe)&&(_e(w(this,pe)),$(this,pe,null)),w(this,le)&&(_e(w(this,le)),$(this,le,null)),w(this,Te)&&(_e(w(this,Te)),$(this,Te,null));var a=!1,s=!1;const i=()=>{if(a){qa();return}a=!0,s&&Fa(),Ce.ensure(),$(this,rt,0),w(this,Te)!==null&&St(w(this,Te),()=>{$(this,Te,null)}),$(this,ye,this.has_pending_snippet()),$(this,pe,re(this,ie,an).call(this,()=>($(this,at,!1),Se(()=>w(this,nt).call(this,w(this,ge)))))),w(this,je)>0?re(this,ie,sn).call(this):$(this,ye,!1)};var o=P;try{ce(null),s=!0,t?.(e,i),s=!1}catch(l){Ct(l,w(this,De)&&w(this,De).parent)}finally{ce(o)}r&&Rt(()=>{$(this,Te,re(this,ie,an).call(this,()=>{$(this,at,!0);try{return Se(()=>{r(w(this,ge),()=>e,()=>i)})}catch(l){return Ct(l,w(this,De).parent),null}finally{$(this,at,!1)}}))})}}ye=new WeakMap,ge=new WeakMap,Un=new WeakMap,xe=new WeakMap,nt=new WeakMap,De=new WeakMap,pe=new WeakMap,le=new WeakMap,Te=new WeakMap,qe=new WeakMap,rt=new WeakMap,je=new WeakMap,at=new WeakMap,Ve=new WeakMap,gn=new WeakMap,pn=new WeakMap,ie=new WeakSet,es=function(){try{$(this,pe,Se(()=>w(this,nt).call(this,w(this,ge))))}catch(e){this.error(e)}$(this,ye,!1)},ts=function(){const e=w(this,xe).pending;e&&($(this,le,Se(()=>e(w(this,ge)))),Ce.enqueue(()=>{$(this,pe,re(this,ie,an).call(this,()=>(Ce.ensure(),Se(()=>w(this,nt).call(this,w(this,ge)))))),w(this,je)>0?re(this,ie,sn).call(this):(St(w(this,le),()=>{$(this,le,null)}),$(this,ye,!1))}))},an=function(e){var t=q,r=P,a=K;Fe(w(this,De)),ce(w(this,De)),Ft(w(this,De).ctx);try{return e()}catch(s){return Rr(s),null}finally{Fe(t),ce(r),Ft(a)}},sn=function(){const e=w(this,xe).pending;w(this,pe)!==null&&($(this,qe,document.createDocumentFragment()),ns(w(this,pe),w(this,qe))),w(this,le)===null&&$(this,le,Se(()=>e(w(this,ge))))},Mn=function(e){var t;if(!this.has_pending_snippet()){this.parent&&re(t=this.parent,ie,Mn).call(t,e);return}$(this,je,w(this,je)+e),w(this,je)===0&&($(this,ye,!1),w(this,le)&&St(w(this,le),()=>{$(this,le,null)}),w(this,qe)&&(w(this,ge).before(w(this,qe)),$(this,qe,null)),Rt(()=>{Ce.ensure().flush()}))};function ns(n,e){for(var t=n.nodes_start,r=n.nodes_end;t!==null;){var a=t===r?null:Zt(t);e.append(t),t=a}}function rs(n,e,t){const r=Yt()?Xt:Sn;if(e.length===0){t(n.map(r));return}var a=Q,s=q,i=as();Promise.all(e.map(o=>ss(o))).then(o=>{i();try{t([...n.map(r),...o])}catch(l){(s.f&ht)===0&&Ct(l,s)}a?.deactivate(),$r()}).catch(o=>{Ct(o,s)})}function as(){var n=q,e=P,t=K,r=Q;return function(){Fe(n),ce(e),Ft(t),r?.activate()}}function $r(){Fe(null),ce(null),Ft(null)}function Xt(n){var e=ue|de,t=P!==null&&(P.f&ue)!==0?P:null;return q===null||t!==null&&(t.f&me)!==0?e|=me:q.f|=Bt,{ctx:K,deps:null,effects:null,equals:Dr,f:e,fn:n,reactions:null,rv:0,v:ee,wv:0,parent:t??q,ac:null}}function ss(n,e){let t=q;t===null&&ya();var r=t.b,a=void 0,s=ut(ee),i=!P,o=new Map;return ps(()=>{var l=Er();a=l.promise;try{Promise.resolve(n()).then(l.resolve,l.reject)}catch(f){l.reject(f)}var c=Q,u=r.is_pending();i&&(r.update_pending_count(1),u||(c.increment(),o.get(c)?.reject(zt),o.set(c,l)));const d=(f,p=void 0)=>{u||c.activate(),p?p!==zt&&(s.f|=st,Ot(s,p)):((s.f&st)!==0&&(s.f^=st),Ot(s,f)),i&&(r.update_pending_count(-1),u||c.decrement()),$r()};l.promise.then(d,f=>d(null,f||"unknown"))}),In(()=>{for(const l of o.values())l.reject(zt)}),new Promise(l=>{function c(u){function d(){u===a?l(s):c(a)}u.then(d,d)}c(a)})}function Br(n){const e=Xt(n);return Xr(e),e}function Sn(n){const e=Xt(n);return e.equals=Fr,e}function Mr(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)_e(e[t])}}function is(n){for(var e=n.parent;e!==null;){if((e.f&ue)===0)return e;e=e.parent}return null}function Hn(n){var e,t=q;Fe(is(n));try{Mr(n),e=ea(n)}finally{Fe(t)}return e}function Pr(n){var e=Hn(n);if(n.equals(e)||(n.v=e,n.wv=Zr()),!vt){var t=(Ge||(n.f&me)!==0)&&n.deps!==null?Pe:ne;ae(n,t)}}const He=new Map;function ut(n,e){var t={f:0,v:n,reactions:null,equals:Dr,rv:0,wv:0};return t}function Le(n,e){const t=ut(n);return Xr(t),t}function Ee(n,e=!1,t=!0){var a;const r=ut(n);return e||(r.equals=Fr),Jt&&t&&K!==null&&K.l!==null&&((a=K.l).s??(a.s=[])).push(r),r}function J(n,e,t=!1){P!==null&&(!Ie||(P.f&ar)!==0)&&Yt()&&(P.f&(ue|ft|bn|ar))!==0&&!Be?.includes(n)&&Ta();let r=t?bt(e):e;return Ot(n,r)}function Ot(n,e){if(!n.equals(e)){var t=n.v;vt?He.set(n,e):He.set(n,t),n.v=e;var r=Ce.ensure();r.capture(n,t),(n.f&ue)!==0&&((n.f&de)!==0&&Hn(n),ae(n,(n.f&me)===0?ne:Pe)),n.wv=Zr(),Nr(n,de),Yt()&&q!==null&&(q.f&ne)!==0&&(q.f&(Me|dt))===0&&(ve===null?bs([n]):ve.push(n))}return e}function Lt(n){J(n,n.v+1)}function Nr(n,e){var t=n.reactions;if(t!==null)for(var r=Yt(),a=t.length,s=0;s<a;s++){var i=t[s],o=i.f;if(!(!r&&i===q)){var l=(o&de)===0;l&&ae(i,e),(o&ue)!==0?Nr(i,Pe):l&&((o&ft)!==0&&Ze!==null&&Ze.push(i),ct(i))}}}function bt(n){if(typeof n!="object"||n===null||We in n)return n;const e=jn(n);if(e!==ga&&e!==pa)return n;var t=new Map,r=Ht(n),a=Le(0),s=it,i=o=>{if(it===s)return o();var l=P,c=it;ce(null),dr(s);var u=o();return ce(l),dr(c),u};return r&&t.set("length",Le(n.length)),new Proxy(n,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&xa();var u=t.get(l);return u===void 0?u=i(()=>{var d=Le(c.value);return t.set(l,d),d}):J(u,c.value,!0),!0},deleteProperty(o,l){var c=t.get(l);if(c===void 0){if(l in o){const u=i(()=>Le(ee));t.set(l,u),Lt(a)}}else J(c,ee),Lt(a);return!0},get(o,l,c){if(l===We)return n;var u=t.get(l),d=l in o;if(u===void 0&&(!d||yt(o,l)?.writable)&&(u=i(()=>{var p=bt(d?o[l]:ee),h=Le(p);return h}),t.set(l,u)),u!==void 0){var f=E(u);return f===ee?void 0:f}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var u=t.get(l);u&&(c.value=E(u))}else if(c===void 0){var d=t.get(l),f=d?.v;if(d!==void 0&&f!==ee)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(o,l){if(l===We)return!0;var c=t.get(l),u=c!==void 0&&c.v!==ee||Reflect.has(o,l);if(c!==void 0||q!==null&&(!u||yt(o,l)?.writable)){c===void 0&&(c=i(()=>{var f=u?bt(o[l]):ee,p=Le(f);return p}),t.set(l,c));var d=E(c);if(d===ee)return!1}return u},set(o,l,c,u){var d=t.get(l),f=l in o;if(r&&l==="length")for(var p=c;p<d.v;p+=1){var h=t.get(p+"");h!==void 0?J(h,ee):p in o&&(h=i(()=>Le(ee)),t.set(p+"",h))}if(d===void 0)(!f||yt(o,l)?.writable)&&(d=i(()=>Le(void 0)),J(d,bt(c)),t.set(l,d));else{f=d.v!==ee;var v=i(()=>bt(c));J(d,v)}var g=Reflect.getOwnPropertyDescriptor(o,l);if(g?.set&&g.set.call(u,c),!f){if(r&&typeof l=="string"){var b=t.get("length"),S=Number(l);Number.isInteger(S)&&S>=b.v&&J(b,S+1)}Lt(a)}return!0},ownKeys(o){E(a);var l=Reflect.ownKeys(o).filter(d=>{var f=t.get(d);return f===void 0||f.v!==ee});for(var[c,u]of t)u.v!==ee&&!(c in o)&&l.push(c);return l},setPrototypeOf(){Da()}})}function ir(n){try{if(n!==null&&typeof n=="object"&&We in n)return n[We]}catch{}return n}function os(n,e){return Object.is(ir(n),ir(e))}var or,zr,Lr,Ur;function ls(){if(or===void 0){or=window,zr=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;Lr=yt(e,"firstChild").get,Ur=yt(e,"nextSibling").get,rr(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),rr(t)&&(t.__t=void 0)}}function Kt(n=""){return document.createTextNode(n)}function fn(n){return Lr.call(n)}function Zt(n){return Ur.call(n)}function D(n,e){return fn(n)}function te(n,e=!1){{var t=fn(n);return t instanceof Comment&&t.data===""?Zt(t):t}}function x(n,e=1,t=!1){let r=n;for(;e--;)r=Zt(r);return r}function cs(n){n.textContent=""}function qr(){return!1}let lr=!1;function us(){lr||(lr=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function En(n){var e=P,t=q;ce(null),Fe(null);try{return n()}finally{ce(e),Fe(t)}}function fs(n,e,t,r=t){n.addEventListener(e,()=>En(t));const a=n.__on_r;a?n.__on_r=()=>{a(),r(!0)}:n.__on_r=()=>r(!0),us()}function jr(n){q===null&&P===null&&Ia(),P!==null&&(P.f&me)!==0&&q===null&&Ea(),vt&&Sa()}function ds(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Ne(n,e,t,r=!0){var a=q;a!==null&&(a.f&Ae)!==0&&(n|=Ae);var s={ctx:K,deps:null,nodes_start:null,nodes_end:null,f:n|de,first:null,fn:e,last:null,next:null,parent:a,b:a&&a.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(t)try{$t(s),s.f|=Gn}catch(l){throw _e(s),l}else e!==null&&ct(s);if(r){var i=s;if(t&&i.deps===null&&i.teardown===null&&i.nodes_start===null&&i.first===i.last&&(i.f&Bt)===0&&(i=i.first),i!==null&&(i.parent=a,a!==null&&ds(i,a),P!==null&&(P.f&ue)!==0&&(n&dt)===0)){var o=P;(o.effects??(o.effects=[])).push(i)}}return s}function hs(){return P!==null&&!Ie}function In(n){const e=Ne(mn,null,!1);return ae(e,ne),e.teardown=n,e}function cr(n){jr();var e=q.f,t=!P&&(e&Me)!==0&&(e&Gn)===0;if(t){var r=K;(r.e??(r.e=[])).push(n)}else return Vr(n)}function Vr(n){return Ne(Ar|kr,n,!1)}function vs(n){return jr(),Ne(mn|kr,n,!0)}function gs(n){Ce.ensure();const e=Ne(dt|Bt,n,!0);return(t={})=>new Promise(r=>{t.outro?St(e,()=>{_e(e),r(void 0)}):(_e(e),r(void 0))})}function dn(n,e){var t=K,r={effect:null,ran:!1,deps:n};t.l.$.push(r),r.effect=An(()=>{n(),!r.ran&&(r.ran=!0,B(e))})}function Jn(){var n=K;An(()=>{for(var e of n.l.$){e.deps();var t=e.effect;(t.f&ne)!==0&&ae(t,Pe),Qt(t)&&$t(t),e.ran=!1}})}function ps(n){return Ne(bn|Bt,n,!0)}function An(n,e=0){return Ne(mn|e,n,!0)}function X(n,e=[],t=[]){rs(e,t,r=>{Ne(mn,()=>n(...r.map(E)),!0)})}function Yn(n,e=0){var t=Ne(ft|e,n,!0);return t}function Se(n,e=!0){return Ne(Me|Bt,n,!0,e)}function Gr(n){var e=n.teardown;if(e!==null){const t=vt,r=P;fr(!0),ce(null);try{e.call(null)}finally{fr(t),ce(r)}}}function Wr(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const a=t.ac;a!==null&&En(()=>{a.abort(zt)});var r=t.next;(t.f&dt)!==0?t.parent=null:_e(t,e),t=r}}function ms(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&Me)===0&&_e(e),e=t}}function _e(n,e=!0){var t=!1;(e||(n.f&_a)!==0)&&n.nodes_start!==null&&n.nodes_end!==null&&(_s(n.nodes_start,n.nodes_end),t=!0),Wr(n,e&&!t),hn(n,0),ae(n,ht);var r=n.transitions;if(r!==null)for(const s of r)s.stop();Gr(n);var a=n.parent;a!==null&&a.first!==null&&Hr(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes_start=n.nodes_end=n.ac=null}function _s(n,e){for(;n!==null;){var t=n===e?null:Zt(n);n.remove(),n=t}}function Hr(n){var e=n.parent,t=n.prev,r=n.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===n&&(e.first=r),e.last===n&&(e.last=t))}function St(n,e){var t=[];Xn(n,t,!0),Jr(t,()=>{_e(n),e&&e()})}function Jr(n,e){var t=n.length;if(t>0){var r=()=>--t||e();for(var a of n)a.out(r)}else e()}function Xn(n,e,t){if((n.f&Ae)===0){if(n.f^=Ae,n.transitions!==null)for(const i of n.transitions)(i.is_global||t)&&e.push(i);for(var r=n.first;r!==null;){var a=r.next,s=(r.f&_n)!==0||(r.f&Me)!==0;Xn(r,e,s?t:!1),r=a}}}function Kn(n){Yr(n,!0)}function Yr(n,e){if((n.f&Ae)!==0){n.f^=Ae,(n.f&ne)===0&&(ae(n,de),ct(n));for(var t=n.first;t!==null;){var r=t.next,a=(t.f&_n)!==0||(t.f&Me)!==0;Yr(t,a?e:!1),t=r}if(n.transitions!==null)for(const s of n.transitions)(s.is_global||e)&&s.in()}}let Et=!1;function ur(n){Et=n}let vt=!1;function fr(n){vt=n}let P=null,Ie=!1;function ce(n){P=n}let q=null;function Fe(n){q=n}let Be=null;function Xr(n){P!==null&&(Be===null?Be=[n]:Be.push(n))}let se=null,fe=0,ve=null;function bs(n){ve=n}let Kr=1,jt=0,it=jt;function dr(n){it=n}let Ge=!1;function Zr(){return++Kr}function Qt(n){var e=n.f;if((e&de)!==0)return!0;if((e&Pe)!==0){var t=n.deps,r=(e&me)!==0;if(t!==null){var a,s,i=(e&un)!==0,o=r&&q!==null&&!Ge,l=t.length;if((i||o)&&(q===null||(q.f&ht)===0)){var c=n,u=c.parent;for(a=0;a<l;a++)s=t[a],(i||!s?.reactions?.includes(c))&&(s.reactions??(s.reactions=[])).push(c);i&&(c.f^=un),o&&u!==null&&(u.f&me)===0&&(c.f^=me)}for(a=0;a<l;a++)if(s=t[a],Qt(s)&&Pr(s),s.wv>n.wv)return!0}(!r||q!==null&&!Ge)&&ae(n,ne)}return!1}function Qr(n,e,t=!0){var r=n.reactions;if(r!==null&&!Be?.includes(n))for(var a=0;a<r.length;a++){var s=r[a];(s.f&ue)!==0?Qr(s,e,!1):e===s&&(t?ae(s,de):(s.f&ne)!==0&&ae(s,Pe),ct(s))}}function ea(n){var v;var e=se,t=fe,r=ve,a=P,s=Ge,i=Be,o=K,l=Ie,c=it,u=n.f;se=null,fe=0,ve=null,Ge=(u&me)!==0&&(Ie||!Et||P===null),P=(u&(Me|dt))===0?n:null,Be=null,Ft(n.ctx),Ie=!1,it=++jt,n.ac!==null&&(En(()=>{n.ac.abort(zt)}),n.ac=null);try{n.f|=Rn;var d=n.fn,f=d(),p=n.deps;if(se!==null){var h;if(hn(n,fe),p!==null&&fe>0)for(p.length=fe+se.length,h=0;h<se.length;h++)p[fe+h]=se[h];else n.deps=p=se;if(!Ge||(u&ue)!==0&&n.reactions!==null)for(h=fe;h<p.length;h++)((v=p[h]).reactions??(v.reactions=[])).push(n)}else p!==null&&fe<p.length&&(hn(n,fe),p.length=fe);if(Yt()&&ve!==null&&!Ie&&p!==null&&(n.f&(ue|Pe|de))===0)for(h=0;h<ve.length;h++)Qr(ve[h],n);return a!==null&&a!==n&&(jt++,ve!==null&&(r===null?r=ve:r.push(...ve))),(n.f&st)!==0&&(n.f^=st),f}catch(g){return Rr(g)}finally{n.f^=Rn,se=e,fe=t,ve=r,P=a,Ge=s,Be=i,Ft(o),Ie=l,it=c}}function ws(n,e){let t=e.reactions;if(t!==null){var r=va.call(t,n);if(r!==-1){var a=t.length-1;a===0?t=e.reactions=null:(t[r]=t[a],t.pop())}}t===null&&(e.f&ue)!==0&&(se===null||!se.includes(e))&&(ae(e,Pe),(e.f&(me|un))===0&&(e.f^=un),Mr(e),hn(e,0))}function hn(n,e){var t=n.deps;if(t!==null)for(var r=e;r<t.length;r++)ws(n,t[r])}function $t(n){var e=n.f;if((e&ht)===0){ae(n,ne);var t=q,r=Et;q=n,Et=!0;try{(e&ft)!==0?ms(n):Wr(n),Gr(n);var a=ea(n);n.teardown=typeof a=="function"?a:null,n.wv=Kr;var s;yr&&Va&&(n.f&de)!==0&&n.deps}finally{Et=r,q=t}}}function E(n){var e=n.f,t=(e&ue)!==0;if(P!==null&&!Ie){var r=q!==null&&(q.f&ht)!==0;if(!r&&!Be?.includes(n)){var a=P.deps;if((P.f&Rn)!==0)n.rv<jt&&(n.rv=jt,se===null&&a!==null&&a[fe]===n?fe++:se===null?se=[n]:(!Ge||!se.includes(n))&&se.push(n));else{(P.deps??(P.deps=[])).push(n);var s=n.reactions;s===null?n.reactions=[P]:s.includes(P)||s.push(P)}}}else if(t&&n.deps===null&&n.effects===null){var i=n,o=i.parent;o!==null&&(o.f&me)===0&&(i.f^=me)}if(vt){if(He.has(n))return He.get(n);if(t){i=n;var l=i.v;return((i.f&ne)===0&&i.reactions!==null||ta(i))&&(l=Hn(i)),He.set(i,l),l}}else t&&(i=n,Qt(i)&&Pr(i));if((n.f&st)!==0)throw n.v;return n.v}function ta(n){if(n.v===ee)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(He.has(e)||(e.f&ue)!==0&&ta(e))return!0;return!1}function B(n){var e=Ie;try{return Ie=!0,n()}finally{Ie=e}}const ys=-7169;function ae(n,e){n.f=n.f&ys|e}function It(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(We in n)Pn(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&We in t&&Pn(t)}}}function Pn(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let r in n)try{Pn(n[r],e)}catch{}const t=jn(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=Sr(t);for(let a in r){const s=r[a].get;if(s)try{s.call(n)}catch{}}}}}const Ss=["touchstart","touchmove"];function Es(n){return Ss.includes(n)}const Is=new Set,hr=new Set;function As(n,e,t,r={}){function a(s){if(r.capture||Nt.call(e,s),!s.cancelBubble)return En(()=>t?.call(this,s))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Rt(()=>{e.addEventListener(n,a,r)}):e.addEventListener(n,a,r),a}function be(n,e,t,r,a){var s={capture:r,passive:a},i=As(n,e,t,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&In(()=>{e.removeEventListener(n,i,s)})}let vr=null;function Nt(n){var e=this,t=e.ownerDocument,r=n.type,a=n.composedPath?.()||[],s=a[0]||n.target;vr=n;var i=0,o=vr===n&&n.__root;if(o){var l=a.indexOf(o);if(l!==-1&&(e===document||e===window)){n.__root=e;return}var c=a.indexOf(e);if(c===-1)return;l<=c&&(i=l)}if(s=a[i]||n.target,s!==e){ln(n,"currentTarget",{configurable:!0,get(){return s||t}});var u=P,d=q;ce(null),Fe(null);try{for(var f,p=[];s!==null;){var h=s.assignedSlot||s.parentNode||s.host||null;try{var v=s["__"+r];if(v!=null&&(!s.disabled||n.target===s))if(Ht(v)){var[g,...b]=v;g.apply(s,[n,...b])}else v.call(s,n)}catch(S){f?p.push(S):f=S}if(n.cancelBubble||h===e||h===null)break;s=h}if(f){for(let S of p)queueMicrotask(()=>{throw S});throw f}}finally{n.__root=e,delete n.currentTarget,ce(u),Fe(d)}}}function ks(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function Nn(n,e){var t=q;t.nodes_start===null&&(t.nodes_start=n,t.nodes_end=e)}function M(n,e){var t=(e&Na)!==0,r=(e&za)!==0,a,s=!n.startsWith("<!>");return()=>{a===void 0&&(a=ks(s?n:"<!>"+n),t||(a=fn(a)));var i=r||zr?document.importNode(a,!0):a.cloneNode(!0);if(t){var o=fn(i),l=i.lastChild;Nn(o,l)}else Nn(i,i);return i}}function Ut(){var n=document.createDocumentFragment(),e=document.createComment(""),t=Kt();return n.append(e,t),Nn(e,t),n}function R(n,e){n!==null&&n.before(e)}function Y(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??(n.__t=n.nodeValue))&&(n.__t=t,n.nodeValue=t+"")}function xs(n,e){return Ds(n,e)}const pt=new Map;function Ds(n,{target:e,anchor:t,props:r={},events:a,context:s,intro:i=!0}){ls();var o=new Set,l=d=>{for(var f=0;f<d.length;f++){var p=d[f];if(!o.has(p)){o.add(p);var h=Es(p);e.addEventListener(p,Nt,{passive:h});var v=pt.get(p);v===void 0?(document.addEventListener(p,Nt,{passive:h}),pt.set(p,1)):pt.set(p,v+1)}}};l(qn(Is)),hr.add(l);var c=void 0,u=gs(()=>{var d=t??e.appendChild(Kt());return Za(d,{pending:()=>{}},f=>{if(s){Xe({});var p=K;p.c=s}a&&(r.$$events=a),c=n(f,r)||{},s&&Ke()}),()=>{for(var f of o){e.removeEventListener(f,Nt);var p=pt.get(f);--p===0?(document.removeEventListener(f,Nt),pt.delete(f)):pt.set(f,p)}hr.delete(l),d!==t&&d.parentNode?.removeChild(d)}});return Ts.set(c,u),c}let Ts=new WeakMap;function j(n,e,t=!1){var r=n,a=null,s=null,i=ee,o=t?_n:0,l=!1;const c=(p,h=!0)=>{l=!0,f(h,p)};var u=null;function d(){u!==null&&(u.lastChild.remove(),r.before(u),u=null);var p=i?a:s,h=i?s:a;p&&Kn(p),h&&St(h,()=>{i?s=null:a=null})}const f=(p,h)=>{if(i!==(i=p)){var v=qr(),g=r;if(v&&(u=document.createDocumentFragment(),u.append(g=Kt())),i?a??(a=h&&Se(()=>h(g))):s??(s=h&&Se(()=>h(g))),v){var b=Q,S=i?a:s,m=i?s:a;S&&b.skipped_effects.delete(S),m&&b.skipped_effects.add(m),b.add_callback(d)}else d()}};Yn(()=>{l=!1,e(c),l||f(null,null)},o)}function Zn(n,e){return e}function Fs(n,e,t){for(var r=n.items,a=[],s=e.length,i=0;i<s;i++)Xn(e[i].e,a,!0);var o=s>0&&a.length===0&&t!==null;if(o){var l=t.parentNode;cs(l),l.append(t),r.clear(),ke(n,e[0].prev,e[s-1].next)}Jr(a,()=>{for(var c=0;c<s;c++){var u=e[c];o||(r.delete(u.k),ke(n,u.prev,u.next)),_e(u.e,!o)}})}function Qn(n,e,t,r,a,s=null){var i=n,o={flags:e,items:new Map,first:null},l=(e&xr)!==0;if(l){var c=n;i=c.appendChild(Kt())}var u=null,d=!1,f=new Map,p=Sn(()=>{var b=t();return Ht(b)?b:b==null?[]:qn(b)}),h,v;function g(){Rs(v,h,o,f,i,a,e,r,t),s!==null&&(h.length===0?u?Kn(u):u=Se(()=>s(i)):u!==null&&St(u,()=>{u=null}))}Yn(()=>{v??(v=q),h=E(p);var b=h.length;if(!(d&&b===0)){d=b===0;var S,m,_,k;if(qr()){var I=new Set,y=Q;for(m=0;m<b;m+=1){_=h[m],k=r(_,m);var C=o.items.get(k)??f.get(k);C?(e&(wn|yn))!==0&&na(C,_,m,e):(S=ra(null,o,null,null,_,k,m,a,e,t,!0),f.set(k,S)),I.add(k)}for(const[U,O]of o.items)I.has(U)||y.skipped_effects.add(O.e);y.add_callback(g)}else g();E(p)}})}function Rs(n,e,t,r,a,s,i,o,l){var c=(i&Ra)!==0,u=(i&(wn|yn))!==0,d=e.length,f=t.items,p=t.first,h=p,v,g=null,b,S=[],m=[],_,k,I,y;if(c)for(y=0;y<d;y+=1)_=e[y],k=o(_,y),I=f.get(k),I!==void 0&&(I.a?.measure(),(b??(b=new Set)).add(I));for(y=0;y<d;y+=1){if(_=e[y],k=o(_,y),I=f.get(k),I===void 0){var C=r.get(k);if(C!==void 0){r.delete(k),f.set(k,C);var U=g?g.next:h;ke(t,g,C),ke(t,C,U),Dn(C,U,a),g=C}else{var O=h?h.e.nodes_start:a;g=ra(O,t,g,g===null?t.first:g.next,_,k,y,s,i,l)}f.set(k,g),S=[],m=[],h=g.next;continue}if(u&&na(I,_,y,i),(I.e.f&Ae)!==0&&(Kn(I.e),c&&(I.a?.unfix(),(b??(b=new Set)).delete(I))),I!==h){if(v!==void 0&&v.has(I)){if(S.length<m.length){var N=m[0],z;g=N.prev;var F=S[0],V=S[S.length-1];for(z=0;z<S.length;z+=1)Dn(S[z],N,a);for(z=0;z<m.length;z+=1)v.delete(m[z]);ke(t,F.prev,V.next),ke(t,g,F),ke(t,V,N),h=N,g=V,y-=1,S=[],m=[]}else v.delete(I),Dn(I,h,a),ke(t,I.prev,I.next),ke(t,I,g===null?t.first:g.next),ke(t,g,I),g=I;continue}for(S=[],m=[];h!==null&&h.k!==k;)(h.e.f&Ae)===0&&(v??(v=new Set)).add(h),m.push(h),h=h.next;if(h===null)continue;I=h}S.push(I),g=I,h=I.next}if(h!==null||v!==void 0){for(var A=v===void 0?[]:qn(v);h!==null;)(h.e.f&Ae)===0&&A.push(h),h=h.next;var T=A.length;if(T>0){var L=(i&xr)!==0&&d===0?a:null;if(c){for(y=0;y<T;y+=1)A[y].a?.measure();for(y=0;y<T;y+=1)A[y].a?.fix()}Fs(t,A,L)}}c&&Rt(()=>{if(b!==void 0)for(I of b)I.a?.apply()}),n.first=t.first&&t.first.e,n.last=g&&g.e;for(var W of r.values())_e(W.e);r.clear()}function na(n,e,t,r){(r&wn)!==0&&Ot(n.v,e),(r&yn)!==0?Ot(n.i,t):n.i=t}function ra(n,e,t,r,a,s,i,o,l,c,u){var d=(l&wn)!==0,f=(l&Ca)===0,p=d?f?Ee(a,!1,!1):ut(a):a,h=(l&yn)===0?i:ut(i),v={i:h,v:p,k:s,a:null,e:null,prev:t,next:r};try{if(n===null){var g=document.createDocumentFragment();g.append(n=Kt())}return v.e=Se(()=>o(n,p,h,c),ja),v.e.prev=t&&t.e,v.e.next=r&&r.e,t===null?u||(e.first=v):(t.next=v,t.e.next=v.e),r!==null&&(r.prev=v,r.e.prev=v.e),v}finally{}}function Dn(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,a=e?e.e.nodes_start:t,s=n.e.nodes_start;s!==null&&s!==r;){var i=Zt(s);a.before(s),s=i}}function ke(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const gr=[...` 	
\r\f \v\uFEFF`];function Cs(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var a in t)if(t[a])r=r?r+" "+a:a;else if(r.length)for(var s=a.length,i=0;(i=r.indexOf(a,i))>=0;){var o=i+s;(i===0||gr.includes(r[i-1]))&&(o===r.length||gr.includes(r[o]))?r=(i===0?"":r.substring(0,i))+r.substring(o+1):i=o}}return r===""?null:r}function qt(n,e,t,r,a,s){var i=n.__className;if(i!==t||i===void 0){var o=Cs(t,r,s);o==null?n.removeAttribute("class"):n.className=o,n.__className=t}else if(s&&a!==s)for(var l in s){var c=!!s[l];(a==null||c!==!!a[l])&&n.classList.toggle(l,c)}return s}function aa(n,e,t=!1){if(n.multiple){if(e==null)return;if(!Ht(e))return Ua();for(var r of n.options)r.selected=e.includes(pr(r));return}for(r of n.options){var a=pr(r);if(os(a,e)){r.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function Os(n){var e=new MutationObserver(()=>{aa(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),In(()=>{e.disconnect()})}function pr(n){return"__value"in n?n.__value:n.value}const $s=Symbol("is custom element"),Bs=Symbol("is html");function ot(n,e,t,r){var a=Ms(n);a[e]!==(a[e]=t)&&(e==="loading"&&(n[wa]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Ps(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Ms(n){return n.__attributes??(n.__attributes={[$s]:n.nodeName.includes("-"),[Bs]:n.namespaceURI===La})}var mr=new Map;function Ps(n){var e=n.getAttribute("is")||n.nodeName,t=mr.get(e);if(t)return t;mr.set(e,t=[]);for(var r,a=n,s=Element.prototype;s!==a;){r=Sr(a);for(var i in r)r[i].set&&t.push(i);a=jn(a)}return t}function Ns(n,e,t=e){fs(n,"change",r=>{var a=r?n.defaultChecked:n.checked;t(a)}),B(e)==null&&t(n.checked),An(()=>{var r=e();n.checked=!!r})}function _r(n){return function(...e){var t=e[0];return t.preventDefault(),n?.apply(this,e)}}function Mt(n=!1){const e=K,t=e.l.u;if(!t)return;let r=()=>It(e.s);if(n){let a=0,s={};const i=Xt(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==s[c]&&(s[c]=l[c],o=!0);return o&&a++,a});r=()=>E(i)}t.b.length&&vs(()=>{br(e,r),cn(t.b)}),cr(()=>{const a=B(()=>t.m.map(ma));return()=>{for(const s of a)typeof s=="function"&&s()}}),t.a.length&&cr(()=>{br(e,r),cn(t.a)})}function br(n,e){if(n.l.s)for(const t of n.l.s)E(t);e()}function zs(n,e){var t=n.$$events?.[e.type],r=Ht(t)?t.slice():t==null?[]:[t];for(var a of r)a.call(this,e)}function er(n,e,t){if(n==null)return e(void 0),t&&t(void 0),$e;const r=B(()=>n.subscribe(e,t));return r.unsubscribe?()=>r.unsubscribe():r}const mt=[];function Ls(n,e){return{subscribe:en(n,e).subscribe}}function en(n,e=$e){let t=null;const r=new Set;function a(o){if(Tr(n,o)&&(n=o,t)){const l=!mt.length;for(const c of r)c[1](),mt.push(c,n);if(l){for(let c=0;c<mt.length;c+=2)mt[c][0](mt[c+1]);mt.length=0}}}function s(o){a(o(n))}function i(o,l=$e){const c=[o,l];return r.add(c),r.size===1&&(t=e(a,s)||$e),o(n),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:a,update:s,subscribe:i}}function on(n,e,t){const r=!Array.isArray(n),a=r?[n]:n;if(!a.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return Ls(t,(i,o)=>{let l=!1;const c=[];let u=0,d=$e;const f=()=>{if(u)return;d();const h=e(r?c[0]:c,i,o);s?i(h):d=typeof h=="function"?h:$e},p=a.map((h,v)=>er(h,g=>{c[v]=g,u&=~(1<<v),l&&f()},()=>{u|=1<<v}));return l=!0,f(),function(){cn(p),d(),l=!1}})}function Us(n){let e;return er(n,t=>e=t)(),e}let nn=!1,zn=Symbol();function Ye(n,e,t){const r=t[e]??(t[e]={store:null,source:Ee(void 0),unsubscribe:$e});if(r.store!==n&&!(zn in t))if(r.unsubscribe(),r.store=n??null,n==null)r.source.v=void 0,r.unsubscribe=$e;else{var a=!0;r.unsubscribe=er(n,s=>{a?r.source.v=s:J(r.source,s)}),a=!1}return n&&zn in t?Us(n):E(r.source)}function Pt(){const n={};function e(){In(()=>{for(var t in n)n[t].unsubscribe();ln(n,zn,{enumerable:!1,value:!0})})}return[n,e]}function qs(n){var e=nn;try{return nn=!1,[n(),nn]}finally{nn=e}}function Je(n,e,t,r){var a=!Jt||(t&$a)!==0,s=(t&Ma)!==0,i=(t&Pa)!==0,o=r,l=!0,c=()=>(l&&(l=!1,o=i?B(r):r),o),u;if(s){var d=We in n||ba in n;u=yt(n,e)?.set??(d&&e in n?m=>n[e]=m:void 0)}var f,p=!1;s?[f,p]=qs(()=>n[e]):f=n[e],f===void 0&&r!==void 0&&(f=c(),u&&(a&&ka(),u(f)));var h;if(a?h=()=>{var m=n[e];return m===void 0?c():(l=!0,m)}:h=()=>{var m=n[e];return m!==void 0&&(o=void 0),m===void 0?o:m},a&&(t&Ba)===0)return h;if(u){var v=n.$$legacy;return(function(m,_){return arguments.length>0?((!a||!_||v||p)&&u(_?h():m),m):h()})}var g=!1,b=((t&Oa)!==0?Xt:Sn)(()=>(g=!1,h()));s&&E(b);var S=q;return(function(m,_){if(arguments.length>0){const k=_?E(b):a&&s?bt(m):m;return J(b,k),g=!0,o!==void 0&&(o=k),m}return vt&&g||(S.f&ht)!==0?b.v:E(b)})}const js="5";var wr;typeof window<"u"&&((wr=window.__svelte??(window.__svelte={})).v??(wr.v=new Set)).add(js);Ga();function Vs(){const{subscribe:n,set:e}=en("local");return{subscribe:n,setTab:t=>e(t)}}const vn=Vs();class Oe extends EventTarget{constructor(){super(),this.setupDebugLogging()}static getInstance(){return Oe.instance||(Oe.instance=new Oe),Oe.instance}dispatch(e){const t=new CustomEvent("app:event",{detail:e,bubbles:!1,cancelable:!1});this.dispatchEvent(t)}on(e,t){const r=a=>{const s=a;s.detail.type===e&&t(s.detail)};return this.addEventListener("app:event",r),()=>this.removeEventListener("app:event",r)}onAll(e){const t=r=>{e(r.detail)};return this.addEventListener("app:event",t),()=>this.removeEventListener("app:event",t)}once(e,t){let r=null;const a=s=>{t(s),r&&r()};return r=this.on(e,a),r}clearAllListeners(){const e=this._listeners;e&&Object.keys(e).forEach(t=>{delete e[t]})}setupDebugLogging(){typeof window<"u"&&localStorage.getItem("debugBridge")==="true"&&this.onAll(e=>{console.log("[AppBridge]",e.type,e)})}}typeof window<"u"&&(window.enableBridgeDebug=()=>{localStorage.setItem("debugBridge","true"),console.log("AppBridge debug logging enabled. Reload the page to see events.")},window.disableBridgeDebug=()=>{localStorage.removeItem("debugBridge"),console.log("AppBridge debug logging disabled.")});var Gs=M('<nav class="tabs sv-tab-nav svelte-1mmy281" aria-label="Main navigation"><button>📁 Local Files</button> <button>☁️ Google Drive</button> <button>📦 Box</button></nav>');function Ws(n,e){Xe(e,!1);const t=()=>Ye(vn,"$currentTab",r),[r,a]=Pt(),s=Oe.getInstance();function i(h){vn.setTab(h),s.dispatch({type:"tab:changed",tab:h})}Mt();var o=Gs(),l=D(o);let c;var u=x(l,2);let d;var f=x(u,2);let p;X((h,v,g)=>{c=qt(l,1,"tab-button svelte-1mmy281",null,c,h),ot(l,"aria-current",t()==="local"?"page":void 0),d=qt(u,1,"tab-button svelte-1mmy281",null,d,v),ot(u,"aria-current",t()==="googleDrive"?"page":void 0),p=qt(f,1,"tab-button svelte-1mmy281",null,p,g),ot(f,"aria-current",t()==="box"?"page":void 0)},[()=>({active:t()==="local"}),()=>({active:t()==="googleDrive"}),()=>({active:t()==="box"})]),be("click",l,()=>i("local")),be("click",u,()=>i("googleDrive")),be("click",f,()=>i("box")),R(n,o),Ke(),a()}var Hs=M("<p>Processing...</p>"),Js=M('<div class="file-upload-wrapper svelte-heqs4d"><label class="file-upload-label svelte-heqs4d">Upload a file</label> <input type="file"/> <!></div>');function Ys(n,e){let t=Je(e,"id",8),r=Je(e,"processing",8,!1),a=Je(e,"accept",8,"audio/*");var s=Js(),i=D(s),o=x(i,2),l=x(o,2);{var c=u=>{var d=Hs();R(u,d)};j(l,u=>{r()&&u(c)})}X(()=>{ot(i,"for",t()),ot(o,"id",t()),ot(o,"accept",a()),o.disabled=r()}),be("change",o,function(u){zs.call(this,e,u)}),R(n,s)}var Xs=M("<span> </span>");function Ks(n,e){Xe(e,!1);const t=Ee();let r=Je(e,"status",8);const a={pass:{icon:"✓",class:"badge-success",text:"Pass"},fail:{icon:"✗",class:"badge-danger",text:"Fail"},warning:{icon:"⚠",class:"badge-warning",text:"Warning"},error:{icon:"✗",class:"badge-danger",text:"Error"}};dn(()=>It(r()),()=>{J(t,a[r()]||a.error)}),Jn();var s=Xs(),i=D(s);X(()=>{qt(s,1,`badge ${E(t),B(()=>E(t).class)??""}`,"svelte-1hqr9xd"),Y(i,`${E(t),B(()=>E(t).icon)??""} ${E(t),B(()=>E(t).text)??""}`)}),R(n,s),Ke()}var Zs=M('<div class="batch-summary svelte-1bx7qjq"><h3>Summary</h3> <p> </p></div>'),Qs=M('<th class="svelte-1bx7qjq">Sample Rate</th> <th class="svelte-1bx7qjq">Bit Depth</th> <th class="svelte-1bx7qjq">Channels</th> <th class="svelte-1bx7qjq">Duration</th>',1),ei=M('<th class="svelte-1bx7qjq">Play</th>'),ti=M('<td class="svelte-1bx7qjq"> </td> <td class="svelte-1bx7qjq"> </td> <td class="svelte-1bx7qjq"> </td> <td class="svelte-1bx7qjq"> </td>',1),ni=M("<audio controls></audio>"),ri=M('<td class="svelte-1bx7qjq"><!></td>'),ai=M('<tr><td class="svelte-1bx7qjq"> </td><td class="svelte-1bx7qjq"><!></td><!><td class="svelte-1bx7qjq"> </td><!></tr>'),si=M('<div class="results-container svelte-1bx7qjq"><!> <table class="results-table svelte-1bx7qjq"><thead><tr><th class="svelte-1bx7qjq">Filename</th><th class="svelte-1bx7qjq">Status</th><!><th class="svelte-1bx7qjq">File Size</th><!></tr></thead><tbody></tbody></table></div>');function ii(n,e){Xe(e,!1);const t=Ee(),r=Ee();let a=Je(e,"results",24,()=>[]),s=Je(e,"mode",8,"single"),i=Je(e,"metadataOnly",8,!1);function o(m,_=2){if(m===0)return"0 Bytes";const k=1024,I=_<0?0:_,y=["Bytes","KB","MB","GB","TB"],C=Math.floor(Math.log(m)/Math.log(k));return parseFloat((m/Math.pow(k,C)).toFixed(I))+" "+y[C]}dn(()=>It(s()),()=>{J(t,s()==="single")}),dn(()=>(It(s()),It(a())),()=>{J(r,s()==="batch"?{total:a().length,passed:a().filter(m=>m.status==="pass").length,failed:a().filter(m=>m.status==="fail").length,warnings:a().filter(m=>m.status==="warning").length,errors:a().filter(m=>m.status==="error").length}:null)}),Jn(),Mt();var l=si(),c=D(l);{var u=m=>{var _=Zs(),k=x(D(_),2),I=D(k);X(()=>Y(I,`${E(r),B(()=>E(r).total)??""} files: ${E(r),B(()=>E(r).passed)??""} passed, ${E(r),B(()=>E(r).failed)??""} failed`)),R(m,_)};j(c,m=>{s()==="batch"&&E(r)&&m(u)})}var d=x(c,2),f=D(d),p=D(f),h=x(D(p),2);{var v=m=>{var _=Qs();R(m,_)};j(h,m=>{i()||m(v)})}var g=x(h,2);{var b=m=>{var _=ei();R(m,_)};j(g,m=>{E(t)&&m(b)})}var S=x(f);Qn(S,5,a,Zn,(m,_)=>{var k=ai(),I=D(k),y=D(I),C=x(I),U=D(C);Ks(U,{get status(){return E(_),B(()=>E(_).status)}});var O=x(C);{var N=T=>{var L=ti(),W=te(L),H=D(W),oe=x(W,2),Re=D(oe),ze=x(oe,2),ca=D(ze),ua=x(ze,2),fa=D(ua);X(()=>{Y(H,`${E(_),B(()=>E(_).sampleRate)??""} Hz`),Y(Re,`${E(_),B(()=>E(_).bitDepth)??""} bit`),Y(ca,(E(_),B(()=>E(_).channels))),Y(fa,`${E(_),B(()=>E(_).duration)??""}s`)}),R(T,L)};j(O,T=>{i()||T(N)})}var z=x(O),F=D(z),V=x(z);{var A=T=>{var L=ri(),W=D(L);{var H=oe=>{var Re=ni();X(()=>ot(Re,"src",(E(_),B(()=>E(_).audioUrl)))),R(oe,Re)};j(W,oe=>{E(_),B(()=>E(_).audioUrl)&&oe(H)})}R(T,L)};j(V,T=>{E(t)&&T(A)})}X(T=>{Y(y,(E(_),B(()=>E(_).filename))),Y(F,T)},[()=>(E(_),B(()=>o(E(_).fileSize)))]),R(m,k)}),R(n,l),Ke()}var oi=M("<span> </span>"),li=M("<div><strong> </strong> <!></div>"),ci=M('<div class="validation-display svelte-jf5q0v"><h3>Validation Details</h3> <!></div>');function ui(n,e){let t=Je(e,"validation",8);var r=Ut(),a=te(r);{var s=i=>{var o=ci(),l=x(D(o),2);Qn(l,1,()=>(It(t()),B(()=>Object.entries(t()))),Zn,(c,u)=>{var d=Br(()=>Ir(E(u),2));let f=()=>E(d)[0],p=()=>E(d)[1];var h=li(),v=D(h),g=D(v),b=x(v),S=x(b);{var m=_=>{var k=oi(),I=D(k);X(()=>Y(I,`(${p(),B(()=>p().issue)??""})`)),R(_,k)};j(S,_=>{p(),B(()=>p().issue)&&_(m)})}X(()=>{qt(h,1,`validation-item ${p(),B(()=>p().status)??""}`,"svelte-jf5q0v"),Y(g,`${f()??""}:`),Y(b,` ${p(),B(()=>p().value)??""} `)}),R(c,h)}),R(i,o)};j(a,i=>{t()&&i(s)})}R(n,r)}class fi{constructor(){this.audioContext=null,this.audioBuffer=null}async analyzeFile(e){const t=await e.arrayBuffer();if(e.name.toLowerCase().endsWith(".wav")){const r=new DataView(t),a=this.parseWavHeaders(r);let s=this.getFileType(e.name);return s==="WAV"&&(a.audioFormat===1?s="WAV (PCM)":typeof a.audioFormat=="number"?s=`WAV (Compressed - Format ${a.audioFormat})`:s="WAV (Unknown Format)"),{fileType:s,sampleRate:a.sampleRate,channels:a.channels,bitDepth:a.bitDepth,duration:a.duration,fileSize:e.size}}this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext));try{const r=t.slice(0);return this.audioBuffer=await this.audioContext.decodeAudioData(r),{fileType:this.getFileType(e.name),sampleRate:this.audioBuffer.sampleRate,channels:this.audioBuffer.numberOfChannels,duration:this.audioBuffer.duration,fileSize:e.size,bitDepth:this.estimateBitDepth(t,e.name)}}catch{return await this.analyzeFileHeaders(t,e.name,e.size)}}async analyzeFileHeaders(e,t,r){const a=new DataView(e),s={fileType:this.getFileType(t),fileSize:r};if(t.toLowerCase().endsWith(".wav")){const i=this.parseWavHeaders(a);Object.assign(s,i)}else s.sampleRate="Unknown",s.bitDepth="Unknown",s.channels="Unknown",s.duration="Unknown";return s}parseWavHeaders(e){try{if(String.fromCharCode(e.getUint8(0),e.getUint8(1),e.getUint8(2),e.getUint8(3))!=="RIFF")throw new Error("Not a valid WAV file");if(String.fromCharCode(e.getUint8(8),e.getUint8(9),e.getUint8(10),e.getUint8(11))!=="WAVE")throw new Error("Not a valid WAV file");let a=12;for(;a<e.byteLength-8;){const s=String.fromCharCode(e.getUint8(a),e.getUint8(a+1),e.getUint8(a+2),e.getUint8(a+3)),i=e.getUint32(a+4,!0);if(s==="fmt "){const o=e.getUint16(a+8,!0),l=e.getUint16(a+10,!0),c=e.getUint32(a+12,!0),u=e.getUint16(a+22,!0),d=this.calculateWavDuration(e,c,l,u);return{sampleRate:c,channels:l,bitDepth:u,duration:d,audioFormat:o}}a+=8+i}throw new Error("fmt chunk not found")}catch(t){return console.error("Error parsing WAV headers:",t),{sampleRate:"Unknown",channels:"Unknown",bitDepth:"Unknown",duration:"Unknown",audioFormat:"Unknown"}}}calculateWavDuration(e,t,r,a){try{let s=12;for(;s<e.byteLength-8;){const i=String.fromCharCode(e.getUint8(s),e.getUint8(s+1),e.getUint8(s+2),e.getUint8(s+3)),o=e.getUint32(s+4,!0);if(i==="data"){const l=a/8;return o/(r*l)/t}s+=8+o}return"Unknown"}catch{return"Unknown"}}getFileType(e){const t=e.split(".").pop().toLowerCase();return{wav:"WAV",mp3:"MP3",flac:"FLAC",aac:"AAC",m4a:"M4A",ogg:"OGG",webm:"WebM"}[t]||t.toUpperCase()}estimateBitDepth(e,t){if(t.toLowerCase().endsWith(".wav"))return"See WAV analysis";const r=t.split(".").pop().toLowerCase();return["mp3","aac","m4a"].includes(r)?"Compressed (variable)":"Unknown"}}class di{constructor(){this.analysisInProgress=!1}async analyzeAudioBuffer(e,t=null){const r=e.sampleRate,a=e.numberOfChannels,s=e.length,i=[];for(let o=0;o<a;o++)i.push(e.getChannelData(o));this.analysisInProgress=!0;try{t&&t("Analyzing peak levels...",0);let o=0;for(let b=0;b<a;b++){const S=i[b];for(let m=0;m<s;m++){if(!this.analysisInProgress)throw new Error("Analysis cancelled");const _=Math.abs(S[m]);if(_>o&&(o=_),m%1e4===0){const k=(b*s+m)/(a*s)*.5;t&&t("Analyzing peak levels...",k),m%1e5===0&&await new Promise(I=>setTimeout(I,1))}}}const l=o>0?20*Math.log10(o):-1/0;t&&t("Analyzing noise floor...",.5);const c=await this.analyzeNoiseFloor(i,a,s,t),u=await this.analyzeNoiseFloorHistogram(i,a,s);t&&t("Checking normalization...",.9);const d=this.checkNormalization(l);t&&t("Estimating reverb...",.95);const f=await this.estimateReverb(i,a,s,r,u),p=this.interpretReverb(f);t&&t("Analyzing silence...",.98);const{leadingSilence:h,trailingSilence:v,longestSilence:g}=this.analyzeSilence(i,a,s,r,u,l);return t&&t("Analysis complete!",1),{peakDb:l,noiseFloorDb:c,noiseFloorDbHistogram:u,normalizationStatus:d,reverbInfo:p,leadingSilence:h,trailingSilence:v,longestSilence:g}}finally{this.analysisInProgress=!1}}interpretReverb(e){return e<=0?{time:e,label:"N/A",description:"No reverb detected."}:e<.3?{time:e,label:"Excellent (Dry)",description:"Ideal for voiceover. Matches a vocal booth or well-treated studio environment."}:e<.5?{time:e,label:"Good (Controlled)",description:"A well-controlled room with minimal reflections. Acceptable for most recording."}:e<.8?{time:e,label:"Fair (Slightly Live)",description:"Noticeable room reflections. May reduce clarity for voiceover work."}:e<1.2?{time:e,label:"Poor (Reverberant)",description:"Significant reverb is present, making the recording sound distant and unprofessional."}:{time:e,label:"Very Poor (Echoey)",description:"Excessive echo and reverb. Unsuitable for professional voice recording."}}analyzeSilence(e,t,r,a,s,i){const o=i-s,l=.25,c=Math.max(0,o),u=s+c*l,d=Math.pow(10,u/20),f=50,p=Math.floor(a*(f/1e3)),h=Math.ceil(r/p),g=Math.ceil(150/f),b=new Array(h).fill(0);for(let O=0;O<h;O++){const N=O*p,z=Math.min(N+p,r);let F=0;for(let V=0;V<t;V++){const A=e[V];for(let T=N;T<z;T++){const L=Math.abs(A[T]);L>F&&(F=L)}}F>d&&(b[O]=1)}let S=0;for(let O=0;O<h;O++)if(b[O]===1)S++;else{if(S>0&&S<g)for(let N=1;N<=S;N++)b[O-N]=0;S=0}if(S>0&&S<g)for(let O=1;O<=S;O++)b[h-O]=0;let m=0,_=0;for(let O=0;O<h;O++)b[O]===0?_++:(_>m&&(m=_),_=0);_>m&&(m=_);const k=m*(f/1e3),I=b.indexOf(1),y=b.lastIndexOf(1);let C=0,U=0;return I===-1?(C=r/a,U=r/a):(C=I*(f/1e3),U=(h-1-y)*(f/1e3)),{leadingSilence:C,trailingSilence:U,longestSilence:k}}async estimateReverb(e,t,r,a,s){const c=Math.floor(a*.02),u=-25;let d=[];const f=e[0];let p=0;for(let g=0;g<r-1024;g+=1024){let b=0;for(let m=g;m<g+1024;m++)b+=f[m]*f[m];const S=Math.sqrt(b/1024);if(S>p*1.5&&S>.01){let m=0,_=g;for(let I=g;I<g+1024;I++)Math.abs(f[I])>m&&(m=Math.abs(f[I]),_=I);const k=20*Math.log10(m);if(k>s+10){let I=-1;for(let y=_;y<r-c;y+=c){let C=0;for(let N=y;N<y+c;N++)C+=f[N]*f[N];const U=Math.sqrt(C/c);if((U>0?20*Math.log10(U):-120)<k+u){I=y;break}}if(I!==-1){const y=(I-_)/a;if(y>0){const C=y*(60/Math.abs(u));d.push(C)}}}}p=S}if(d.length<1)return 0;d.sort((g,b)=>g-b);const h=Math.floor(d.length/2);return d.length%2!==0?d[h]:(d[h-1]+d[h])/2}async analyzeNoiseFloorHistogram(e,t,r){const s=new Array(100).fill(0),i=-100,o=100,l=Math.floor(44100*.05);for(let f=0;f<t;f++){const p=e[f];for(let h=0;h<r;h+=l){const v=Math.min(h+l,r);let g=0;for(let m=h;m<v;m++)g+=p[m]*p[m];const b=Math.sqrt(g/(v-h)),S=b>0?20*Math.log10(b):i;if(S>=i){const m=Math.min(Math.floor((S-i)/o*100),99);s[m]++}}}let c=-1,u=0;for(let f=0;f<100;f++)s[f]>u&&(u=s[f],c=f);return c===-1?-1/0:c*(o/100)+i}async analyzeNoiseFloor(e,t,r,a){const s=Math.floor(r/100),i=[];for(let d=0;d<t;d++){const f=e[d];for(let p=0;p<r-s;p+=s){let h=0;for(let g=p;g<p+s&&g<r;g++)h+=f[g]*f[g];const v=Math.sqrt(h/s);i.push(v)}}i.sort((d,f)=>d-f);const o=Math.floor(i.length*.2),l=i.slice(0,o),c=l.reduce((d,f)=>d+f,0)/l.length;return c>0?20*Math.log10(c):-1/0}checkNormalization(e){let a,s;return Math.abs(e- -6)<=.1?(a="normalized",s="Properly normalized"):e>-6?(a="too_loud",s="Too loud"):(a="too_quiet",s="Too quiet"),{status:a,message:s,peakDb:e,targetDb:-6}}cancelAnalysis(){this.analysisInProgress=!1}analyzeStereoSeparation(e){if(e.numberOfChannels!==2)return null;const t=e.getChannelData(0),r=e.getChannelData(1),a=e.sampleRate,s=e.length,i=Math.floor(a*.25),o=1.1,l=.001;let c=0,u=0,d=0,f=0,p=0;for(let _=0;_<s;_+=i){let k=0,I=0;const y=Math.min(_+i,s),C=y-_;for(let z=_;z<y;z++)k+=t[z]*t[z],I+=r[z]*r[z];const U=Math.sqrt(k/C),O=Math.sqrt(I/C);if(p++,U<l&&O<l){f++;continue}const N=U/O;N>o?c++:N<1/o?u++:d++}const h=p-f;let v="Undetermined",g=0,b=0,S=0,m=0;return h>0?(m=d/h,b=c/h,S=u/h,m>.9?(v="Mono as Stereo",g=m):b>.1&&S>.1?(v="Conversational Stereo",g=b+S):b>.9?(v="Mono in Left Channel",g=b):S>.9?(v="Mono in Right Channel",g=S):(v="Mixed Stereo",g=1-m)):(v="Silent",g=1),{totalBlocks:p,activeBlocks:h,silentBlocks:f,leftDominantBlocks:c,rightDominantBlocks:u,balancedBlocks:d,stereoType:v,stereoConfidence:Math.min(g,1)}}analyzeMicBleed(e){if(e.numberOfChannels!==2)return null;const t=e.getChannelData(0),r=e.getChannelData(1),a=e.sampleRate,s=e.length,i=Math.floor(a*.25),o=1.5,l=.001,c=15,u=[],d=[],f=[],p=[];for(let y=0;y<s;y+=i){let C=0,U=0;const O=Math.min(y+i,s),N=O-y;for(let A=y;A<O;A++)C+=t[A]*t[A],U+=r[A]*r[A];const z=Math.sqrt(C/N),F=Math.sqrt(U/N);if(z<l&&F<l)continue;const V=z/F;if(V>o){const A=20*Math.log10(z),T=F>0?20*Math.log10(F):-1/0,L=A-T;d.push(F),f.push(L),L<c&&p.push({startSample:y,endSample:O,dominantChannel:"left",separation:L,dominantRms:z,bleedRms:F})}else if(V<1/o){const A=20*Math.log10(F),T=z>0?20*Math.log10(z):-1/0,L=A-T;u.push(z),f.push(L),L<c&&p.push({startSample:y,endSample:O,dominantChannel:"right",separation:L,dominantRms:F,bleedRms:z})}}const h=y=>{if(y.length===0)return-1/0;const U=y.reduce((O,N)=>O+N,0)/y.length;return 20*Math.log10(U)},v=h(u),g=h(d);let b=-1/0,S=-1/0,m=0;if(f.length>0){const y=[...f].sort((N,z)=>N-z),C=Math.floor(y.length/2);b=y.length%2!==0?y[C]:(y[C-1]+y[C])/2;const U=Math.floor(y.length*.1);S=y[U],m=f.filter(N=>N<15).length/f.length*100}const _=[],k=.3;for(const y of p){const C=this.calculateCrossCorrelation(t,r,y.startSample,y.endSample,y.dominantChannel);C>k&&_.push({...y,correlation:C,timestamp:y.startSample/a})}const I=f.length>0?_.length/f.length*100:0;return{old:{leftChannelBleedDb:v,rightChannelBleedDb:g,leftBleedSamples:u.length,rightBleedSamples:d.length},new:{medianSeparation:b,p10Separation:S,percentagePoorSeparation:m,percentageConfirmedBleed:I,totalBlocks:f.length,concerningBlocks:p.length,confirmedBleedBlocks:_.length,worstBlocks:_.slice(0,5)}}}calculateCrossCorrelation(e,t,r,a,s){const i=a-r;let o=0,l=0;for(let v=r;v<a;v++)s==="left"?(o+=e[v],l+=t[v]):(o+=t[v],l+=e[v]);const c=o/i,u=l/i;let d=0,f=0,p=0;for(let v=r;v<a;v++){const g=s==="left"?e[v]:t[v],b=s==="left"?t[v]:e[v],S=g-c,m=b-u;d+=S*m,f+=S*S,p+=m*m}const h=Math.sqrt(f*p);return h===0?0:Math.abs(d/h)}}class tr{static matchesFileType(e,t){const r={matches:!1,status:"fail"};if(e===t)return r.matches=!0,r.status="pass",r;if(t==="wav"||t==="WAV")return e==="WAV (PCM)"||e==="WAV"?(r.matches=!0,r.status="pass",r):(e.startsWith("WAV")&&(r.matches=!0,r.status="warning"),r);const a=e.replace(/\s*\(.*\)/,"").trim(),s=t.toUpperCase();return a===s&&(r.matches=!0,r.status="pass"),r}static validateResults(e,t,r=!1){const a={},s=o=>o?Array.isArray(o)?o:[o]:[],i=s(t.fileType);if(i.length>0){let o={matches:!1,status:"fail"};for(const l of i){const c=this.matchesFileType(e.fileType,l);if(c.status==="pass"){o=c;break}else c.status==="warning"&&o.status==="fail"&&(o=c)}a.fileType={matches:o.matches,target:i,actual:e.fileType,status:o.status}}if(!r){const o=s(t.sampleRate).map(u=>parseInt(u)).filter(u=>!isNaN(u));if(o.length>0){const u=e.sampleRate;let d,f;u==="Unknown"||typeof u!="number"?(f=!1,d="warning"):(f=o.includes(u),d=f?"pass":"fail"),a.sampleRate={matches:f,target:o,actual:u,status:d}}const l=s(t.bitDepth).map(u=>parseInt(u)).filter(u=>!isNaN(u));if(l.length>0){const u=e.bitDepth;let d,f;u==="Unknown"||typeof u!="number"?(f=!1,d="warning"):(f=l.includes(u),d=f?"pass":"fail"),a.bitDepth={matches:f,target:l,actual:u,status:d}}const c=s(t.channels).map(u=>parseInt(u)).filter(u=>!isNaN(u));if(c.length>0){const u=e.channels;let d,f;u==="Unknown"||typeof u!="number"?(f=!1,d="warning"):(f=c.includes(u),d=f?"pass":"fail"),a.channels={matches:f,target:c,actual:u,status:d}}if(t.minDuration){const u=parseInt(t.minDuration),d=e.duration;let f,p;d==="Unknown"||typeof d!="number"?(p=!1,f="warning"):(p=d>=u,f=p?"pass":"warning"),a.duration={matches:p,target:`${u}s minimum`,actual:d,status:f}}}return a}static formatDuration(e){const t=Math.floor(e/3600),r=Math.floor(e%3600/60),a=Math.floor(e%60);return t>0?`${t}h:${r.toString().padStart(2,"0")}m:${a.toString().padStart(2,"0")}s`:`${r}m:${a.toString().padStart(2,"0")}s`}static formatDisplayText(e){const t={};return t.fileType=e.fileType,t.sampleRate=typeof e.sampleRate=="number"?`${(e.sampleRate/1e3).toFixed(1)} kHz`:e.sampleRate,t.bitDepth=typeof e.bitDepth=="number"?`${e.bitDepth}-bit`:e.bitDepth,t.channels=typeof e.channels=="number"?`${e.channels}${e.channels===1?" (Mono)":e.channels===2?" (Stereo)":""}`:e.channels,t.duration=typeof e.duration=="number"?tr.formatDuration(e.duration):e.duration,t.fileSize=`${(e.fileSize/1024/1024).toFixed(2)} MB`,t}static formatAdvancedResults(e){const t={};return t.peakLevel=e.peakDb===-1/0?"Silent":`${e.peakDb.toFixed(1)} dB`,t.peakStatus=e.peakDb<=-6?"pass":e.peakDb<=-3?"warning":"fail",t.noiseFloor=e.noiseFloorDb===-1/0?"Silent":`${e.noiseFloorDb.toFixed(1)} dB`,t.noiseStatus=e.noiseFloorDb<=-60?"pass":"fail",t.normalization=e.normalizationStatus.message,t.normalizationStatus=e.normalizationStatus.status==="normalized"?"pass":"fail",t}}const Z={SETTINGS:"audio-analyzer-settings",SELECTED_PRESET:"audio-analyzer-selected-preset",FILENAME_VALIDATION:"audio-analyzer-filename-validation",BOX_FILENAME_VALIDATION:"audio-analyzer-box-filename-validation",LOCAL_FILENAME_VALIDATION:"audio-analyzer-local-filename-validation",DARK_MODE:"darkMode",BOX_JUST_AUTHENTICATED:"box_just_authenticated"},hi={"auditions-character-recordings":{name:"Auditions: Character Recordings",fileType:["wav"],sampleRate:["48000"],bitDepth:["24"],channels:["1"],minDuration:"120"},"auditions-emotional-voice":{name:"Auditions: Emotional Voice",fileType:["wav"],sampleRate:["48000"],bitDepth:["16","24"],channels:["1","2"],minDuration:"30"},"character-recordings":{name:"Character Recordings",fileType:["wav"],sampleRate:["48000"],bitDepth:["24"],channels:["1"],minDuration:""},"p2b2-pairs-mono":{name:"P2B2 Pairs (Mono)",fileType:["wav"],sampleRate:["44100","48000"],bitDepth:["16","24"],channels:["1"],minDuration:""},"p2b2-pairs-stereo":{name:"P2B2 Pairs (Stereo)",fileType:["wav"],sampleRate:["44100","48000"],bitDepth:["16","24"],channels:["2"],minDuration:""},"p2b2-pairs-mixed":{name:"P2B2 Pairs (Mixed)",fileType:["wav"],sampleRate:["44100","48000"],bitDepth:["16","24"],channels:["1","2"],minDuration:""},"three-hour":{name:"Three Hour",fileType:["wav"],sampleRate:["48000"],bitDepth:["24"],channels:["1"],minDuration:"",supportsFilenameValidation:!0,filenameValidationType:"script-match",gdriveOnly:!0},"bilingual-conversational":{name:"Bilingual Conversational",fileType:["wav"],sampleRate:["48000"],bitDepth:["16","24"],channels:["2"],minDuration:"",supportsFilenameValidation:!0,filenameValidationType:"bilingual-pattern"},custom:{name:"Custom"}};class lt{static getCriteria(){const e=localStorage.getItem(Z.SETTINGS);if(!e)return null;try{return JSON.parse(e).criteria||null}catch(t){return console.warn("Failed to load criteria from localStorage:",t),null}}static saveCriteria(e){const t={criteria:e};localStorage.setItem(Z.SETTINGS,JSON.stringify(t))}static getSelectedPreset(){return localStorage.getItem(Z.SELECTED_PRESET)}static saveSelectedPreset(e){localStorage.setItem(Z.SELECTED_PRESET,e)}static getPresetConfigurations(){return hi}static getPresetConfig(e){return this.getPresetConfigurations()[e]||null}static loadFilenameValidationSettings(){const e=localStorage.getItem(Z.FILENAME_VALIDATION),t={enableAudioAnalysis:!0,enableFilenameValidation:!1,speakerId:"",scriptsFolderUrl:""};if(!e)return t;try{const r=JSON.parse(e);return{enableAudioAnalysis:r.enableAudioAnalysis!==!1,enableFilenameValidation:r.enableFilenameValidation||!1,speakerId:r.speakerId||"",scriptsFolderUrl:r.scriptsFolderUrl||""}}catch(r){return console.error("Error loading filename validation settings:",r),t}}static saveFilenameValidationSettings(e){localStorage.setItem(Z.FILENAME_VALIDATION,JSON.stringify(e))}static loadBoxFilenameValidationSettings(){const e=localStorage.getItem(Z.BOX_FILENAME_VALIDATION),t={enableAudioAnalysis:!0,enableFilenameValidation:!1};if(!e)return t;try{const r=JSON.parse(e);return{enableAudioAnalysis:r.enableAudioAnalysis!==!1,enableFilenameValidation:r.enableFilenameValidation||!1}}catch(r){return console.error("Error loading Box filename validation settings:",r),t}}static saveBoxFilenameValidationSettings(e){localStorage.setItem(Z.BOX_FILENAME_VALIDATION,JSON.stringify(e))}static loadLocalFilenameValidationSettings(){const e=localStorage.getItem(Z.LOCAL_FILENAME_VALIDATION),t={enableAudioAnalysis:!0,enableFilenameValidation:!1};if(!e)return t;try{const r=JSON.parse(e);return{enableAudioAnalysis:r.enableAudioAnalysis!==!1,enableFilenameValidation:r.enableFilenameValidation||!1}}catch(r){return console.error("Error loading local filename validation settings:",r),t}}static saveLocalFilenameValidationSettings(e){localStorage.setItem(Z.LOCAL_FILENAME_VALIDATION,JSON.stringify(e))}static getDarkModePreference(){const e=localStorage.getItem(Z.DARK_MODE);return e===null?null:e==="true"}static saveDarkModePreference(e){localStorage.setItem(Z.DARK_MODE,e?"true":"false")}static wasBoxJustAuthenticated(){return localStorage.getItem(Z.BOX_JUST_AUTHENTICATED)==="true"}static clearBoxAuthenticationFlag(){localStorage.removeItem(Z.BOX_JUST_AUTHENTICATED)}static setBoxAuthenticationFlag(){localStorage.setItem(Z.BOX_JUST_AUTHENTICATED,"true")}static clearAllSettings(){Object.values(Z).forEach(e=>{localStorage.removeItem(e)})}static exportSettings(){const e={};return Object.entries(Z).forEach(([t,r])=>{const a=localStorage.getItem(r);if(a!==null)try{e[t]=JSON.parse(a)}catch{e[t]=a}}),e}static importSettings(e){Object.entries(e).forEach(([t,r])=>{const a=Z[t];if(a){const s=typeof r=="string"?r:JSON.stringify(r);localStorage.setItem(a,s)}})}}const kn=en(lt.getSelectedPreset()||"custom");kn.subscribe(n=>{if(n&&(lt.saveSelectedPreset(n),n!=="custom")){const e=lt.getPresetConfig(n);if(e){const t={fileType:e.fileType||[],sampleRate:e.sampleRate||[],bitDepth:e.bitDepth||[],channels:e.channels||[],minDuration:e.minDuration||""};lt.saveCriteria(t)}}});const vi=en(lt.getCriteria()),Ln=lt.getPresetConfigurations(),gi=on(kn,n=>n?lt.getPresetConfig(n):null);function pi(n){kn.set(n)}const sa={subscribe:kn.subscribe},mi={subscribe:vi.subscribe};var _i=M('<div class="current-preset svelte-ujtmwg"><span class="preset-label svelte-ujtmwg">Current Preset:</span> <span class="preset-name svelte-ujtmwg"> </span> <a href="#" class="svelte-ujtmwg">Change</a></div>'),bi=M('<div class="no-preset-warning svelte-ujtmwg"><span>⚠️ No preset selected. Files will be analyzed without validation.</span> <a href="#" class="svelte-ujtmwg">Select a preset</a></div>'),wi=M('<div class="error-message svelte-ujtmwg"> </div>'),yi=M('<div class="processing-indicator svelte-ujtmwg">Processing file...</div>'),Si=M("<!> <!>",1),Ei=M('<div class="local-file-tab svelte-ujtmwg"><!> <!> <div class="options svelte-ujtmwg"><label class="svelte-ujtmwg"><input type="checkbox" class="svelte-ujtmwg"/> Metadata Only (skip audio analysis for faster processing)</label></div> <!> <!> <!></div>');function Ii(n,e){Xe(e,!1);const t=()=>Ye(mi,"$currentCriteria",a),r=()=>Ye(sa,"$currentPresetId",a),[a,s]=Pt();function i(){vn.setTab("settings")}let o=Ee(!1),l=Ee(""),c=Ee(!1),u=Ee(null),d=Ee(null);const f=new fi,p=new di;async function h(F){const A=F.target?.files?.[0];if(A){J(o,!0),J(l,""),J(u,null),J(d,null);try{const T=await f.analyzeFile(A);let L=null;if(!E(c)){const oe=new(window.AudioContext||window.webkitAudioContext),Re=await A.arrayBuffer(),ze=await oe.decodeAudioData(Re);L=await p.analyzeAudioBuffer(ze)}const W={filename:A.name,fileSize:A.size,...T,...L||{}},H=t();if(H&&r()!=="custom"){J(d,tr.validateResults(W,H,E(c)));let oe="pass";if(E(d)){const Re=Object.values(E(d));Re.some(ze=>ze.status==="fail")?oe="fail":Re.some(ze=>ze.status==="warning")&&(oe="warning")}J(u,{...W,status:oe,validation:E(d)})}else J(u,{...W,status:"pass"})}catch(T){J(l,T instanceof Error?T.message:"Unknown error occurred"),J(u,null)}finally{J(o,!1)}}}Mt();var v=Ei(),g=D(v);{var b=F=>{var V=_i(),A=x(D(V),2),T=D(A),L=x(A,2);X(()=>Y(T,Ln[r()]?.name||r())),be("click",L,_r(i)),R(F,V)},S=F=>{var V=bi(),A=x(D(V),2);be("click",A,_r(i)),R(F,V)};j(g,F=>{r()&&r()!=="custom"?F(b):F(S,!1)})}var m=x(g,2);Ys(m,{id:"local-file-upload",get processing(){return E(o)},accept:"audio/*",$$events:{change:h}});var _=x(m,2),k=D(_),I=D(k),y=x(_,2);{var C=F=>{var V=wi(),A=D(V);X(()=>Y(A,E(l))),R(F,V)};j(y,F=>{E(l)&&F(C)})}var U=x(y,2);{var O=F=>{var V=yi();R(F,V)};j(U,F=>{E(o)&&F(O)})}var N=x(U,2);{var z=F=>{var V=Si(),A=te(V);{let W=Sn(()=>[E(u)]);ii(A,{get results(){return E(W)},mode:"single",get metadataOnly(){return E(c)}})}var T=x(A,2);{var L=W=>{ui(W,{get validation(){return E(d)}})};j(T,W=>{E(d)&&W(L)})}R(F,V)};j(N,F=>{E(u)&&F(z)})}Ns(I,()=>E(c),F=>J(c,F)),R(n,v),Ke(),s()}const Ai=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",ki=window.location.pathname.startsWith("/beta"),ia=Ai?"http://localhost:3000":ki?"https://audio-analyzer.tinytech.site/beta":"https://audio-analyzer.tinytech.site",Tn={CLIENT_ID:"708688597317-bmmrje6hqg8vo52nctned54m32q8uhsr.apps.googleusercontent.com",REDIRECT_URI:ia,SCOPE:"https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email",DISCOVERY_DOCS:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]},he={CLIENT_ID:"0y78slky3xitt421wmoa0fjdz6fi14hn",REDIRECT_URI:ia,AUTHORIZATION_URL:"https://account.box.com/api/oauth2/authorize",TOKEN_URL:"https://api.box.com/oauth2/token",API_URL:"https://api.box.com/2.0",PROXY_URL:"https://box-proxy-708688597317.us-central1.run.app"};class xi{constructor(){this.isInitialized=!1,this.accessToken=null,this.codeClient=null,this.userInfo=null}async init(){if(!this.isInitialized)return new Promise((e,t)=>{this.loadGoogleAPI().then(()=>{this.initializeGIS().then(e).catch(t)}).catch(t)})}async loadGoogleAPI(){return new Promise((e,t)=>{if(window.gapi){e();return}const r=document.createElement("script");r.src="https://apis.google.com/js/api.js",r.onload=()=>e(),r.onerror=()=>t(new Error("Failed to load Google API script")),document.head.appendChild(r)})}async initializeGIS(){return new Promise((e,t)=>{const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.onload=()=>{this.setupGIS().then(e).catch(t)},r.onerror=()=>t(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async setupGIS(){return new Promise((e,t)=>{const r=setTimeout(()=>{t(new Error("Google API setup timeout"))},1e4);window.gapi.load("client",async()=>{try{clearTimeout(r),await window.gapi.client.init({discoveryDocs:Tn.DISCOVERY_DOCS}),this.tokenClient=window.google.accounts.oauth2.initTokenClient({client_id:Tn.CLIENT_ID,scope:Tn.SCOPE,callback:a=>{if(a.error){console.error("Token response error:",a),t(new Error(`Google sign-in failed: ${a.error}`));return}this.accessToken=a.access_token;const s={access_token:a.access_token,expires_at:Date.now()+a.expires_in*1e3,scope:a.scope};localStorage.setItem("google_token",JSON.stringify(s)),e(s)}}),this.isInitialized=!0,e()}catch(a){clearTimeout(r),console.error("Google API setup error:",a);let s="Unknown setup error";a&&typeof a=="object"?s=a.message||a.error||a.details||JSON.stringify(a):a&&(s=a.toString()),t(new Error(`Failed to setup Google API: ${s}`))}})})}async signIn(){return this.isInitialized||await this.init(),new Promise((e,t)=>{try{this.tokenClient.callback=r=>{if(r.error){console.error("Token response error:",r),t(new Error(`Google sign-in failed: ${r.error}`));return}if(!(r.scope&&r.scope.includes("https://www.googleapis.com/auth/drive.readonly"))){console.warn("Drive scope not granted, retrying with consent prompt"),this.tokenClient.requestAccessToken({prompt:"consent"});return}this.accessToken=r.access_token;const s={access_token:r.access_token,expires_at:Date.now()+r.expires_in*1e3,scope:r.scope};localStorage.setItem("google_token",JSON.stringify(s)),e(s)},this.tokenClient.requestAccessToken({prompt:""})}catch(r){console.error("Google sign-in error:",r);let a="Unknown sign-in error";r&&typeof r=="object"?a=r.error||r.message||r.details||JSON.stringify(r):r&&(a=r.toString()),t(new Error(`Google sign-in failed: ${a}`))}})}async getValidToken(){const e=localStorage.getItem("google_token");if(e)try{const t=JSON.parse(e);if(t.expires_at>Date.now()+3e5)return this.accessToken=t.access_token,t}catch(t){console.warn("Invalid stored token:",t),localStorage.removeItem("google_token")}return await this.signIn()}async getUserInfo(){const e=await this.getValidToken();try{const t=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${e.access_token}`}});if(!t.ok)throw new Error(`Failed to get user info: ${t.status}`);const r=await t.json();return this.userInfo=r,r}catch(t){throw new Error(`Failed to get user info: ${t.message}`)}}async downloadFile(e){const t=await this.getValidToken();try{const r=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?fields=name,mimeType,size`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!r.ok)throw r.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive. Please sign in again and grant Drive access.")):new Error(`Failed to get file metadata: ${r.status}`);const a=await r.json(),s=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?alt=media`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!s.ok)throw new Error(`Failed to download file: ${s.status}`);const i=await s.blob();return new File([i],a.name,{type:a.mimeType||"audio/mpeg"})}catch(r){throw new Error(`Google Drive download failed: ${r.message}`)}}async listAudioFilesInFolder(e){const t=await this.getValidToken();try{const a=["audio/mpeg","audio/wav","audio/x-wav","audio/wave","audio/flac","audio/x-flac","audio/aac","audio/mp4","audio/ogg","audio/x-m4a"].map(l=>`mimeType='${l}'`).join(" or "),s=`'${e}' in parents and (${a}) and trashed=false`,i=await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(s)}&fields=files(id,name,mimeType,size,modifiedTime,videoMediaMetadata)&pageSize=1000`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!i.ok)throw i.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive folder. Please sign in again.")):new Error(`Failed to list folder contents: ${i.status}`);return(await i.json()).files||[]}catch(r){throw new Error(`Failed to list folder: ${r.message}`)}}async listFilesInFolder(e,t){const r=await this.getValidToken();try{const a=`'${e}' in parents and trashed=false`,s=await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(a)}&fields=files(id,name,mimeType)&pageSize=1000`,{headers:{Authorization:`Bearer ${r.access_token}`}});if(!s.ok)throw s.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive folder. Please sign in again.")):new Error(`Failed to list folder contents: ${s.status}`);const o=(await s.json()).files||[];return t?o.filter(l=>l.name.toLowerCase().endsWith(t.toLowerCase())):o}catch(a){throw new Error(`Failed to list folder: ${a.message}`)}}async downloadFileHeaders(e,t=102400){const r=await this.getValidToken();try{const a=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?alt=media`,{headers:{Authorization:`Bearer ${r.access_token}`,Range:`bytes=0-${t-1}`}});if(!a.ok&&a.status!==206)throw new Error(`Failed to download file headers: ${a.status}`);return await a.blob()}catch(a){throw new Error(`Failed to download headers: ${a.message}`)}}async getFileMetadata(e){if(e.videoMediaMetadata)return e;const t=await this.getValidToken();try{const r=await fetch(`https://www.googleapis.com/drive/v3/files/${e.id}?fields=name,mimeType,size,modifiedTime,videoMediaMetadata`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!r.ok)throw r.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive. Please sign in again and grant Drive access.")):new Error(`Failed to get file metadata: ${r.status}`);return await r.json()}catch(r){throw new Error(`Google Drive metadata fetch failed: ${r.message}`)}}signOut(){this.accessToken&&window.google&&window.google.accounts.oauth2.revoke(this.accessToken),this.accessToken=null,localStorage.removeItem("google_token")}isSignedIn(){const e=localStorage.getItem("google_token");if(!e)return!1;try{return JSON.parse(e).expires_at>Date.now()}catch{return!1}}}class Di{constructor(){this.isInitialized=!1,this.accessToken=null,this.userInfo=null}async init(){this.isInitialized||(console.log("[Box Auth] Init started at:",new Date().toISOString()),await this.handleOAuthCallback(),console.log("[Box Auth] Init completed at:",new Date().toISOString()),this.isInitialized=!0)}async handleOAuthCallback(){const e=new URLSearchParams(window.location.search);if(e.has("code")){console.log("[Box OAuth] Callback received at:",new Date().toISOString());const t=e.get("code"),r=e.get("state"),a=localStorage.getItem("box_oauth_state");if(!a||a!==r)return console.error("OAuth state mismatch"),!1;console.log("[Box OAuth] State verified, exchanging code at:",new Date().toISOString());try{const s=await fetch(`${he.PROXY_URL}?action=token&code=${encodeURIComponent(t)}`);if(console.log("[Box OAuth] Token exchange response at:",new Date().toISOString(),"Status:",s.status),!s.ok){const l=await s.text();throw console.error("[Box OAuth] Token exchange failed:",l),new Error(`Token exchange failed: ${s.status}`)}const i=await s.json(),o={access_token:i.access_token,refresh_token:i.refresh_token,expires_at:Date.now()+i.expires_in*1e3};return localStorage.setItem("box_token",JSON.stringify(o)),this.accessToken=i.access_token,localStorage.setItem("box_just_authenticated","true"),window.history.replaceState({},document.title,window.location.pathname),!0}catch(s){return console.error("Failed to exchange authorization code:",s),!1}}return!1}async signIn(){this.isInitialized||await this.init();const e=Math.random().toString(36).substring(2,15);localStorage.setItem("box_oauth_state",e);const t=new URL(he.AUTHORIZATION_URL);t.searchParams.append("client_id",he.CLIENT_ID),t.searchParams.append("response_type","code"),t.searchParams.append("redirect_uri",he.REDIRECT_URI),t.searchParams.append("state",e),window.location.href=t.toString()}async getValidToken(){const e=localStorage.getItem("box_token");if(e)try{const t=JSON.parse(e);if(t.expires_at>Date.now()+3e5)return this.accessToken=t.access_token,t}catch(t){console.warn("Invalid stored token:",t),localStorage.removeItem("box_token")}throw new Error("Not signed in to Box")}async getUserInfo(){const e=await this.getValidToken();try{const t=await fetch(`${he.API_URL}/users/me`,{headers:{Authorization:`Bearer ${e.access_token}`}});if(!t.ok)throw new Error(`Failed to get user info: ${t.status}`);const r=await t.json();return this.userInfo=r,r}catch(t){throw new Error(`Failed to get user info: ${t.message}`)}}async downloadFile(e,t=null){try{const r=await this.getValidToken();console.log("[Box Download] Token retrieved:",r?"Yes":"No","Expires at:",new Date(r.expires_at).toISOString());const a={Authorization:`Bearer ${r.access_token}`};console.log("[Box Download] Fetching metadata for file:",e);const s=await fetch(`${he.API_URL}/files/${e}`,{headers:a});if(!s.ok){const c=await s.text();throw console.error("[Box Download] Metadata fetch failed:",s.status,c),s.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to get file metadata: ${s.status}`)}const i=await s.json();console.log("[Box Download] Metadata retrieved:",i.name),console.log("[Box Download] Downloading file content...");const o=await fetch(`${he.API_URL}/files/${e}/content`,{headers:a});if(!o.ok){const c=await o.text();throw console.error("[Box Download] File download failed:",o.status,c),new Error(`Failed to download file: ${o.status}`)}const l=await o.blob();return new File([l],i.name,{type:i.content_type||"audio/mpeg"})}catch(r){throw new Error(`Box download failed: ${r.message}`)}}async listAudioFilesInFolder(e,t=null){try{const r=`${he.API_URL}/folders/${e}/items?fields=id,name,type,size,modified_at&limit=1000`;let a=`${he.PROXY_URL}?url=${encodeURIComponent(r)}`;if(t)a+=`&boxapi=${encodeURIComponent(t)}`;else{const u=await this.getValidToken();a+=`&token=${encodeURIComponent(u.access_token)}`}const s=await fetch(a);if(!s.ok)throw!t&&s.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to list folder contents: ${s.status}`);const o=(await s.json()).entries||[],l=[".mp3",".wav",".flac",".aac",".m4a",".ogg"];return o.filter(u=>{if(u.type!=="file")return!1;const d=u.name.toLowerCase();return l.some(f=>d.endsWith(f))})}catch(r){throw new Error(`Failed to list folder: ${r.message}`)}}async listFilesInFolder(e,t,r=null){try{const a={};if(r)a.BoxApi=`shared_link=${r}`;else{const c=await this.getValidToken();a.Authorization=`Bearer ${c.access_token}`}const s=await fetch(`${he.API_URL}/folders/${e}/items?fields=id,name,type&limit=1000`,{headers:a});if(!s.ok)throw!r&&s.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to list folder contents: ${s.status}`);let l=((await s.json()).entries||[]).filter(c=>c.type==="file");return t&&(l=l.filter(c=>c.name.toLowerCase().endsWith(t.toLowerCase()))),l}catch(a){throw new Error(`Failed to list folder: ${a.message}`)}}async downloadFileHeaders(e,t=102400,r=null){try{const a={Range:`bytes=0-${t-1}`};if(r)a.BoxApi=`shared_link=${r}`;else{const i=await this.getValidToken();a.Authorization=`Bearer ${i.access_token}`}const s=await fetch(`${he.API_URL}/files/${e}/content`,{headers:a});if(!s.ok&&s.status!==206)throw new Error(`Failed to download file headers: ${s.status}`);return await s.blob()}catch(a){throw new Error(`Failed to download headers: ${a.message}`)}}async getFileMetadata(e,t=null){try{const r={};if(t)r.BoxApi=`shared_link=${t}`;else{const s=await this.getValidToken();r.Authorization=`Bearer ${s.access_token}`}const a=await fetch(`${he.API_URL}/files/${e.id}?fields=id,name,size,modified_at,content_type`,{headers:r});if(!a.ok)throw!t&&a.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to get file metadata: ${a.status}`);return await a.json()}catch(r){throw new Error(`Box metadata fetch failed: ${r.message}`)}}signOut(){this.accessToken=null,this.userInfo=null,localStorage.removeItem("box_token"),localStorage.removeItem("box_oauth_state")}isSignedIn(){const e=localStorage.getItem("box_token");if(!e)return!1;try{return JSON.parse(e).expires_at>Date.now()}catch{return!1}}}class Qe{constructor(){this.authStateStore=en({google:{isAuthenticated:!1,isInitialized:!1,userInfo:null,error:null},box:{isAuthenticated:!1,isInitialized:!1,error:null}}),this.googleAuth=new xi,this.boxAuth=new Di,this.authState={subscribe:e=>this.authStateStore.subscribe(e)},this.isGoogleAuthenticated=on(this.authStateStore,e=>e.google.isAuthenticated),this.isBoxAuthenticated=on(this.authStateStore,e=>e.box.isAuthenticated),this.googleUserInfo=on(this.authStateStore,e=>e.google.userInfo),this.initialize()}static getInstance(){return Qe.instance||(Qe.instance=new Qe),Qe.instance}async initialize(){try{if(await this.googleAuth.init(),this.updateGoogleState({isInitialized:!0}),this.googleAuth.isSignedIn()){const e=await this.googleAuth.getUserInfo();this.updateGoogleState({isAuthenticated:!0,userInfo:e})}}catch(e){console.error("Failed to initialize Google auth:",e),this.updateGoogleState({error:e instanceof Error?e:new Error(String(e))})}try{await this.boxAuth.init(),this.updateBoxState({isInitialized:!0}),this.boxAuth.isSignedIn()&&this.updateBoxState({isAuthenticated:!0})}catch(e){console.error("Failed to initialize Box auth:",e),this.updateBoxState({error:e instanceof Error?e:new Error(String(e))})}}async signInGoogle(){try{await this.googleAuth.signIn();const e=await this.googleAuth.getUserInfo();this.updateGoogleState({isAuthenticated:!0,userInfo:e,error:null})}catch(e){const t=e instanceof Error?e:new Error(String(e));throw this.updateGoogleState({error:t}),t}}async signOutGoogle(){try{await this.googleAuth.signOut(),this.updateGoogleState({isAuthenticated:!1,userInfo:null,error:null})}catch(e){const t=e instanceof Error?e:new Error(String(e));throw this.updateGoogleState({error:t}),t}}async signInBox(){try{await this.boxAuth.signIn(),this.updateBoxState({isAuthenticated:!0,error:null})}catch(e){const t=e instanceof Error?e:new Error(String(e));throw this.updateBoxState({error:t}),t}}async signOutBox(){try{await this.boxAuth.signOut(),this.updateBoxState({isAuthenticated:!1,error:null})}catch(e){const t=e instanceof Error?e:new Error(String(e));throw this.updateBoxState({error:t}),t}}getGoogleAuthInstance(){return this.googleAuth}getBoxAuthInstance(){return this.boxAuth}isGoogleAuthenticatedSync(){return this.googleAuth.isSignedIn()}isBoxAuthenticatedSync(){return this.boxAuth.isSignedIn()}updateGoogleState(e){this.authStateStore.update(t=>({...t,google:{...t.google,...e}}))}updateBoxState(e){this.authStateStore.update(t=>({...t,box:{...t.box,...e}}))}resetState(){this.authStateStore.set({google:{isAuthenticated:!1,isInitialized:!1,userInfo:null,error:null},box:{isAuthenticated:!1,isInitialized:!1,error:null}})}}let Fn=null;function oa(){return Fn||(Fn=Qe.getInstance()),Fn}oa();const la={subscribe:n=>oa().authState.subscribe(n)};var Ti=M('<div class="user-info svelte-6mpjkk"><span class="user-email svelte-6mpjkk"> </span></div> <button class="secondary svelte-6mpjkk">Sign Out</button>',1),Fi=M('<p>Sign in to access your Google Drive files</p> <button class="svelte-6mpjkk">Sign in with Google</button>',1),Ri=M('<div class="placeholder svelte-6mpjkk"><h3>Google Drive File Analysis</h3> <p>Full Google Drive integration will be implemented in Phase 5.5+</p> <p style="margin-top: 1rem;">This will include: <br/>• Browse and select files from Google Drive <br/>• Batch processing of folders <br/>• Direct file URL input</p></div>'),Ci=M('<div class="google-drive-tab svelte-6mpjkk"><div class="auth-section svelte-6mpjkk"><h3>Google Drive Authentication</h3> <!></div> <!></div>');function Oi(n,e){Xe(e,!1);const t=()=>Ye(la,"$authState",r),[r,a]=Pt(),s=Oe.getInstance();function i(){s.dispatch({type:"auth:google:signin:requested"})}function o(){s.dispatch({type:"auth:google:signout:requested"})}Mt();var l=Ci(),c=D(l),u=x(D(c),2);{var d=v=>{var g=Ti(),b=te(g),S=D(b),m=D(S),_=x(b,2);X(()=>Y(m,`✅ Signed in as ${t().google.userInfo?.email??""}`)),be("click",_,o),R(v,g)},f=v=>{var g=Fi(),b=x(te(g),2);be("click",b,i),R(v,g)};j(u,v=>{t().google.isAuthenticated?v(d):v(f,!1)})}var p=x(c,2);{var h=v=>{var g=Ri();R(v,g)};j(p,v=>{t().google.isAuthenticated&&v(h)})}R(n,l),Ke(),a()}var $i=M('<div class="user-info svelte-1ttt140"><span>✅ Signed in to Box</span></div> <button class="secondary svelte-1ttt140">Sign Out</button>',1),Bi=M('<p>Sign in to access your Box files</p> <button class="svelte-1ttt140">Sign in with Box</button>',1),Mi=M('<div class="placeholder svelte-1ttt140"><h3>Box File Analysis</h3> <p>Full Box integration will be implemented in Phase 5.5+</p> <p style="margin-top: 1rem;">This will include: <br/>• Browse and select files from Box <br/>• Batch processing of folders <br/>• Direct shared link input</p></div>'),Pi=M('<div class="box-tab svelte-1ttt140"><div class="auth-section svelte-1ttt140"><h3>Box Authentication</h3> <!></div> <!></div>');function Ni(n,e){Xe(e,!1);const t=()=>Ye(la,"$authState",r),[r,a]=Pt(),s=Oe.getInstance();function i(){s.dispatch({type:"auth:box:signin:requested"})}function o(){s.dispatch({type:"auth:box:signout:requested"})}Mt();var l=Pi(),c=D(l),u=x(D(c),2);{var d=v=>{var g=$i(),b=x(te(g),2);be("click",b,o),R(v,g)},f=v=>{var g=Bi(),b=x(te(g),2);be("click",b,i),R(v,g)};j(u,v=>{t().box.isAuthenticated?v(d):v(f,!1)})}var p=x(c,2);{var h=v=>{var g=Mi();R(v,g)};j(p,v=>{t().box.isAuthenticated&&v(h)})}R(n,l),Ke(),a()}var zi=M("<option> </option>"),Li=M('<dt class="svelte-1102y3w">File Type:</dt> <dd class="svelte-1102y3w"> </dd>',1),Ui=M('<dt class="svelte-1102y3w">Sample Rate:</dt> <dd class="svelte-1102y3w"> </dd>',1),qi=M('<dt class="svelte-1102y3w">Bit Depth:</dt> <dd class="svelte-1102y3w"> </dd>',1),ji=M('<dt class="svelte-1102y3w">Channels:</dt> <dd class="svelte-1102y3w"> </dd>',1),Vi=M('<dt class="svelte-1102y3w">Min Duration:</dt> <dd class="svelte-1102y3w"> </dd>',1),Gi=M('<dt class="svelte-1102y3w">Filename Validation:</dt> <dd class="svelte-1102y3w"> </dd>',1),Wi=M('<div class="preset-info svelte-1102y3w"><h4 class="svelte-1102y3w">Preset Requirements</h4> <dl class="svelte-1102y3w"><!> <!> <!> <!> <!> <!></dl></div>'),Hi=M('<div class="placeholder svelte-1102y3w"><p>Custom criteria configuration will be available in a future update.</p> <p style="margin-top: 0.5rem;">For now, select a preset above to apply validation rules.</p></div>'),Ji=M('<div class="settings-tab svelte-1102y3w"><div class="settings-section svelte-1102y3w"><h3 class="svelte-1102y3w">Criteria Presets</h3> <div class="form-group svelte-1102y3w"><label for="preset-select" class="svelte-1102y3w">Select Preset:</label> <select id="preset-select" class="svelte-1102y3w"></select></div> <!></div></div>');function Yi(n,e){Xe(e,!1);const t=()=>Ye(sa,"$currentPresetId",a),r=()=>Ye(gi,"$selectedPreset",a),[a,s]=Pt(),i=Ee();function o(g){const b=g.target;pi(b.value)}dn(()=>Ln,()=>{J(i,Object.entries(Ln).sort((g,b)=>g[0]==="custom"?1:b[0]==="custom"?-1:g[1].name.localeCompare(b[1].name)))}),Jn(),Mt();var l=Ji(),c=D(l),u=x(D(c),2),d=x(D(u),2);Qn(d,5,()=>E(i),Zn,(g,b)=>{var S=Br(()=>Ir(E(b),2));let m=()=>E(S)[0],_=()=>E(S)[1];var k=zi(),I=D(k),y={};X(()=>{Y(I,(_(),B(()=>_().name))),y!==(y=m())&&(k.value=(k.__value=m())??"")}),R(g,k)});var f;Os(d);var p=x(u,2);{var h=g=>{var b=Wi(),S=x(D(b),2),m=D(S);{var _=A=>{var T=Li(),L=x(te(T),2),W=D(L);X(H=>Y(W,H),[()=>(r(),B(()=>r().fileType.join(", ").toUpperCase()))]),R(A,T)};j(m,A=>{r(),B(()=>r().fileType&&r().fileType.length>0)&&A(_)})}var k=x(m,2);{var I=A=>{var T=Ui(),L=x(te(T),2),W=D(L);X(H=>Y(W,H),[()=>(r(),B(()=>r().sampleRate.map(H=>`${parseInt(H)/1e3} kHz`).join(", ")))]),R(A,T)};j(k,A=>{r(),B(()=>r().sampleRate&&r().sampleRate.length>0)&&A(I)})}var y=x(k,2);{var C=A=>{var T=qi(),L=x(te(T),2),W=D(L);X(H=>Y(W,H),[()=>(r(),B(()=>r().bitDepth.map(H=>`${H}-bit`).join(", ")))]),R(A,T)};j(y,A=>{r(),B(()=>r().bitDepth&&r().bitDepth.length>0)&&A(C)})}var U=x(y,2);{var O=A=>{var T=ji(),L=x(te(T),2),W=D(L);X(H=>Y(W,H),[()=>(r(),B(()=>r().channels.map(H=>H==="1"?"Mono":H==="2"?"Stereo":H).join(", ")))]),R(A,T)};j(U,A=>{r(),B(()=>r().channels&&r().channels.length>0)&&A(O)})}var N=x(U,2);{var z=A=>{var T=Vi(),L=x(te(T),2),W=D(L);X((H,oe)=>Y(W,`${H??""}m ${oe??""}s`),[()=>(r(),B(()=>Math.floor(parseInt(r().minDuration)/60))),()=>(r(),B(()=>parseInt(r().minDuration)%60))]),R(A,T)};j(N,A=>{r(),B(()=>r().minDuration)&&A(z)})}var F=x(N,2);{var V=A=>{var T=Gi(),L=x(te(T),2),W=D(L);X(()=>Y(W,`Supported (${r(),B(()=>r().filenameValidationType)??""})`)),R(A,T)};j(F,A=>{r(),B(()=>r().supportsFilenameValidation)&&A(V)})}R(g,b)},v=g=>{var b=Ut(),S=te(b);{var m=_=>{var k=Hi();R(_,k)};j(S,_=>{t()==="custom"&&_(m)},!0)}R(g,b)};j(p,g=>{r()&&t()!=="custom"?g(h):g(v,!1)})}X(()=>{f!==(f=t())&&(d.value=(d.__value=t())??"",aa(d,t()))}),be("change",d,o),R(n,l),Ke(),s()}var Xi=M('<div class="app sv-app svelte-nejbyb"><header class="header svelte-nejbyb"><div class="header-content svelte-nejbyb"><div class="header-spacer svelte-nejbyb"></div> <h1 class="logo svelte-nejbyb">🎵 Audio Analyzer</h1> <button class="dark-mode-toggle svelte-nejbyb" aria-label="Toggle dark mode"><span class="light-icon svelte-nejbyb">🌙</span> <span class="dark-icon svelte-nejbyb">☀️</span></button></div></header> <main class="main svelte-nejbyb"><div class="container svelte-nejbyb"><!> <!></div></main> <footer class="footer svelte-nejbyb"><div class="container svelte-nejbyb"><p id="buildInfo" class="svelte-nejbyb">Audio Analyzer - Phase 5.4 Tab Migration</p></div></footer></div>');function Ki(n){const e=()=>Ye(vn,"$currentTab",t),[t,r]=Pt();function a(){const v=document.documentElement,g=v.getAttribute("data-theme")==="dark";v.setAttribute("data-theme",g?"light":"dark"),localStorage.setItem("theme",g?"light":"dark")}if(typeof window<"u"){const v=localStorage.getItem("theme");v&&document.documentElement.setAttribute("data-theme",v)}var s=Xi(),i=D(s),o=D(i),l=x(D(o),4),c=x(i,2),u=D(c),d=D(u);Ws(d,{});var f=x(d,2);{var p=v=>{Ii(v,{})},h=v=>{var g=Ut(),b=te(g);{var S=_=>{Oi(_,{})},m=_=>{var k=Ut(),I=te(k);{var y=U=>{Ni(U,{})},C=U=>{var O=Ut(),N=te(O);{var z=F=>{Yi(F,{})};j(N,F=>{e()==="settings"&&F(z)},!0)}R(U,O)};j(I,U=>{e()==="box"?U(y):U(C,!1)},!0)}R(_,k)};j(b,_=>{e()==="googleDrive"?_(S):_(m,!1)},!0)}R(v,g)};j(f,v=>{e()==="local"?v(p):v(h,!1)})}be("click",l,a),R(n,s),r()}class Zi{constructor(){this.unsubscribers=[],this.bridge=Oe.getInstance(),this.authService=Qe.getInstance(),this.attachEventListeners()}attachEventListeners(){this.unsubscribers.push(this.bridge.on("auth:google:signin:requested",()=>this.handleGoogleSignIn())),this.unsubscribers.push(this.bridge.on("auth:google:signout:requested",()=>this.handleGoogleSignOut())),this.unsubscribers.push(this.bridge.on("auth:box:signin:requested",()=>this.handleBoxSignIn())),this.unsubscribers.push(this.bridge.on("auth:box:signout:requested",()=>this.handleBoxSignOut())),this.unsubscribers.push(this.bridge.on("file:local:selected",e=>{console.log("[ServiceCoordinator] File selected:",e.file.name)})),this.unsubscribers.push(this.bridge.on("file:drive:requested",e=>{console.log("[ServiceCoordinator] Google Drive file requested:",e.url)})),this.unsubscribers.push(this.bridge.on("file:box:requested",e=>{console.log("[ServiceCoordinator] Box file requested:",e.url)}))}async handleGoogleSignIn(){try{await this.authService.signInGoogle();const t=await this.authService.getGoogleAuthInstance().getUserInfo();this.bridge.dispatch({type:"auth:google:signin:success",userInfo:t})}catch(e){this.bridge.dispatch({type:"auth:google:signin:error",error:e instanceof Error?e:new Error(String(e))})}}async handleGoogleSignOut(){try{await this.authService.signOutGoogle(),this.bridge.dispatch({type:"auth:google:signout:success"})}catch(e){this.bridge.dispatch({type:"auth:google:signout:error",error:e instanceof Error?e:new Error(String(e))})}}async handleBoxSignIn(){try{await this.authService.signInBox(),this.bridge.dispatch({type:"auth:box:signin:success"})}catch(e){this.bridge.dispatch({type:"auth:box:signin:error",error:e instanceof Error?e:new Error(String(e))})}}async handleBoxSignOut(){try{await this.authService.signOutBox(),this.bridge.dispatch({type:"auth:box:signout:success"})}catch(e){this.bridge.dispatch({type:"auth:box:signout:error",error:e instanceof Error?e:new Error(String(e))})}}destroy(){this.unsubscribers.forEach(e=>e()),this.unsubscribers=[]}}new Zi;xs(Ki,{target:document.getElementById("app")});
