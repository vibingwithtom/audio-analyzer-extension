var Dn=Object.defineProperty;var Tt=e=>{throw TypeError(e)};var Fn=(e,t,n)=>t in e?Dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Ie=(e,t,n)=>Fn(e,typeof t!="symbol"?t+"":t,n),Ze=(e,t,n)=>t.has(e)||Tt("Cannot "+n);var _=(e,t,n)=>(Ze(e,t,"read from private field"),n?n.call(e):t.get(e)),D=(e,t,n)=>t.has(e)?Tt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),M=(e,t,n,r)=>(Ze(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),q=(e,t,n)=>(Ze(e,t,"access private method"),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Rn="5";var Mt;typeof window<"u"&&((Mt=window.__svelte??(window.__svelte={})).v??(Mt.v=new Set)).add(Rn);let He=!1,Bn=!1;function Cn(){He=!0}Cn();const Pn=2,b=Symbol(),Nn="http://www.w3.org/1999/xhtml",qt=!1;var Vt=Array.isArray,jn=Array.prototype.indexOf,Ge=Object.defineProperty,Qe=Object.getOwnPropertyDescriptor,Yt=Object.getOwnPropertyDescriptors,Ln=Object.prototype,Gn=Array.prototype,vt=Object.getPrototypeOf;const G=()=>{};function Un(e){return e()}function Ue(e){for(var t=0;t<e.length;t++)e[t]()}function Ht(){var e,t,n=new Promise((r,o)=>{e=r,t=o});return{promise:n,resolve:e,reject:t}}const x=2,Jt=4,_t=8,ce=16,z=32,ye=64,Wt=128,B=256,ze=512,E=1024,$=2048,Q=4096,X=8192,Ee=16384,wt=32768,bt=65536,Ot=1<<17,zn=1<<18,Je=1<<19,Kt=1<<20,it=1<<21,We=1<<22,ae=1<<23,xe=Symbol("$state"),Ae=new class extends Error{constructor(){super(...arguments);Ie(this,"name","StaleReactionError");Ie(this,"message","The reaction that called `getAbortSignal()` was re-run or destroyed")}};function Mn(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function qn(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Vn(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Yn(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Hn(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Jn(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Wn(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Kn(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Xt(e){return e===this.v}function Zt(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Qt(e){return!Zt(e,this.v)}let S=null;function Me(e){S=e}function en(e,t=!1,n){S={p:S,c:null,e:null,s:e,x:null,l:He&&!t?{s:null,u:null,$:[]}:null}}function tn(e){var t=S,n=t.e;if(n!==null){t.e=null;for(var r of n)dn(r)}return S=t.p,{}}function Re(){return!He||S!==null&&S.l===null}let de=[];function Xn(){var e=de;de=[],Ue(e)}function nn(e){if(de.length===0){var t=de;queueMicrotask(()=>{t===de&&Xn()})}de.push(e)}const Zn=new WeakMap;function Qn(e){var t=v;if(t===null)return p.f|=ae,e;if((t.f&wt)===0){if((t.f&Wt)===0)throw!t.parent&&e instanceof Error&&rn(e),e;t.b.error(e)}else qe(e,t)}function qe(e,t){for(;t!==null;){if((t.f&Wt)!==0)try{t.b.error(e);return}catch(n){e=n}t=t.parent}throw e instanceof Error&&rn(e),e}function rn(e){const t=Zn.get(e);t&&(Ge(e,"message",{value:t.message}),Ge(e,"stack",{value:t.stack}))}const Pe=new Set;let m=null,$t=new Set,H=[],mt=null,at=!1;var ve,_e,se,$e,we,be,ie,me,De,Fe,C,lt,Ne,ut;const ge=class ge{constructor(){D(this,C);Ie(this,"current",new Map);D(this,ve,new Map);D(this,_e,new Set);D(this,se,0);D(this,$e,null);D(this,we,[]);D(this,be,[]);D(this,ie,[]);D(this,me,[]);D(this,De,[]);D(this,Fe,[]);Ie(this,"skipped_effects",new Set)}process(t){H=[];var n=ge.apply(this);for(const s of t)q(this,C,lt).call(this,s);if(_(this,se)===0){q(this,C,ut).call(this);var r=_(this,be),o=_(this,ie);M(this,be,[]),M(this,ie,[]),M(this,me,[]),m=null,Dt(r),Dt(o),_(this,$e)?.resolve()}else q(this,C,Ne).call(this,_(this,be)),q(this,C,Ne).call(this,_(this,ie)),q(this,C,Ne).call(this,_(this,me));n();for(const s of _(this,we))Oe(s);M(this,we,[])}capture(t,n){_(this,ve).has(t)||_(this,ve).set(t,n),this.current.set(t,t.v)}activate(){m=this}deactivate(){m=null}flush(){if(H.length>0){if(this.activate(),er(),m!==null&&m!==this)return}else _(this,se)===0&&q(this,C,ut).call(this);this.deactivate();for(const t of $t)if($t.delete(t),t(),m!==null)break}increment(){M(this,se,_(this,se)+1)}decrement(){M(this,se,_(this,se)-1);for(const t of _(this,De))k(t,$),ue(t);for(const t of _(this,Fe))k(t,Q),ue(t);this.flush()}add_callback(t){_(this,_e).add(t)}settled(){return(_(this,$e)??M(this,$e,Ht())).promise}static ensure(){if(m===null){const t=m=new ge;Pe.add(m),ge.enqueue(()=>{m===t&&t.flush()})}return m}static enqueue(t){nn(t)}static apply(t){return G}};ve=new WeakMap,_e=new WeakMap,se=new WeakMap,$e=new WeakMap,we=new WeakMap,be=new WeakMap,ie=new WeakMap,me=new WeakMap,De=new WeakMap,Fe=new WeakMap,C=new WeakSet,lt=function(t){t.f^=E;for(var n=t.first;n!==null;){var r=n.f,o=(r&(z|ye))!==0,s=o&&(r&E)!==0,i=s||(r&X)!==0||this.skipped_effects.has(n);if(!i&&n.fn!==null){o?n.f^=E:(r&Jt)!==0?_(this,ie).push(n):(r&E)===0&&((r&We)!==0&&n.b?.is_pending()?_(this,we).push(n):Ke(n)&&((n.f&ce)!==0&&_(this,me).push(n),Oe(n)));var l=n.first;if(l!==null){n=l;continue}}var a=n.parent;for(n=n.next;n===null&&a!==null;)n=a.next,a=a.parent}},Ne=function(t){for(const n of t)((n.f&$)!==0?_(this,De):_(this,Fe)).push(n),k(n,E);t.length=0},ut=function(){var t;for(const n of _(this,_e))n();if(_(this,_e).clear(),Pe.size>1){_(this,ve).clear();let n=!0;for(const r of Pe){if(r===this){n=!1;continue}for(const[o,s]of this.current){if(r.current.has(o))if(n)r.current.set(o,s);else continue;on(o)}if(H.length>0){m=r;const o=ge.apply(r);for(const s of H)q(t=r,C,lt).call(t,s);H=[],o()}}m=null}Pe.delete(this)};let Ve=ge;function er(){var e=pe;at=!0;try{var t=0;for(Bt(!0);H.length>0;){var n=Ve.ensure();if(t++>1e3){var r,o;tr()}n.process(H),K.clear()}}finally{at=!1,Bt(e),mt=null}}function tr(){try{Hn()}catch(e){qe(e,mt)}}let te=null;function Dt(e){var t=e.length;if(t!==0){for(var n=0;n<t;){var r=e[n++];if((r.f&(Ee|X))===0&&Ke(r)&&(te=[],Oe(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?vn(r):r.fn=null),te?.length>0)){K.clear();for(const o of te)Oe(o);te=[]}}te=null}}function on(e){if(e.reactions!==null)for(const t of e.reactions){const n=t.f;(n&x)!==0?on(t):(n&(We|ce))!==0&&(k(t,$),ue(t))}}function ue(e){for(var t=mt=e;t.parent!==null;){t=t.parent;var n=t.f;if(at&&t===v&&(n&ce)!==0)return;if((n&(ye|z))!==0){if((n&E)===0)return;t.f^=E}}H.push(t)}function nr(e,t,n){const r=Re()?yt:sr;if(t.length===0){n(e.map(r));return}var o=m,s=v,i=rr();Promise.all(t.map(l=>or(l))).then(l=>{i();try{n([...e.map(r),...l])}catch(a){(s.f&Ee)===0&&qe(a,s)}o?.deactivate(),sn()}).catch(l=>{qe(l,s)})}function rr(){var e=v,t=p,n=S,r=m;return function(){Z(e),j(t),Me(n),r?.activate()}}function sn(){Z(null),j(null),Me(null)}function yt(e){var t=x|$,n=p!==null&&(p.f&x)!==0?p:null;return v===null||n!==null&&(n.f&B)!==0?t|=B:v.f|=Je,{ctx:S,deps:null,effects:null,equals:Xt,f:t,fn:e,reactions:null,rv:0,v:b,wv:0,parent:n??v,ac:null}}function or(e,t){let n=v;n===null&&Mn();var r=n.b,o=void 0,s=St(b),i=!p,l=new Map;return pr(()=>{var a=Ht();o=a.promise;try{Promise.resolve(e()).then(a.resolve,a.reject)}catch(g){a.reject(g)}var u=m,c=r.is_pending();i&&(r.update_pending_count(1),c||(u.increment(),l.get(u)?.reject(Ae),l.set(u,a)));const h=(g,d=void 0)=>{c||u.activate(),d?d!==Ae&&(s.f|=ae,ct(s,d)):((s.f&ae)!==0&&(s.f^=ae),ct(s,g)),i&&(r.update_pending_count(-1),c||u.decrement()),sn()};a.promise.then(h,g=>h(null,g||"unknown"))}),kt(()=>{for(const a of l.values())a.reject(Ae)}),new Promise(a=>{function u(c){function h(){c===o?a(s):u(o)}c.then(h,h)}u(o)})}function sr(e){const t=yt(e);return t.equals=Qt,t}function an(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)Be(t[n])}}function ir(e){for(var t=e.parent;t!==null;){if((t.f&x)===0)return t;t=t.parent}return null}function Et(e){var t,n=v;Z(ir(e));try{an(e),t=En(e)}finally{Z(n)}return t}function ln(e){var t=Et(e);if(e.equals(t)||(e.v=t,e.wv=mn()),!Se){var n=(J||(e.f&B)!==0)&&e.deps!==null?Q:E;k(e,n)}}const K=new Map;function St(e,t){var n={f:0,v:e,reactions:null,equals:Xt,rv:0,wv:0};return n}function V(e,t){const n=St(e);return Er(n),n}function ar(e,t=!1,n=!0){var o;const r=St(e);return t||(r.equals=Qt),He&&n&&S!==null&&S.l!==null&&((o=S.l).s??(o.s=[])).push(r),r}function Y(e,t,n=!1){p!==null&&(!N||(p.f&Ot)!==0)&&Re()&&(p.f&(x|ce|We|Ot))!==0&&!U?.includes(e)&&Kn();let r=n?ke(t):t;return ct(e,r)}function ct(e,t){if(!e.equals(t)){var n=e.v;Se?K.set(e,t):K.set(e,n),e.v=t;var r=Ve.ensure();r.capture(e,n),(e.f&x)!==0&&((e.f&$)!==0&&Et(e),k(e,(e.f&B)===0?E:Q)),e.wv=mn(),un(e,$),Re()&&v!==null&&(v.f&E)!==0&&(v.f&(z|ye))===0&&(R===null?Sr([e]):R.push(e))}return t}function et(e){Y(e,e.v+1)}function un(e,t){var n=e.reactions;if(n!==null)for(var r=Re(),o=n.length,s=0;s<o;s++){var i=n[s],l=i.f;if(!(!r&&i===v)){var a=(l&$)===0;a&&k(i,t),(l&x)!==0?un(i,Q):a&&((l&ce)!==0&&te!==null&&te.push(i),ue(i))}}}function ke(e){if(typeof e!="object"||e===null||xe in e)return e;const t=vt(e);if(t!==Ln&&t!==Gn)return e;var n=new Map,r=Vt(e),o=V(0),s=le,i=l=>{if(le===s)return l();var a=p,u=le;j(null),Pt(s);var c=l();return j(a),Pt(u),c};return r&&n.set("length",V(e.length)),new Proxy(e,{defineProperty(l,a,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&Jn();var c=n.get(a);return c===void 0?c=i(()=>{var h=V(u.value);return n.set(a,h),h}):Y(c,u.value,!0),!0},deleteProperty(l,a){var u=n.get(a);if(u===void 0){if(a in l){const c=i(()=>V(b));n.set(a,c),et(o)}}else Y(u,b),et(o);return!0},get(l,a,u){if(a===xe)return e;var c=n.get(a),h=a in l;if(c===void 0&&(!h||Qe(l,a)?.writable)&&(c=i(()=>{var d=ke(h?l[a]:b),f=V(d);return f}),n.set(a,c)),c!==void 0){var g=W(c);return g===b?void 0:g}return Reflect.get(l,a,u)},getOwnPropertyDescriptor(l,a){var u=Reflect.getOwnPropertyDescriptor(l,a);if(u&&"value"in u){var c=n.get(a);c&&(u.value=W(c))}else if(u===void 0){var h=n.get(a),g=h?.v;if(h!==void 0&&g!==b)return{enumerable:!0,configurable:!0,value:g,writable:!0}}return u},has(l,a){if(a===xe)return!0;var u=n.get(a),c=u!==void 0&&u.v!==b||Reflect.has(l,a);if(u!==void 0||v!==null&&(!c||Qe(l,a)?.writable)){u===void 0&&(u=i(()=>{var g=c?ke(l[a]):b,d=V(g);return d}),n.set(a,u));var h=W(u);if(h===b)return!1}return c},set(l,a,u,c){var h=n.get(a),g=a in l;if(r&&a==="length")for(var d=u;d<h.v;d+=1){var f=n.get(d+"");f!==void 0?Y(f,b):d in l&&(f=i(()=>V(b)),n.set(d+"",f))}if(h===void 0)(!g||Qe(l,a)?.writable)&&(h=i(()=>V(void 0)),Y(h,ke(u)),n.set(a,h));else{g=h.v!==b;var w=i(()=>ke(u));Y(h,w)}var y=Reflect.getOwnPropertyDescriptor(l,a);if(y?.set&&y.set.call(c,u),!g){if(r&&typeof a=="string"){var P=n.get("length"),A=Number(a);Number.isInteger(A)&&A>=P.v&&Y(P,A+1)}et(o)}return!0},ownKeys(l){W(o);var a=Reflect.ownKeys(l).filter(h=>{var g=n.get(h);return g===void 0||g.v!==b});for(var[u,c]of n)c.v!==b&&!(u in l)&&a.push(u);return a},setPrototypeOf(){Wn()}})}var lr,ur,cr;function fr(e=""){return document.createTextNode(e)}function cn(e){return ur.call(e)}function fn(e){return cr.call(e)}function L(e,t){return cn(e)}function ne(e,t=1,n=!1){let r=e;for(;t--;)r=fn(r);return r}function hr(){return!1}function It(e){var t=p,n=v;j(null),Z(null);try{return e()}finally{j(t),Z(n)}}function hn(e){v===null&&p===null&&Yn(),p!==null&&(p.f&B)!==0&&v===null&&Vn(),Se&&qn()}function dr(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function fe(e,t,n,r=!0){var o=v;o!==null&&(o.f&X)!==0&&(e|=X);var s={ctx:S,deps:null,nodes_start:null,nodes_end:null,f:e|$,first:null,fn:t,last:null,next:null,parent:o,b:o&&o.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Oe(s),s.f|=wt}catch(a){throw Be(s),a}else t!==null&&ue(s);if(r){var i=s;if(n&&i.deps===null&&i.teardown===null&&i.nodes_start===null&&i.first===i.last&&(i.f&Je)===0&&(i=i.first),i!==null&&(i.parent=o,o!==null&&dr(i,o),p!==null&&(p.f&x)!==0&&(e&ye)===0)){var l=p;(l.effects??(l.effects=[])).push(i)}}return s}function kt(e){const t=fe(_t,null,!1);return k(t,E),t.teardown=e,t}function Ft(e){hn();var t=v.f,n=!p&&(t&z)!==0&&(t&wt)===0;if(n){var r=S;(r.e??(r.e=[])).push(e)}else return dn(e)}function dn(e){return fe(Jt|Kt,e,!1)}function gr(e){return hn(),fe(_t|Kt,e,!0)}function pr(e){return fe(We|Je,e,!0)}function ft(e,t=[],n=[]){nr(t,n,r=>{fe(_t,()=>e(...r.map(W)),!0)})}function vr(e,t=0){var n=fe(ce|t,e,!0);return n}function Rt(e,t=!0){return fe(z|Je,e,!0,t)}function gn(e){var t=e.teardown;if(t!==null){const n=Se,r=p;Ct(!0),j(null);try{t.call(null)}finally{Ct(n),j(r)}}}function pn(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){const o=n.ac;o!==null&&It(()=>{o.abort(Ae)});var r=n.next;(n.f&ye)!==0?n.parent=null:Be(n,t),n=r}}function _r(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&z)===0&&Be(t),t=n}}function Be(e,t=!0){var n=!1;(t||(e.f&zn)!==0)&&e.nodes_start!==null&&e.nodes_end!==null&&(wr(e.nodes_start,e.nodes_end),n=!0),pn(e,t&&!n),Ye(e,0),k(e,Ee);var r=e.transitions;if(r!==null)for(const s of r)s.stop();gn(e);var o=e.parent;o!==null&&o.first!==null&&vn(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function wr(e,t){for(;e!==null;){var n=e===t?null:fn(e);e.remove(),e=n}}function vn(e){var t=e.parent,n=e.prev,r=e.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=n))}function br(e,t){var n=[];_n(e,n,!0),mr(n,()=>{Be(e),t&&t()})}function mr(e,t){var n=e.length;if(n>0){var r=()=>--n||t();for(var o of e)o.out(r)}else t()}function _n(e,t,n){if((e.f&X)===0){if(e.f^=X,e.transitions!==null)for(const i of e.transitions)(i.is_global||n)&&t.push(i);for(var r=e.first;r!==null;){var o=r.next,s=(r.f&bt)!==0||(r.f&z)!==0;_n(r,t,s?n:!1),r=o}}}function yr(e){wn(e,!0)}function wn(e,t){if((e.f&X)!==0){e.f^=X,(e.f&E)===0&&(k(e,$),ue(e));for(var n=e.first;n!==null;){var r=n.next,o=(n.f&bt)!==0||(n.f&z)!==0;wn(n,o?t:!1),n=r}if(e.transitions!==null)for(const s of e.transitions)(s.is_global||t)&&s.in()}}let pe=!1;function Bt(e){pe=e}let Se=!1;function Ct(e){Se=e}let p=null,N=!1;function j(e){p=e}let v=null;function Z(e){v=e}let U=null;function Er(e){p!==null&&(U===null?U=[e]:U.push(e))}let I=null,O=0,R=null;function Sr(e){R=e}let bn=1,Te=0,le=Te;function Pt(e){le=e}let J=!1;function mn(){return++bn}function Ke(e){var t=e.f;if((t&$)!==0)return!0;if((t&Q)!==0){var n=e.deps,r=(t&B)!==0;if(n!==null){var o,s,i=(t&ze)!==0,l=r&&v!==null&&!J,a=n.length;if((i||l)&&(v===null||(v.f&Ee)===0)){var u=e,c=u.parent;for(o=0;o<a;o++)s=n[o],(i||!s?.reactions?.includes(u))&&(s.reactions??(s.reactions=[])).push(u);i&&(u.f^=ze),l&&c!==null&&(c.f&B)===0&&(u.f^=B)}for(o=0;o<a;o++)if(s=n[o],Ke(s)&&ln(s),s.wv>e.wv)return!0}(!r||v!==null&&!J)&&k(e,E)}return!1}function yn(e,t,n=!0){var r=e.reactions;if(r!==null&&!U?.includes(e))for(var o=0;o<r.length;o++){var s=r[o];(s.f&x)!==0?yn(s,t,!1):t===s&&(n?k(s,$):(s.f&E)!==0&&k(s,Q),ue(s))}}function En(e){var w;var t=I,n=O,r=R,o=p,s=J,i=U,l=S,a=N,u=le,c=e.f;I=null,O=0,R=null,J=(c&B)!==0&&(N||!pe||p===null),p=(c&(z|ye))===0?e:null,U=null,Me(e.ctx),N=!1,le=++Te,e.ac!==null&&(It(()=>{e.ac.abort(Ae)}),e.ac=null);try{e.f|=it;var h=e.fn,g=h(),d=e.deps;if(I!==null){var f;if(Ye(e,O),d!==null&&O>0)for(d.length=O+I.length,f=0;f<I.length;f++)d[O+f]=I[f];else e.deps=d=I;if(!J||(c&x)!==0&&e.reactions!==null)for(f=O;f<d.length;f++)((w=d[f]).reactions??(w.reactions=[])).push(e)}else d!==null&&O<d.length&&(Ye(e,O),d.length=O);if(Re()&&R!==null&&!N&&d!==null&&(e.f&(x|Q|$))===0)for(f=0;f<R.length;f++)yn(R[f],e);return o!==null&&o!==e&&(Te++,R!==null&&(r===null?r=R:r.push(...R))),(e.f&ae)!==0&&(e.f^=ae),g}catch(y){return Qn(y)}finally{e.f^=it,I=t,O=n,R=r,p=o,J=s,U=i,Me(l),N=a,le=u}}function Ir(e,t){let n=t.reactions;if(n!==null){var r=jn.call(n,e);if(r!==-1){var o=n.length-1;o===0?n=t.reactions=null:(n[r]=n[o],n.pop())}}n===null&&(t.f&x)!==0&&(I===null||!I.includes(t))&&(k(t,Q),(t.f&(B|ze))===0&&(t.f^=ze),an(t),Ye(t,0))}function Ye(e,t){var n=e.deps;if(n!==null)for(var r=t;r<n.length;r++)Ir(e,n[r])}function Oe(e){var t=e.f;if((t&Ee)===0){k(e,E);var n=v,r=pe;v=e,pe=!0;try{(t&ce)!==0?_r(e):pn(e),gn(e);var o=En(e);e.teardown=typeof o=="function"?o:null,e.wv=bn;var s;qt&&Bn&&(e.f&$)!==0&&e.deps}finally{pe=r,v=n}}}function W(e){var t=e.f,n=(t&x)!==0;if(p!==null&&!N){var r=v!==null&&(v.f&Ee)!==0;if(!r&&!U?.includes(e)){var o=p.deps;if((p.f&it)!==0)e.rv<Te&&(e.rv=Te,I===null&&o!==null&&o[O]===e?O++:I===null?I=[e]:(!J||!I.includes(e))&&I.push(e));else{(p.deps??(p.deps=[])).push(e);var s=e.reactions;s===null?e.reactions=[p]:s.includes(p)||s.push(p)}}}else if(n&&e.deps===null&&e.effects===null){var i=e,l=i.parent;l!==null&&(l.f&B)===0&&(i.f^=B)}if(Se){if(K.has(e))return K.get(e);if(n){i=e;var a=i.v;return((i.f&E)===0&&i.reactions!==null||Sn(i))&&(a=Et(i)),K.set(i,a),a}}else n&&(i=e,Ke(i)&&ln(i));if((e.f&ae)!==0)throw e.v;return e.v}function Sn(e){if(e.v===b)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(K.has(t)||(t.f&x)!==0&&Sn(t))return!0;return!1}function In(e){var t=N;try{return N=!0,e()}finally{N=t}}const kr=-7169;function k(e,t){e.f=e.f&kr|t}function xr(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(xe in e)ht(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&xe in n&&ht(n)}}}function ht(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{ht(e[r],t)}catch{}const n=vt(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=Yt(n);for(let o in r){const s=r[o].get;if(s)try{s.call(e)}catch{}}}}}function Ar(e,t,n,r={}){function o(s){if(r.capture||Tr.call(t,s),!s.cancelBubble)return It(()=>n?.call(this,s))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?nn(()=>{t.addEventListener(e,o,r)}):t.addEventListener(e,o,r),o}function je(e,t,n,r,o){var s={capture:r,passive:o},i=Ar(e,t,n,s);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&kt(()=>{t.removeEventListener(e,i,s)})}let Nt=null;function Tr(e){var t=this,n=t.ownerDocument,r=e.type,o=e.composedPath?.()||[],s=o[0]||e.target;Nt=e;var i=0,l=Nt===e&&e.__root;if(l){var a=o.indexOf(l);if(a!==-1&&(t===document||t===window)){e.__root=t;return}var u=o.indexOf(t);if(u===-1)return;a<=u&&(i=a)}if(s=o[i]||e.target,s!==t){Ge(e,"currentTarget",{configurable:!0,get(){return s||n}});var c=p,h=v;j(null),Z(null);try{for(var g,d=[];s!==null;){var f=s.assignedSlot||s.parentNode||s.host||null;try{var w=s["__"+r];if(w!=null&&(!s.disabled||e.target===s))if(Vt(w)){var[y,...P]=w;y.apply(s,[e,...P])}else w.call(s,e)}catch(A){g?d.push(A):g=A}if(e.cancelBubble||f===t||f===null)break;s=f}if(g){for(let A of d)queueMicrotask(()=>{throw A});throw g}}finally{e.__root=t,delete e.currentTarget,j(c),Z(h)}}}function Or(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function $r(e,t){var n=v;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function Xe(e,t){var n=(t&Pn)!==0,r,o=!e.startsWith("<!>");return()=>{r===void 0&&(r=Or(o?e:"<!>"+e),r=cn(r));var s=n||lr?document.importNode(r,!0):r.cloneNode(!0);return $r(s,s),s}}function Le(e,t){e!==null&&e.before(t)}function jt(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=n,e.nodeValue=n+"")}function Lt(e,t,n=!1){var r=e,o=null,s=null,i=b,l=n?bt:0,a=!1;const u=(d,f=!0)=>{a=!0,g(f,d)};var c=null;function h(){c!==null&&(c.lastChild.remove(),r.before(c),c=null);var d=i?o:s,f=i?s:o;d&&yr(d),f&&br(f,()=>{i?s=null:o=null})}const g=(d,f)=>{if(i!==(i=d)){var w=hr(),y=r;if(w&&(c=document.createDocumentFragment(),c.append(y=fr())),i?o??(o=f&&Rt(()=>f(y))):s??(s=f&&Rt(()=>f(y))),w){var P=m,A=i?o:s,Ce=i?s:o;A&&P.skipped_effects.delete(A),Ce&&P.skipped_effects.add(Ce),P.add_callback(h)}else h()}};vr(()=>{a=!1,t(u),a||g(null,null)},l)}const Gt=[...` 	
\r\f \v\uFEFF`];function Dr(e,t,n){var r=""+e;if(n){for(var o in n)if(n[o])r=r?r+" "+o:o;else if(r.length)for(var s=o.length,i=0;(i=r.indexOf(o,i))>=0;){var l=i+s;(i===0||Gt.includes(r[i-1]))&&(l===r.length||Gt.includes(r[l]))?r=(i===0?"":r.substring(0,i))+r.substring(l+1):i=l}}return r===""?null:r}function tt(e,t,n,r,o,s){var i=e.__className;if(i!==n||i===void 0){var l=Dr(n,r,s);l==null?e.removeAttribute("class"):e.className=l,e.__className=n}else if(s&&o!==s)for(var a in s){var u=!!s[a];(o==null||u!==!!o[a])&&e.classList.toggle(a,u)}return s}const Fr=Symbol("is custom element"),Rr=Symbol("is html");function nt(e,t,n,r){var o=Br(e);o[t]!==(o[t]=n)&&(n==null?e.removeAttribute(t):typeof n!="string"&&Cr(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function Br(e){return e.__attributes??(e.__attributes={[Fr]:e.nodeName.includes("-"),[Rr]:e.namespaceURI===Nn})}var Ut=new Map;function Cr(e){var t=e.getAttribute("is")||e.nodeName,n=Ut.get(t);if(n)return n;Ut.set(t,n=[]);for(var r,o=e,s=Element.prototype;s!==o;){r=Yt(o);for(var i in r)r[i].set&&n.push(i);o=vt(o)}return n}function kn(e=!1){const t=S,n=t.l.u;if(!n)return;let r=()=>xr(t.s);if(e){let o=0,s={};const i=yt(()=>{let l=!1;const a=t.s;for(const u in a)a[u]!==s[u]&&(s[u]=a[u],l=!0);return l&&o++,o});r=()=>W(i)}n.b.length&&gr(()=>{zt(t,r),Ue(n.b)}),Ft(()=>{const o=In(()=>n.m.map(Un));return()=>{for(const s of o)typeof s=="function"&&s()}}),n.a.length&&Ft(()=>{zt(t,r),Ue(n.a)})}function zt(e,t){if(e.l.s)for(const n of e.l.s)W(n);t()}function xt(e,t,n){if(e==null)return t(void 0),n&&n(void 0),G;const r=In(()=>e.subscribe(t,n));return r.unsubscribe?()=>r.unsubscribe():r}const he=[];function Pr(e,t){return{subscribe:At(e,t).subscribe}}function At(e,t=G){let n=null;const r=new Set;function o(l){if(Zt(e,l)&&(e=l,n)){const a=!he.length;for(const u of r)u[1](),he.push(u,e);if(a){for(let u=0;u<he.length;u+=2)he[u][0](he[u+1]);he.length=0}}}function s(l){o(l(e))}function i(l,a=G){const u=[l,a];return r.add(u),r.size===1&&(n=t(o,s)||G),l(e),()=>{r.delete(u),r.size===0&&n&&(n(),n=null)}}return{set:o,update:s,subscribe:i}}function rt(e,t,n){const r=!Array.isArray(e),o=r?[e]:e;if(!o.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=t.length<2;return Pr(n,(i,l)=>{let a=!1;const u=[];let c=0,h=G;const g=()=>{if(c)return;h();const f=t(r?u[0]:u,i,l);s?i(f):h=typeof f=="function"?f:G},d=o.map((f,w)=>xt(f,y=>{u[w]=y,c&=~(1<<w),a&&g()},()=>{c|=1<<w}));return a=!0,g(),function(){Ue(d),h(),a=!1}})}function Nr(e){let t;return xt(e,n=>t=n)(),t}let dt=Symbol();function gt(e,t,n){const r=n[t]??(n[t]={store:null,source:ar(void 0),unsubscribe:G});if(r.store!==e&&!(dt in n))if(r.unsubscribe(),r.store=e??null,e==null)r.source.v=void 0,r.unsubscribe=G;else{var o=!0;r.unsubscribe=xt(e,s=>{o?r.source.v=s:Y(r.source,s)}),o=!1}return e&&dt in n?Nr(e):W(r.source)}function xn(){const e={};function t(){kt(()=>{for(var n in e)e[n].unsubscribe();Ge(e,dt,{enumerable:!1,value:!0})})}return[e,t]}function jr(){const{subscribe:e,set:t}=At("local");return{subscribe:e,setTab:n=>t(n)}}const pt=jr();class re extends EventTarget{constructor(){super(),this.setupDebugLogging()}static getInstance(){return re.instance||(re.instance=new re),re.instance}dispatch(t){const n=new CustomEvent("app:event",{detail:t,bubbles:!1,cancelable:!1});this.dispatchEvent(n)}on(t,n){const r=o=>{const s=o;s.detail.type===t&&n(s.detail)};return this.addEventListener("app:event",r),()=>this.removeEventListener("app:event",r)}onAll(t){const n=r=>{t(r.detail)};return this.addEventListener("app:event",n),()=>this.removeEventListener("app:event",n)}once(t,n){let r=null;const o=s=>{n(s),r&&r()};return r=this.on(t,o),r}clearAllListeners(){const t=this._listeners;t&&Object.keys(t).forEach(n=>{delete t[n]})}setupDebugLogging(){typeof window<"u"&&localStorage.getItem("debugBridge")==="true"&&this.onAll(t=>{console.log("[AppBridge]",t.type,t)})}}typeof window<"u"&&(window.enableBridgeDebug=()=>{localStorage.setItem("debugBridge","true"),console.log("AppBridge debug logging enabled. Reload the page to see events.")},window.disableBridgeDebug=()=>{localStorage.removeItem("debugBridge"),console.log("AppBridge debug logging disabled.")});var Lr=Xe('<nav class="tabs sv-tab-nav svelte-1mmy281" aria-label="Main navigation"><button>📁 Local Files</button> <button>☁️ Google Drive</button> <button>📦 Box</button></nav>');function Gr(e,t){en(t,!1);const n=()=>gt(pt,"$currentTab",r),[r,o]=xn(),s=re.getInstance();function i(f){pt.setTab(f),s.dispatch({type:"tab:changed",tab:f})}kn();var l=Lr(),a=L(l);let u;var c=ne(a,2);let h;var g=ne(c,2);let d;ft((f,w,y)=>{u=tt(a,1,"tab-button svelte-1mmy281",null,u,f),nt(a,"aria-current",n()==="local"?"page":void 0),h=tt(c,1,"tab-button svelte-1mmy281",null,h,w),nt(c,"aria-current",n()==="googleDrive"?"page":void 0),d=tt(g,1,"tab-button svelte-1mmy281",null,d,y),nt(g,"aria-current",n()==="box"?"page":void 0)},[()=>({active:n()==="local"}),()=>({active:n()==="googleDrive"}),()=>({active:n()==="box"})]),je("click",a,()=>i("local")),je("click",c,()=>i("googleDrive")),je("click",g,()=>i("box")),Le(e,l),tn(),o()}const Ur=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",zr=window.location.pathname.startsWith("/beta"),An=Ur?"http://localhost:3000":zr?"https://audio-analyzer.tinytech.site/beta":"https://audio-analyzer.tinytech.site",ot={CLIENT_ID:"708688597317-bmmrje6hqg8vo52nctned54m32q8uhsr.apps.googleusercontent.com",REDIRECT_URI:An,SCOPE:"https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email",DISCOVERY_DOCS:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]},F={CLIENT_ID:"0y78slky3xitt421wmoa0fjdz6fi14hn",REDIRECT_URI:An,AUTHORIZATION_URL:"https://account.box.com/api/oauth2/authorize",TOKEN_URL:"https://api.box.com/oauth2/token",API_URL:"https://api.box.com/2.0",PROXY_URL:"https://box-proxy-708688597317.us-central1.run.app"};class Mr{constructor(){this.isInitialized=!1,this.accessToken=null,this.codeClient=null,this.userInfo=null}async init(){if(!this.isInitialized)return new Promise((t,n)=>{this.loadGoogleAPI().then(()=>{this.initializeGIS().then(t).catch(n)}).catch(n)})}async loadGoogleAPI(){return new Promise((t,n)=>{if(window.gapi){t();return}const r=document.createElement("script");r.src="https://apis.google.com/js/api.js",r.onload=()=>t(),r.onerror=()=>n(new Error("Failed to load Google API script")),document.head.appendChild(r)})}async initializeGIS(){return new Promise((t,n)=>{const r=document.createElement("script");r.src="https://accounts.google.com/gsi/client",r.onload=()=>{this.setupGIS().then(t).catch(n)},r.onerror=()=>n(new Error("Failed to load Google Identity Services")),document.head.appendChild(r)})}async setupGIS(){return new Promise((t,n)=>{const r=setTimeout(()=>{n(new Error("Google API setup timeout"))},1e4);window.gapi.load("client",async()=>{try{clearTimeout(r),await window.gapi.client.init({discoveryDocs:ot.DISCOVERY_DOCS}),this.tokenClient=window.google.accounts.oauth2.initTokenClient({client_id:ot.CLIENT_ID,scope:ot.SCOPE,callback:o=>{if(o.error){console.error("Token response error:",o),n(new Error(`Google sign-in failed: ${o.error}`));return}this.accessToken=o.access_token;const s={access_token:o.access_token,expires_at:Date.now()+o.expires_in*1e3,scope:o.scope};localStorage.setItem("google_token",JSON.stringify(s)),t(s)}}),this.isInitialized=!0,t()}catch(o){clearTimeout(r),console.error("Google API setup error:",o);let s="Unknown setup error";o&&typeof o=="object"?s=o.message||o.error||o.details||JSON.stringify(o):o&&(s=o.toString()),n(new Error(`Failed to setup Google API: ${s}`))}})})}async signIn(){return this.isInitialized||await this.init(),new Promise((t,n)=>{try{this.tokenClient.callback=r=>{if(r.error){console.error("Token response error:",r),n(new Error(`Google sign-in failed: ${r.error}`));return}if(!(r.scope&&r.scope.includes("https://www.googleapis.com/auth/drive.readonly"))){console.warn("Drive scope not granted, retrying with consent prompt"),this.tokenClient.requestAccessToken({prompt:"consent"});return}this.accessToken=r.access_token;const s={access_token:r.access_token,expires_at:Date.now()+r.expires_in*1e3,scope:r.scope};localStorage.setItem("google_token",JSON.stringify(s)),t(s)},this.tokenClient.requestAccessToken({prompt:""})}catch(r){console.error("Google sign-in error:",r);let o="Unknown sign-in error";r&&typeof r=="object"?o=r.error||r.message||r.details||JSON.stringify(r):r&&(o=r.toString()),n(new Error(`Google sign-in failed: ${o}`))}})}async getValidToken(){const t=localStorage.getItem("google_token");if(t)try{const n=JSON.parse(t);if(n.expires_at>Date.now()+3e5)return this.accessToken=n.access_token,n}catch(n){console.warn("Invalid stored token:",n),localStorage.removeItem("google_token")}return await this.signIn()}async getUserInfo(){const t=await this.getValidToken();try{const n=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}});if(!n.ok)throw new Error(`Failed to get user info: ${n.status}`);const r=await n.json();return this.userInfo=r,r}catch(n){throw new Error(`Failed to get user info: ${n.message}`)}}async downloadFile(t){const n=await this.getValidToken();try{const r=await fetch(`https://www.googleapis.com/drive/v3/files/${t}?fields=name,mimeType,size`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!r.ok)throw r.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive. Please sign in again and grant Drive access.")):new Error(`Failed to get file metadata: ${r.status}`);const o=await r.json(),s=await fetch(`https://www.googleapis.com/drive/v3/files/${t}?alt=media`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!s.ok)throw new Error(`Failed to download file: ${s.status}`);const i=await s.blob();return new File([i],o.name,{type:o.mimeType||"audio/mpeg"})}catch(r){throw new Error(`Google Drive download failed: ${r.message}`)}}async listAudioFilesInFolder(t){const n=await this.getValidToken();try{const o=["audio/mpeg","audio/wav","audio/x-wav","audio/wave","audio/flac","audio/x-flac","audio/aac","audio/mp4","audio/ogg","audio/x-m4a"].map(a=>`mimeType='${a}'`).join(" or "),s=`'${t}' in parents and (${o}) and trashed=false`,i=await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(s)}&fields=files(id,name,mimeType,size,modifiedTime,videoMediaMetadata)&pageSize=1000`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!i.ok)throw i.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive folder. Please sign in again.")):new Error(`Failed to list folder contents: ${i.status}`);return(await i.json()).files||[]}catch(r){throw new Error(`Failed to list folder: ${r.message}`)}}async listFilesInFolder(t,n){const r=await this.getValidToken();try{const o=`'${t}' in parents and trashed=false`,s=await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(o)}&fields=files(id,name,mimeType)&pageSize=1000`,{headers:{Authorization:`Bearer ${r.access_token}`}});if(!s.ok)throw s.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive folder. Please sign in again.")):new Error(`Failed to list folder contents: ${s.status}`);const l=(await s.json()).files||[];return n?l.filter(a=>a.name.toLowerCase().endsWith(n.toLowerCase())):l}catch(o){throw new Error(`Failed to list folder: ${o.message}`)}}async downloadFileHeaders(t,n=102400){const r=await this.getValidToken();try{const o=await fetch(`https://www.googleapis.com/drive/v3/files/${t}?alt=media`,{headers:{Authorization:`Bearer ${r.access_token}`,Range:`bytes=0-${n-1}`}});if(!o.ok&&o.status!==206)throw new Error(`Failed to download file headers: ${o.status}`);return await o.blob()}catch(o){throw new Error(`Failed to download headers: ${o.message}`)}}async getFileMetadata(t){if(t.videoMediaMetadata)return t;const n=await this.getValidToken();try{const r=await fetch(`https://www.googleapis.com/drive/v3/files/${t.id}?fields=name,mimeType,size,modifiedTime,videoMediaMetadata`,{headers:{Authorization:`Bearer ${n.access_token}`}});if(!r.ok)throw r.status===403?(this.signOut(),new Error("Insufficient permissions to access Google Drive. Please sign in again and grant Drive access.")):new Error(`Failed to get file metadata: ${r.status}`);return await r.json()}catch(r){throw new Error(`Google Drive metadata fetch failed: ${r.message}`)}}signOut(){this.accessToken&&window.google&&window.google.accounts.oauth2.revoke(this.accessToken),this.accessToken=null,localStorage.removeItem("google_token")}isSignedIn(){const t=localStorage.getItem("google_token");if(!t)return!1;try{return JSON.parse(t).expires_at>Date.now()}catch{return!1}}}class qr{constructor(){this.isInitialized=!1,this.accessToken=null,this.userInfo=null}async init(){this.isInitialized||(console.log("[Box Auth] Init started at:",new Date().toISOString()),await this.handleOAuthCallback(),console.log("[Box Auth] Init completed at:",new Date().toISOString()),this.isInitialized=!0)}async handleOAuthCallback(){const t=new URLSearchParams(window.location.search);if(t.has("code")){console.log("[Box OAuth] Callback received at:",new Date().toISOString());const n=t.get("code"),r=t.get("state"),o=localStorage.getItem("box_oauth_state");if(!o||o!==r)return console.error("OAuth state mismatch"),!1;console.log("[Box OAuth] State verified, exchanging code at:",new Date().toISOString());try{const s=await fetch(`${F.PROXY_URL}?action=token&code=${encodeURIComponent(n)}`);if(console.log("[Box OAuth] Token exchange response at:",new Date().toISOString(),"Status:",s.status),!s.ok){const a=await s.text();throw console.error("[Box OAuth] Token exchange failed:",a),new Error(`Token exchange failed: ${s.status}`)}const i=await s.json(),l={access_token:i.access_token,refresh_token:i.refresh_token,expires_at:Date.now()+i.expires_in*1e3};return localStorage.setItem("box_token",JSON.stringify(l)),this.accessToken=i.access_token,localStorage.setItem("box_just_authenticated","true"),window.history.replaceState({},document.title,window.location.pathname),!0}catch(s){return console.error("Failed to exchange authorization code:",s),!1}}return!1}async signIn(){this.isInitialized||await this.init();const t=Math.random().toString(36).substring(2,15);localStorage.setItem("box_oauth_state",t);const n=new URL(F.AUTHORIZATION_URL);n.searchParams.append("client_id",F.CLIENT_ID),n.searchParams.append("response_type","code"),n.searchParams.append("redirect_uri",F.REDIRECT_URI),n.searchParams.append("state",t),window.location.href=n.toString()}async getValidToken(){const t=localStorage.getItem("box_token");if(t)try{const n=JSON.parse(t);if(n.expires_at>Date.now()+3e5)return this.accessToken=n.access_token,n}catch(n){console.warn("Invalid stored token:",n),localStorage.removeItem("box_token")}throw new Error("Not signed in to Box")}async getUserInfo(){const t=await this.getValidToken();try{const n=await fetch(`${F.API_URL}/users/me`,{headers:{Authorization:`Bearer ${t.access_token}`}});if(!n.ok)throw new Error(`Failed to get user info: ${n.status}`);const r=await n.json();return this.userInfo=r,r}catch(n){throw new Error(`Failed to get user info: ${n.message}`)}}async downloadFile(t,n=null){try{const r=await this.getValidToken();console.log("[Box Download] Token retrieved:",r?"Yes":"No","Expires at:",new Date(r.expires_at).toISOString());const o={Authorization:`Bearer ${r.access_token}`};console.log("[Box Download] Fetching metadata for file:",t);const s=await fetch(`${F.API_URL}/files/${t}`,{headers:o});if(!s.ok){const u=await s.text();throw console.error("[Box Download] Metadata fetch failed:",s.status,u),s.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to get file metadata: ${s.status}`)}const i=await s.json();console.log("[Box Download] Metadata retrieved:",i.name),console.log("[Box Download] Downloading file content...");const l=await fetch(`${F.API_URL}/files/${t}/content`,{headers:o});if(!l.ok){const u=await l.text();throw console.error("[Box Download] File download failed:",l.status,u),new Error(`Failed to download file: ${l.status}`)}const a=await l.blob();return new File([a],i.name,{type:i.content_type||"audio/mpeg"})}catch(r){throw new Error(`Box download failed: ${r.message}`)}}async listAudioFilesInFolder(t,n=null){try{const r=`${F.API_URL}/folders/${t}/items?fields=id,name,type,size,modified_at&limit=1000`;let o=`${F.PROXY_URL}?url=${encodeURIComponent(r)}`;if(n)o+=`&boxapi=${encodeURIComponent(n)}`;else{const c=await this.getValidToken();o+=`&token=${encodeURIComponent(c.access_token)}`}const s=await fetch(o);if(!s.ok)throw!n&&s.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to list folder contents: ${s.status}`);const l=(await s.json()).entries||[],a=[".mp3",".wav",".flac",".aac",".m4a",".ogg"];return l.filter(c=>{if(c.type!=="file")return!1;const h=c.name.toLowerCase();return a.some(g=>h.endsWith(g))})}catch(r){throw new Error(`Failed to list folder: ${r.message}`)}}async listFilesInFolder(t,n,r=null){try{const o={};if(r)o.BoxApi=`shared_link=${r}`;else{const u=await this.getValidToken();o.Authorization=`Bearer ${u.access_token}`}const s=await fetch(`${F.API_URL}/folders/${t}/items?fields=id,name,type&limit=1000`,{headers:o});if(!s.ok)throw!r&&s.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to list folder contents: ${s.status}`);let a=((await s.json()).entries||[]).filter(u=>u.type==="file");return n&&(a=a.filter(u=>u.name.toLowerCase().endsWith(n.toLowerCase()))),a}catch(o){throw new Error(`Failed to list folder: ${o.message}`)}}async downloadFileHeaders(t,n=102400,r=null){try{const o={Range:`bytes=0-${n-1}`};if(r)o.BoxApi=`shared_link=${r}`;else{const i=await this.getValidToken();o.Authorization=`Bearer ${i.access_token}`}const s=await fetch(`${F.API_URL}/files/${t}/content`,{headers:o});if(!s.ok&&s.status!==206)throw new Error(`Failed to download file headers: ${s.status}`);return await s.blob()}catch(o){throw new Error(`Failed to download headers: ${o.message}`)}}async getFileMetadata(t,n=null){try{const r={};if(n)r.BoxApi=`shared_link=${n}`;else{const s=await this.getValidToken();r.Authorization=`Bearer ${s.access_token}`}const o=await fetch(`${F.API_URL}/files/${t.id}?fields=id,name,size,modified_at,content_type`,{headers:r});if(!o.ok)throw!n&&o.status===401?(this.signOut(),new Error("Session expired. Please sign in again.")):new Error(`Failed to get file metadata: ${o.status}`);return await o.json()}catch(r){throw new Error(`Box metadata fetch failed: ${r.message}`)}}signOut(){this.accessToken=null,this.userInfo=null,localStorage.removeItem("box_token"),localStorage.removeItem("box_oauth_state")}isSignedIn(){const t=localStorage.getItem("box_token");if(!t)return!1;try{return JSON.parse(t).expires_at>Date.now()}catch{return!1}}}class oe{constructor(){this.authStateStore=At({google:{isAuthenticated:!1,isInitialized:!1,userInfo:null,error:null},box:{isAuthenticated:!1,isInitialized:!1,error:null}}),this.googleAuth=new Mr,this.boxAuth=new qr,this.authState={subscribe:t=>this.authStateStore.subscribe(t)},this.isGoogleAuthenticated=rt(this.authStateStore,t=>t.google.isAuthenticated),this.isBoxAuthenticated=rt(this.authStateStore,t=>t.box.isAuthenticated),this.googleUserInfo=rt(this.authStateStore,t=>t.google.userInfo),this.initialize()}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}async initialize(){try{if(await this.googleAuth.init(),this.updateGoogleState({isInitialized:!0}),this.googleAuth.isSignedIn()){const t=await this.googleAuth.getUserInfo();this.updateGoogleState({isAuthenticated:!0,userInfo:t})}}catch(t){console.error("Failed to initialize Google auth:",t),this.updateGoogleState({error:t instanceof Error?t:new Error(String(t))})}try{await this.boxAuth.init(),this.updateBoxState({isInitialized:!0}),this.boxAuth.isSignedIn()&&this.updateBoxState({isAuthenticated:!0})}catch(t){console.error("Failed to initialize Box auth:",t),this.updateBoxState({error:t instanceof Error?t:new Error(String(t))})}}async signInGoogle(){try{await this.googleAuth.signIn();const t=await this.googleAuth.getUserInfo();this.updateGoogleState({isAuthenticated:!0,userInfo:t,error:null})}catch(t){const n=t instanceof Error?t:new Error(String(t));throw this.updateGoogleState({error:n}),n}}async signOutGoogle(){try{await this.googleAuth.signOut(),this.updateGoogleState({isAuthenticated:!1,userInfo:null,error:null})}catch(t){const n=t instanceof Error?t:new Error(String(t));throw this.updateGoogleState({error:n}),n}}async signInBox(){try{await this.boxAuth.signIn(),this.updateBoxState({isAuthenticated:!0,error:null})}catch(t){const n=t instanceof Error?t:new Error(String(t));throw this.updateBoxState({error:n}),n}}async signOutBox(){try{await this.boxAuth.signOut(),this.updateBoxState({isAuthenticated:!1,error:null})}catch(t){const n=t instanceof Error?t:new Error(String(t));throw this.updateBoxState({error:n}),n}}getGoogleAuthInstance(){return this.googleAuth}getBoxAuthInstance(){return this.boxAuth}isGoogleAuthenticatedSync(){return this.googleAuth.isSignedIn()}isBoxAuthenticatedSync(){return this.boxAuth.isSignedIn()}updateGoogleState(t){this.authStateStore.update(n=>({...n,google:{...n.google,...t}}))}updateBoxState(t){this.authStateStore.update(n=>({...n,box:{...n.box,...t}}))}resetState(){this.authStateStore.set({google:{isAuthenticated:!1,isInitialized:!1,userInfo:null,error:null},box:{isAuthenticated:!1,isInitialized:!1,error:null}})}}let st=null;function Tn(){return st||(st=oe.getInstance()),st}Tn();const Vr={subscribe:e=>Tn().authState.subscribe(e)};var Yr=Xe('<p style="margin-top: 1rem;" class="svelte-nejbyb"> </p>'),Hr=Xe('<p style="margin-top: 1rem;" class="svelte-nejbyb">✅ Signed in to Box</p>'),Jr=Xe('<div class="app sv-app svelte-nejbyb"><header class="header svelte-nejbyb"><div class="header-content svelte-nejbyb"><div class="header-spacer svelte-nejbyb"></div> <h1 class="logo svelte-nejbyb">🎵 Audio Analyzer</h1> <button class="dark-mode-toggle svelte-nejbyb" aria-label="Toggle dark mode"><span class="light-icon svelte-nejbyb">🌙</span> <span class="dark-icon svelte-nejbyb">☀️</span></button></div></header> <main class="main svelte-nejbyb"><div class="container svelte-nejbyb"><!> <div class="tab-content-placeholder svelte-nejbyb"><h3 class="svelte-nejbyb"> </h3> <p class="svelte-nejbyb">Tab content will be implemented in Phase 5.3+</p> <!> <!></div></div></main> <footer class="footer svelte-nejbyb"><div class="container svelte-nejbyb"><p id="buildInfo" class="svelte-nejbyb">Audio Analyzer - Phase 5.2b App Shell</p></div></footer></div>');function Wr(e,t){en(t,!1);const n=()=>gt(pt,"$currentTab",o),r=()=>gt(Vr,"$authState",o),[o,s]=xn();function i(){const T=document.documentElement,ee=T.getAttribute("data-theme")==="dark";T.setAttribute("data-theme",ee?"light":"dark"),localStorage.setItem("theme",ee?"light":"dark")}if(typeof window<"u"){const T=localStorage.getItem("theme");T&&document.documentElement.setAttribute("data-theme",T)}kn();var l=Jr(),a=L(l),u=L(a),c=ne(L(u),4),h=ne(a,2),g=L(h),d=L(g);Gr(d,{});var f=ne(d,2),w=L(f),y=L(w),P=ne(w,4);{var A=T=>{var ee=Yr(),$n=L(ee);ft(()=>jt($n,`✅ Signed in as ${r().google.userInfo?.email??""}`)),Le(T,ee)};Lt(P,T=>{n()==="googleDrive"&&r().google.isAuthenticated&&T(A)})}var Ce=ne(P,2);{var On=T=>{var ee=Hr();Le(T,ee)};Lt(Ce,T=>{n()==="box"&&r().box.isAuthenticated&&T(On)})}ft(()=>jt(y,`Current Tab: ${n()??""}`)),je("click",c,i),Le(e,l),tn(),s()}class Kr{constructor(){this.unsubscribers=[],this.bridge=re.getInstance(),this.authService=oe.getInstance(),this.attachEventListeners()}attachEventListeners(){this.unsubscribers.push(this.bridge.on("auth:google:signin:requested",()=>this.handleGoogleSignIn())),this.unsubscribers.push(this.bridge.on("auth:google:signout:requested",()=>this.handleGoogleSignOut())),this.unsubscribers.push(this.bridge.on("auth:box:signin:requested",()=>this.handleBoxSignIn())),this.unsubscribers.push(this.bridge.on("auth:box:signout:requested",()=>this.handleBoxSignOut())),this.unsubscribers.push(this.bridge.on("file:local:selected",t=>{console.log("[ServiceCoordinator] File selected:",t.file.name)})),this.unsubscribers.push(this.bridge.on("file:drive:requested",t=>{console.log("[ServiceCoordinator] Google Drive file requested:",t.url)})),this.unsubscribers.push(this.bridge.on("file:box:requested",t=>{console.log("[ServiceCoordinator] Box file requested:",t.url)}))}async handleGoogleSignIn(){try{await this.authService.signInGoogle();const n=await this.authService.getGoogleAuthInstance().getUserInfo();this.bridge.dispatch({type:"auth:google:signin:success",userInfo:n})}catch(t){this.bridge.dispatch({type:"auth:google:signin:error",error:t instanceof Error?t:new Error(String(t))})}}async handleGoogleSignOut(){try{await this.authService.signOutGoogle(),this.bridge.dispatch({type:"auth:google:signout:success"})}catch(t){this.bridge.dispatch({type:"auth:google:signout:error",error:t instanceof Error?t:new Error(String(t))})}}async handleBoxSignIn(){try{await this.authService.signInBox(),this.bridge.dispatch({type:"auth:box:signin:success"})}catch(t){this.bridge.dispatch({type:"auth:box:signin:error",error:t instanceof Error?t:new Error(String(t))})}}async handleBoxSignOut(){try{await this.authService.signOutBox(),this.bridge.dispatch({type:"auth:box:signout:success"})}catch(t){this.bridge.dispatch({type:"auth:box:signout:error",error:t instanceof Error?t:new Error(String(t))})}}destroy(){this.unsubscribers.forEach(t=>t()),this.unsubscribers=[]}}new Kr;new Wr({target:document.getElementById("app")});
